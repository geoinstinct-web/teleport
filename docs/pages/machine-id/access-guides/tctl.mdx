---
title: Machine ID with `tctl`
description: How to use Machine ID with `tctl` to manage your Teleport configuration
---

`tctl` is the Teleport cluster management CLI tool. Whilst it usually uses the
credentials from the locally logged in user, it is also possible to use
Machine ID credentials. This allows `tctl` to be leveraged in scripts as part
of custom automations.

In this guide, you will configure `tbot` to produce credentials for `tctl`, and
then use `tctl` to create and update Teleport configuration.

## Before you start

(!docs/pages/includes/edition-prereqs-tabs.mdx!)
- `tbot` must be configured and installed on your platform. Follow a
  [platform guide](../platform-guides.mdx) to do so.

## Step 1/3. Configure RBAC

In this guide, the output credentials will be used to create and update roles,
so we will grant only the privileges to do this.

As a role was already created for the output credentials during the platform
guide, we will modify this role to add these privileges.

Use `tctl edit role/example-bot` to add the following rule to the role:

```yaml
spec:
  allow:
    rules:
    - resources:
      # Specify the names of resources you wish to manage with tctl.
      # For this guide, we will only manage roles.
      - role
      verbs:
      - create
      - read
      - update
      - delete
      - list
```

## Step 2/3. Configure `tbot` output

Now, `tbot` needs to be configured with an output that will produce the
credentials needed by `tctl`. As `tctl` will be accessing the Teleport API, the
correct output type to use is `identity`.

For this guide, the `directory` destination will be used. This will write these
credentials to a specified directory on disk.

Modify your `tbot` configuration to add an `identity` output:

```yaml
outputs:
- type: identity
  destination:
    type: directory
    # For this guide, /opt/machine-id is used as the destination directory.
    # You may wish to customise this. Multiple outputs cannot share the same
    # destination.
    path: /opt/machine-id
```

If operating `tbot` as a background service, restart it. If running `tbot` in
one-shot mode, it must be executed before you attempt to execute the Terraform
plan later.

You should now see an `identity` file under `/opt/machine-id`. This contains
the private key and signed certificates needed by `tctl` to
authenticate with the Teleport Auth Server.

## Step 3/3. Use `tctl` with the identity output

To configure `tctl` to use the identity file, the `-i` flag is used. As the
identity file does not specify the address of Teleport, `--auth-server` must
also be specified with the address of your Teleport Proxy or Teleport Auth
Server.

In this example, `tctl` is used to apply each role YAML file within a directory.
This could be used as part of a CI/CD process to manage Teleport configuration
in a GitOps manner:

```code
$ tctl --auth-server example.teleport.sh:443 -i /opt/machine-id/identity create -f roles/*.yaml
```

## Next steps