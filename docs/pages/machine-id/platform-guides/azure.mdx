---
title: Deploying Machine ID on Azure
description: How to install and configure Machine ID on an Azure VM
---

This page contains relevant background information and specific steps for
deploying Machine ID on an Azure VM.

## Background

### The `azure` join method

TODO: Introduce Azure IAM Concepts and overview of the join method

## Guide

In this guide, ...

### Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)
- An Azure managed identity with a role granting the
  `Microsoft.Compute/virtualMachines/read` permission. You will need to know
  the UID of this identity.
- An Azure VM you wish to install Machine ID onto with the managed identity
  configured as a user-assigned managed identity.

### Step 1/4. Install `tbot`

Download the appropriate Teleport package for your platform:

(!docs/pages/includes/install-linux.mdx!)

### Step 2/4. Create a join token, role and bot user

(!docs/pages/includes/machine-id/blank-role.mdx!)

Create `bot-token.yaml`:

```yaml
kind: token
version: v2
metadata:
  # name will be specified in the `tbot` to use this token
  name: example-bot
spec:
  roles: [Bot]
  # bot_name will match the name of the bot created later in this guide.
  bot_name: example
  join_method: azure
  azure:
    allow:
      # subscription should be the UID of an Azure subscription. Only VMs within
      # this subscription will be able to join.
    - subscription: 11111111-1111-1111-1111-111111111111
      # resource_groups allows joining to be restricted to VMs in a specific
      # resource group. It can be omitted to allow joining from any VM within
      # a subscription.
      resource_groups: ["group1"]
```

Replace:
- `11111111-1111-1111-1111-111111111111` with the UID of your Azure subscription
- `group1` with the name of the resource group that the VM resides within or
  omit this entirely to allow joining from any VM within the subscription

Use `tctl` to apply this file:

```code
$ tctl create -f bot-token.yaml
```

Create the bot, specifying the token and role that you have created:

```code
$ tctl bots add example --token example-bot --roles example-bot
```

### Step 3/4. Configure `tbot`

Create `/etc/tbot.yaml`:

```yaml
version: v2
# ensure this is configured to the address of your Teleport Proxy or
# Auth Server. Prefer the address of the Teleport Proxy.
auth_server: example.teleport.sh:443
onboarding:
  join_method: azure
  token: example-bot
  azure :
    client_id: 22222222-2222-2222-2222-222222222222
storage:
  type: memory
outputs: []
```

Replace `22222222-2222-2222-2222-222222222222` with the ID of the Azure
managed identity that has been assigned to the VM.

(!docs/pages/includes/machine-id/daemon-or-oneshot.mdx!)

### Step 4/4. Configure Outputs

Follow one of the [access guides](../access-guides.mdx) to configure an output
that meets your access needs.

## Next steps

- Follow the [access guides](../access-guides.mdx) to finish configuring `tbot` for
  your environment.
- Read the [configuration reference](../reference/configuration.mdx) to explore
  all the available configuration options.