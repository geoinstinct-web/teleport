---
title: Deploying Machine ID on AWS
description: How to install and configure Machine ID on an AWS EC2 instance
---

This page contains relevant background information and specific steps for
deploying Machine ID on Amazon Web Services.

## Background

### The `iam` join method

TODO: Brief overview of how the join method works for this platform.

### Elastic Kubernetes Service

Whilst the guide on this page focuses explicitly on deploying Machine ID on an
EC2 instance, it is also possible to use the `iam` join method with
workloads (e.g Pods) running on an EKS Kubernetes cluster.

It is a requirement that
[IAM Roles for Service Accounts (IRSA)](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html)
has been configured for the cluster and the Kubernetes service account that will
be used by the `tbot` pod.

See the [Kubernetes platform guide](kubernetes.mdx) for further guidance
on deploying Machine ID as a workload on Kubernetes.

## Guide

In this guide, you will install Machine ID's agent, `tbot`, on an AWS EC2
instance. The bot will be configured to use the `iam` delegated joining method
to eliminate the need for long-lived secrets.

### Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)
- An AWS IAM role that you wish to grant access to your Teleport cluster. This
  role must be granted `sts:GetCallerIdentity`. In this guide, this role will
  be named `teleport-bot-role`.
- An AWS EC2 virtual machine that you wish to install Machine ID onto configured
  with the IAM role attached.

### Step 1/4. Install `tbot`

**This step is completed on the AWS EC2 instance.**

First, `tbot` needs to be installed on the VM that you wish to use Machine ID
on.

Download and install the appropriate Teleport package for your platform:

(!docs/pages/includes/install-linux.mdx!)

### Step 2/4. Create a role and bot user

**This step is completed on your local machine.**

(!docs/pages/includes/machine-id/blank-role.mdx!)

Create `bot-token.yaml`:

```yaml
kind: token
version: v2
metadata:
  # name will be specified in the `tbot` to use this token
  name: example-bot
spec:
  roles: [Bot]
  # bot_name will match the name of the bot created later in this guide.
  bot_name: example
  join_method: iam
  # Restrict the AWS account and (optionally) ARN that can use this token.
  # This information can be obtained from running the
  # "aws sts get-caller-identity" command from the CLI.
  allow:
    - aws_account: "111111111111"
      aws_arn: "arn:aws:sts::111111111111:assumed-role/teleport-bot-role/i-*"
```

Replace:

- `111111111111` with the ID of your AWS account.
- `teleport-bot-role` with the name of the AWS IAM role you created and assigned
  to the EC2 instance.
- `i-*` indicates that any instance with the specified role can use the join
  method. If you wish to restrict this to an individual instance, replace `i-*`
  with the full instance ID.

Use `tctl` to apply this file:

```code
$ tctl create -f bot-token.yaml
```

Create the bot, specifying the token and role that you have created:

```code
$ tctl bots add example --token example-bot --roles example-bot
```

### Step 3/4. Configure `tbot`

**This step is completed on the AWS EC2 instance.**

Create `/etc/tbot.yaml`:

```yaml
version: v2
auth_server: example.teleport.sh:443
onboarding:
  join_method: iam
  token: example-bot
storage:
  type: memory
# outputs will be filled in during the completion of an access guide.
outputs: []
```

Replace:

- `example.teleport.sh:443` with the address of your Teleport Proxy or
  Auth Server. Prefer using the address of a Teleport Proxy.
- `example-bot` with the name of the token you created in the second step.

(!docs/pages/includes/machine-id/daemon-or-oneshot.mdx!)

### Step 4/4. Configure Outputs

(!docs/pages/includes/machine-id/configure-outputs.mdx!)

## Next steps

- Follow the [access guides](../access-guides.mdx) to finish configuring `tbot` for
  your environment.
- Read the [configuration reference](../reference/configuration.mdx) to explore
  all the available configuration options.