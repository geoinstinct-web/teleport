---
title: Deploying Machine ID on GCP
description: How to install and configure Machine ID on a GCP VM
---

This page contains relevant background information and specific steps for
deploying Machine ID on Google Cloud Platform.

## Background

### The `gcp` join method

TODO: Introduce GCP IAM Concepts and overview of the join method

### Google Kubernetes Engine

Whilst the guide on this page focuses explicitly on deploying Machine ID on a
GCP Virtual Machine, it is also possible to use the `gcp` join method with
workloads (e.g Pods) running on a GKE Kubernetes cluster.

It is a requirement that
[GCP Workload Identity](https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity)
has been configured for the cluster and the Kubernetes service account that will
be used by the `tbot` pod.

See the [Kubernetes platform guide](kubernetes.mdx) for further guidance
on deploying Machine ID as a workload on Kubernetes.

## Guide

This guide will...

### Before you start

### Step 1/4. Assign a GCP Service Account to a VM

### Step 2/4. Create a join token, role and bot user

(!docs/pages/includes/machine-id/blank-role.mdx!)

Create `bot-token.yaml`:

```yaml
kind: token
version: v2
metadata:
  # name will be specified in the `tbot` to use this token
  name: example-bot
spec:
  roles: [Bot]
  # bot_name will match the name of the bot created later in this guide.
  bot_name: example
  join_method: gcp
  gcp:
    # allow specifies the rules by which the Auth Server determines if `tbot`
    # should be allowed to join.
    allow:
    - project_ids:
        - my-project-123456
      service_accounts:
        # This should be the full "name" of a GCP service account. The default
        # compute service account is not supported.
        - my-service-account@my-project-123456.iam.gserviceaccount.com
```

Replace:
- `my-project-123456` with the ID of your GCP project
- `my-service-account@my-project-123456.iam.gserviceaccount.com` with the email
  of the service account configured in the previous step.

Use `tctl` to apply this file:

```code
$ tctl create -f bot-token.yaml
```

### Step 3/4. Configure `tbot`

### Step 4/4. Configure Outputs

Follow one of the [access guides](../access-guides.mdx) to configure an output
that meets your access needs.

## Next steps

- Follow the [access guides](../access-guides.mdx) to finish configuring `tbot` for
  your environment.
- Read the [configuration reference](../reference/configuration.mdx) to explore
  all the available configuration options.