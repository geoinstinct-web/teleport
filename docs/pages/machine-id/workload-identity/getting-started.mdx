---
title: Getting Started with Workload Identity
description: Getting started with Teleport Workload Identity for SPIFFE and Machine ID
---

<Admonition type="tip" title="Preview">
Teleport Workload Identity is currently in Preview. We are actively working on
improving the feature and would love to hear your feedback. We currently do
not recommend using this feature in production.
</Admonition>

In this guide, we'll walk through the steps required to get started with
Teleport Workload Identity. Workload Identity allows you to issue short-lived
SPIFFE X.509 SVIDs to workloads running on your infrastructure. To do this,
you will configure `tbot` to act as a SPIFFE Workload API endpoint.

## Getting Started

### Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)
- `tbot` must already be installed and configured on the host where the
  workloads which need to access Teleport Workload Identity will run. For more
  information, see the [deployment guides](../deployment.mdx).

## Step 1/4. Configure RBAC

First, Teleport must be configured to allow the credentials produced by `tbot`
to modify the Teleport configuration. It's important to grant as few
privileges as possible in order to limit the blast radius of an attack, so in
this example we grant only the ability to create and update roles.

If you have followed a platform guide, you will have created a role and granted
the bot the ability to impersonate it already. This role just needs to have the
additional privileges added to it.

Use `tctl edit role/example-bot` to add the following rule to the role:

```yaml
spec:
  allow:
    rules:
    - resources:
      # Specify the names of resources you wish to manage with tctl.
      # For this guide, we will only manage roles.
      - role
      verbs:
      - create
      - read
      - update
      - delete
      - list
```

### Step 2/4. Configure `spiffe-workload-api` service in `tbot`

To set up a SPIFFE Workload API endpoint with `tbot`, we configure an instance
of the `spiffe-workload-api` service.

First, determine where you wish this socket to be created. In our example,
we'll use `/opt/machine-id/workload.sock`. You may wish to choose a directory
that is only accessible by the processes that will need to connect to the
Workload API.

Modify your `tbot` configuration file to include the `spiffe-workload-api`
service:

```yaml
services:
- type: spiffe-workload-api
  listen: unix:///opt/machine-id/workload.sock
  svids:
  - path: /svc/foo
    hint: my-hint
```

Replace:

- `/opt/machine-id/workload.sock` with the path to the socket you wish to create.
- `/svc/foo` with the SPIFFE ID that you wish to issue SVIDs for.
- `my-hint` with a hint that will be included with the SVID. This can help
  workloads identify which SVID they should select if multiple are presented.
  This field can be omitted if not required.

#### Configuring DNS and IP SANs

In some cases, you may wish to configure DNS and IP SANs which should be
included in the SVIDs issued by the Workload API. This is useful in cases
where the client may not be SPIFFE aware and will check the DNS SAN rather than
the SPIFFE URI during the TLS handshake.

These can be configured in the `spiffe-workload-api` service using the `sans`
configuration block:

```yaml
services:
- type: spiffe-workload-api
  listen: unix:///opt/machine-id/workload.sock
  svids:
  - path: /svc/foo
    hint: my-hint
    sans:
      dns:
      - example.com
      ip:
      - 10.0.0.1
```

### Step 3/4. Testing the Workload API with `tbot spiffe-inspect`

The `tbot` binary includes a `spiffe-inspect` command that can be used to
test the configuration of the Workload API. This command will connect to the
Workload API and request SVIDs, whilst providing debug information.

Before configuring your workload to use the Workload API, we recommend using
this command to ensure that the Workload API is behaving as expected.

Use the `spiffe-inspect` command with `--path` to specify the path to the
Workload API socket, replacing `/opt/machine-id/workload.sock` with the path you
configured in the previous step:

```bash
$ tbot spiffe-inspect --path unix:///opt/machine-id/workload.sock
INFO [TBOT]      Inspecting SPIFFE Workload API Endpoint unix:///opt/machine-id/workload.sock tbot/spiffe.go:31
INFO [TBOT]      Received X.509 SVID context from Workload API bundles_count:1 svids_count:1 tbot/spiffe.go:46
SVIDS
- spiffe://example.teleport.sh/svc/foo
  - Hint: my-hint
  - Expiry: 2024-03-20 10:55:52 +0000 UTC
Trust Bundles
- example.teleport.sh
```

### Step 4/4. Configuring your workload to use the Workload API

Now that you know that the Workload API is behaving as expected, you can
configure your workload to use it. The exact steps will depend on the workload.

In cases where you have used the SPIFFE SDKs, you can configure the
`SPIFFE_ENDPOINT_SOCKET` environment variable to point to the socket created by
`tbot`.

See the [Best Practices](./best-practices.mdx) guide for more information on
integrating SPIFFE with your workloads.

## Next Steps

- [Workload Identity Overview](../workload-identity.mdx): Overview of Teleport
Workload Identity.
- [Best Practices](./best-practices.mdx): Best practices for using Workload
Identity in Production.
- Read the [configuration reference](../reference/configuration.mdx) to explore
all the available configuration options.