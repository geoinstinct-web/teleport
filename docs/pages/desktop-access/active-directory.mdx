---
title: Configure access for Active Directory automatically
description: Demonstrates how to integrate the Teleport Windows Desktop Service with your Active Directory domain.
videoBanner: v36tlB8D5kk
---

This guide demonstrates how to configure Teleport and Active Directory to
provide secure, passwordless access to Windows desktops.

You should note that Teleport requires the Kerberos authentication protocol to support 
certificate-based authentication for Active Directory. Because Azure Active Directory
doesn't use Kerberos, you can't use the Teleport Windows Desktop Service for 
Azure Active Directory.

<Details title="Compare Desktop Access to other RDP clients">

The Teleport Windows Desktop Service implements a minimal set of RDP protocol 
features with secure access as its top priority. The service might not be as 
performant as other RDP clients. You should consider using the Teleport Windows 
Desktop Service to manage access to your most sensitive Windows environments, not 
as a drop-in replacement for other tools to provide general access to Windows desktops.

</Details>

## Prerequisites

- Access to a running Teleport cluster, `tctl` admin tool, and `tsh` client tool 
  version >= (=teleport.version=). 
  
  You can verify the tools you have installed by running the following commands:

  ```code
  $ tctl version
  # Teleport Enterprise v(=teleport.version=) go(=teleport.golang=)
  
  $ tsh version
  # Teleport v(=teleport.version=) go(=teleport.golang=)
  ```

  You can download these tools by following the appropriate [Installation 
  instructions](../installation.mdx#installation-instructions) for your environment 
  and Teleport edition.
- A server or virtual machine running the Windows Server operating system on which you can
  install Active Directory services.
- A Linux host to run the Teleport Windows Desktop Service.
  You can reuse an existing server running any other Teleport instance.

## Step 1/3. Install and configure Active Directory

The Teleport Web UI provides scripts to automate the configuration of Active Directory
for the Teleport Windows Desktop Service. From the Teleport Web UI, you can 
download the following scripts to convert a Windows Server into an Active Directory
domain controller:

- The Active Directory installation script adds basic Active Directory services and tools to the 
  Windows Server.
- The Active Directory Certificate Services installation script adds a certificate authority and 
  certificate management services to the domain controller.
- The Active Directory configuration script generates Teleport configuration settings for your specific
  cluster.

Installing Active Directory Certificate Services is optional. However, Teleport requires secure LDAP 
connections for cerificate-based authentication, and LDAP traffic is not encrypted by default. 
To provide secure LDAP connections (LDAPS), you must have a certificate authority that issues properly 
formatted and encrypted certificates. By installing the [Active Directory Certificate 
Services](https://learn.microsoft.com/en-us/windows-server/identity/ad-cs/) on the Active Directory
domain controller, you can ensure that the domain issues certificates configured for LDAPS. 

If you already have Active Directory installed and the domain is configured for encrypted LDAPS
communication, you can skip running the first two scripts.

To install Active Directory services:

1. Sign in to the Teleport Web UI using your Teleport cluster address.

1. Select **Resources**.

1. Click **Enroll New Resource**.

1. Click **Active Directory** to start the guided enrollment.
   
   ![Install Active Directory](../../img/desktop-access/install-active-directory.png)

1. Copy the first command from the Teleport Web UI and paste it into the Windows PowerShell 
   console on your Windows Server host.

   Wait for the script to complete and the Windows computer to restart before continuing.

1. Copy the second command from the Teleport Web UI and paste it into the Windows PowerShell 
   console on your Windows Server host.
   
   Wait for the script to complete and the Windows computer to restart before continuing.

1. Click **Next**, then copy the Active Directory configuration script from the Teleport Web UI 
   and paste it into the Windows PowerShell console on your Windows Server host.
   
   ![Configure Active Directory](../../img/desktop-access/configure-active-directory.png)

1. Click **Next**.

   The script generates Teleport configuration settings, including an authentication token for
   joining the Teleport cluster.

1. Copy the PowerShell script output to a temporary location, then click **Next**.

## Step 2/3. Install the Teleport Windows Desktop Service

To install the Windows Desktop Service:

1. Open a terminal shell on the Linux host where you want to run the Windows Desktop Service.

1. Create a file called `/etc/teleport.yaml` and paste the configuration output generated by the
   PowerShell script you ran previously.
   
   If you would like to run the Teleport Desktop Service from a Teleport process
   that is already running other services, copy and paste only the `windows_desktop_service` section.
   
   The configuration file will resemble the following:
   
   ```yaml
   version: v3
   teleport:
     auth_token: (=presets.tokens.first=)
     proxy_server: teleport.example.com:443
   
   auth_service:
     enabled: no
   ssh_service:
     enabled: no
   proxy_service:
     enabled: no
   
   windows_desktop_service:
     enabled: yes
     ldap:
       addr: '10.10.1.50:636'
       domain: 'windows.teleport.example.com'
       username: 'WIN\svc-teleport'
       server_name: 'windows-server-hostname'
       # insecure_skip_verify prevents teleport from authenticating the LDAP CA
       # against the systems trust store.
       insecure_skip_verify: false
       ldap_ca_cert: |
         -----BEGIN CERTIFICATE-----
         MIIDnzCCAoegAwIBAgIQT/UIn+MT4aZC9ix/QuiV9zANBgkqhkiG9w0BAQsFADBi
         ...
         31qA4dO3if7RdikD9hVbiIF9jQ==
         -----END CERTIFICATE-----
   
     discovery:
       base_dn: '*'
     labels:
       teleport.internal/resource-id: 42d8859c-60d0-4d7f-9767-bdd66b63fce6
   ```

1. Install the Teleport Windows Desktop Service on your Linux host.

   (!docs/pages/includes/install-linux.mdx!)

## Step 3/3. Start Teleport

After you've saved `/etc/teleport.yaml`, you can start Teleport on the Linux host.

TO start Teleport::

1. (!docs/pages/includes/start-teleport.mdx service="the Teleport Desktop Service"!)

1. When the new Teleport instance has joined the cluster, click **Next**.

   Teleport will discover available Windows desktops in the domain, and list them
   under **Desktops**.

1. Click **Finish** then **Browse Existing Resources** to see your domain computers:

   ![Desktops discovered](../../img/desktop-access/auto-discovered-desktops.png)

## Next steps

If you encounter any issues, see [Troubleshooting](./troubleshooting.mdx) for common problems and
solutions.
For information about configuring Windows-specific role permissions, see 
[Configure Windows-specific role permissions](./rbac.mdx).
