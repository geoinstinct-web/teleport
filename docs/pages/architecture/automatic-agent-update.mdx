---
title: Automatic Agent Update
description: This chapter explains how Teleport agent automatic update is working.
h1: Automatic Agent Update
---

While many Teleport resources [support agentless
mode](../faq.mdx#can-teleport-be-deployed-in-agentless-mode), agent deployments
are sometimes simpler and more convenient. However, large Teleport deployments
can create an additional burden: updating all agents.

Starting with version 13, Teleport supports automatic agent updates for apt/yum
systems and Kubernetes clusters.

## Update logic and failure modes

We designed the updater to be as decoupled from Teleport as possible. The
updater can update agents even when they cannot join the Teleport cluster.
Pushing a broken version can happen, but the rollback/roll-forward must always
be possible without manually connecting to the resource and fixing the agent.

The updater recurrently fetches the target version from a version server and
updates the agent to the target version. Because restarting the agent can
disrupt currently open sessions, it will only update the agent in two cases:
during a maintenance window and when the agent is unhealthy.

When enrolled in a cluster with automatic updates, the agent will retrieve
its maintenance schedule from the Teleport cluster and save it. When a
maintenance schedule is available, the updater will honour it. However, if
the updater cannot find the maintenance schedule, it will consider the agent
unhealthy and perform updates as soon as possible. Similarly, if the updater
detects the agent is unhealthy, it immediately applies any pending update to
try to recover from a degraded state.

We implemented an additional failsafe: the critical maintenance toggle.
The version server can specify that an update is critical. Critical updates are
applied even if the updater is outside its regular maintenance window.

## Security

When updating the agent, the updater will ensure the new version's authenticity
before deploying it. On apt/yum setups, it relies on the existing package
signature system. On Kubernetes-based environments, it validates the OCI image
signature (using cosign's signature format).

## Version server and source of truth

The agent version is subject to the following constraints:

- the agent must never exceed the proxy or auth version
- the agent must always be at most one major version below the proxy or auth
  version.

The best practice is always aligning the agent version with the proxy and auth
ones. Doing so ensures the agents benefit from all available features and bug
fixes for the given auth/proxy version.

For this reason, depending on the Teleport setup, the updater will use a
different source of truth to retrieve the target version.

### Teleport Cloud

Teleport Cloud users can use Teleport Cloud's version server only if their
instance is enrolled in automatic updates. This version server will always
target the best version from a feature, compatibility, security and stability
point of view.

Teleport Cloud users whose control plane is not automatically updated must not use
automatic agent updates. This is because their Teleport instance version might
differ from the other Teleport Cloud instances and might not yet support the
latest agent version.

### Self-hosted Teleport

Self-hosted Teleport users can set up automatic agent updates. They must host
their version server and choose their target version. They are responsible for
ensuring the targeted version is compatible with their current auth/proxy
versions. They must also monitor the agent's health and rollout status to
ensure every agent is healthy and running the correct version.
