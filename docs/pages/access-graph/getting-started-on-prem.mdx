---
title: Getting started with Teleport Access Graph (TAG)
---

<Notice type="note">
Teleport Access Graph is provided by default to users of the Teleport Team plan.
Visit the [signup page](https://goteleport.com/signup/) to begin your free&nbsp;trial.
</Notice>

## Prerequisites

<Tabs>
<TabItem
  scope={["enterprise"]} label="Self-Hosted Enterprise">

- A running Teleport Enterprise cluster v15.0.0 or later.
- Docker version v(=docker.version=) or later.
- A PostgresSQL database server v14 or later.
  - Access Graph needs a dedicated [database](https://www.postgresql.org/docs/current/sql-createdatabase.html) to store its data.
    The user that TAG connects to the database with needs to be an owner of this database, or have similar broad permissions:
    at least the `CREATE TABLE` privilege on the `public` schema, and the `CREATE SCHEMA` privilege.
- A TLS certificate for the Access Graph service
- The node running the Access Graph service must be reachable from Teleport Auth and Proxy services.

</TabItem>
</Tabs>

## Step 1/3. Set up the Teleport Access Graph service

You'll need a copy of your Teleport cluster's host certificate authority (CA) on the machine that hosts the Access Graph service.
It can be retrieved and saved into a file in one of the following ways:

<Tabs>
<TabItem label="Via curl">
```console
$ mkdir /etc/access_graph
$ curl 'https://<Var name="teleport.example.com" />/webapi/auth/export?type=tls-host' > /etc/access_graph/teleport_host_ca.pem
```
</TabItem>

<TabItem label="Via tctl">
```console
$ mkdir /etc/access_graph
$ tsh login --proxy=<Var name="teleport.example.com" />
$ tctl get cert_authorities --format=json \
    | jq -r '.[] | select(.spec.type == "host") | .spec.active_keys.tls[].cert' \
    | base64 -d > /etc/access_graph/teleport_host_ca.pem
```
</TabItem>
</Tabs>

Then, create a configuration file for the TAG service, similar to this:

```yaml
backend:
  postgres:
    # This uses the PostgreSQL connection URI format, see https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING-URIS
    # A stricter `sslmode` value is strongly recommended,
    # e.g. `sslmode=verify-full&sslrootcert=/etc/access_graph/my_postgres_ca.crt`.
    # For a full reference on possible parameters see https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-PARAMKEYWORDS
    connection: postgres://access_graph_user:mypassword@db.example.com:5432/access_graph_db?sslmode=require

# IP address (optional) and port for the TAG service to listen to.
# This is the default value. This key can be omitted to listen on port 50051 on all interfaces.
address: ":50051"

tls:
  # File paths of PEM-encoded TLS certificate and private key for the TAG server.
  cert: /etc/access_graph/tls.crt
  key: /etc/access_graph/tls.key

# This lists the file paths for host CAs of Teleport clusters that are allowed to register with this TAG service.
# Several paths can be included to allow several Teleport clusters to connect to the TAG service.
registration_cas:
  - /etc/access_graph/teleport_host_ca.pem # A full path to the file containing the Teleport cluster's host CA certificate.
```

Finally, start the TAG service using Docker as follows:

```console
$ docker run -v <path-to-config>:/app/config.yaml -v /etc/access_graph:/etc/access_graph public.ecr.aws/gravitational/access-graph:(=access_graph.version=)
```

## Step 2/3. Update Teleport Auth server configuration

In the YAML config for the Auth service, add a new top-level section for Access Graph configuration.

```yaml
access_graph:
  enabled: true
  # host:port where the TAG service is listening
  endpoint: access-graph.example.com:50051
  # Optionally, specify a trusted CA we expect the TAG service certificate to be signed by.
  # If not specified, the system trust store will be used.
  ca: /etc/access_graph_ca.pem
```

Then, restart Auth servers, followed by Proxy servers.

## Step 3/3. View the Access Graph in the Web UI

You can find Access Graph in the "Access Management" tab in the Web UI.
![Access Management menu item](../../img/access-graph/menu-item.png)

To access the interface, your user must have a role that allows `list` and `read` verbs on the `access_graph` resource, e.g.:

```yaml
kind: role
version: v5
metadata:
  name: my-role
spec:
  allow:
    rules:
    - resources:
      - access_graph
      verbs:
      - list
      - read
```

The automatically provisioned `editor` role has the required permissions by default.
