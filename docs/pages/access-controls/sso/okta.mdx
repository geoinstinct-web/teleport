---
title: Authentication With Okta as an SSO provider
description: How to configure Teleport access using Okta for SSO
videoBanner: SM4Am-i8cj4
---

## How to use Okta as a single sign-on (SSO) provider for SSH

This guide covers how to configure [Okta](https://www.okta.com/) to provide
single sign on (SSO) identities to Teleport Enterprise and Teleport Enterprise
Cloud. When used in combination with role based access control (RBAC), this allows
Teleport administrators to define policies like:

- Only members of "DBA" group can access into PostgreSQL databases.
- Developers must never SSH into production servers.
- Members of the HR group can view audit logs but not production environments.

## Prerequisites

- An Okta account with admin access. Your account must include users and at
  least two groups.

(!docs/pages/includes/commercial-prereqs-tabs.mdx!)

- A Teleport role with access to edit and maintain `saml` resources. This is
  available in the default `editor` role.

(!docs/pages/includes/tctl.mdx!)

(!docs/pages/includes/enterprise/samlauthentication.mdx!)

## Step 1/4. Create & assign groups

### Create Groups

Create two groups: "okta-dev" and "okta-admin". In the Okta dashboard go to the
navigation bar and click **Directory** -> Groups, then **Add group**:

![Create Group Devs](../../../img/sso/okta/okta-saml-2.1@2x.png)

Repeat for the admin group:

![Create Group Devs](../../../img/sso/okta/okta-saml-2.2.png)

## Step 2/4. Configure Okta

First, create a SAML 2.0 Web App in Okta:

From the main navigation menu, select **Applications** -> Applications, and click
**Create App Integration**. Select SAML 2.0, then click **Next**.

![Create APP](../../../img/sso/okta/okta-saml-1.png)

On the next screen (**General Settings**), provide a name and optional logo for your new app, then
click **Next**. This will bring you to the **Configure SAML** section.

### Configure the App

Provide the following values to their respective fields:

#### General

- Single sign on URL: `https://<cluster-url>/v1/webapi/saml/acs/new_saml_connector`
- Audience URI (SP Entity ID): <nobr>`https://<cluster-url>/v1/webapi/saml/acs/new_saml_connector`</nobr>
- Name ID format `EmailAddress`
- Application username `Okta username`

Replace `<cluster-url>` with your Teleport proxy address or cloud tenant (e.g. `mytenant.teleport.sh`).

#### Attribute Statements

- Name: `username`  | Name format: `Unspecified` | Value: `user.login`

#### Group Attribute Statements

We will map our Okta groups to the SAML Attribute statements (special signed
metadata exposed via a SAML XML response).

- Name: `groups` | Name format: `Unspecified`
- Filter: `Matches regex` |  `.*`

The configuration page should now look like this:

![Configure APP](../../../img/sso/okta/setup-redirection.png)

<Admonition type="warning" >
RegEx requires `.*`
</Admonition>

<Admonition type="tip">
Notice that we have set "NameID" to the email format and mapped the groups with
a wildcard regex in the Group Attribute statements. We have also set the "Audience"
and SSO URL to the same value.
</Admonition>

Once you've filled the required fields, click **Next**, then finish the app creation wizard.

From the **Assignments** tab of the new application page, click **Assign**.
Assign the newly created groups access to the app.

![Configure APP](../../../img/sso/okta/okta-saml-3.1.png)

### Save IdP metadata

From the app's **Sign On** tab, scroll down to **SAML Signing Certificates**.
Click **Actions** for the SHA-2 entry, then "View IdP metadata":

![View Okta IdP Metadata](../../../img/sso/okta/okta-copy-metadata.png)

Copy the URL to the metadata file for use in our Teleport configuration.

<Admonition type="tip">
You can also right click on the "View IdP metadata" link and select
"Copy Link" or "Copy Link Address".
</Admonition>

## Step 3/4. Create a SAML connector

Define a SAML connector [resource](../../reference/resources.mdx) in a local
file named `okta-connector.yaml`:

```yaml
(!examples/resources/saml-connector.yaml!)
```

Update the value of `acs` with your Teleport Proxy address or cloud tenant
(e.g. `mytenant.teleport.sh`), and replace the value of `entity_descriptor_url`
with the path you copied in the previous step.

The `attributes_to_roles` field in the connector resource maps key/value-like attributes of
the assertion from Okta into a list of Teleport roles to apply to the session.

(!docs/pages/includes/sso/idp-initiated.mdx!)

Create the connector using `tctl` tool:

```code
$ tctl create okta-connector.yaml
```

## Step 4/4. Create a developer Teleport role

Now let's create a new role to pull in external information from Okta.
Create the local file `dev.yaml` with the content below.

Notice the `{{external.username}}` login. It configures Teleport to look at the
*"username"* Okta claim and use that field as an allowed login for each user. This
example uses email as the username format.  The `email.local(external.username)`
function call will remove the `@domain` and leave the username prefix.

```yaml
kind: role
version: v5
metadata:
  name: dev
spec:
  options:
    max_session_ttl: 24h
  allow:
    logins: [ "{{email.local(external.username)}}", ubuntu ]
    node_labels:
      access: relaxed
```

- Devs are only allowed to login to nodes labelled with `access: relaxed` label.
- Developers can log in as `ubuntu` user or a user matching their email prefix.
- Developers do not have any "allow rules" i.e. they will not be able to
  see/replay past sessions or re-configure the Teleport cluster.

Use tctl to create this role on the auth server:

```code
$ tctl create dev.yaml
```

## Testing

The Web UI now contains a new "Okta" button at the login screen. The CLI
behaves the same as before, but now you provide the email associated with an
Okta account:

```code
$ tsh login --proxy=proxy.example.com --user=alice@example.com
```

This command prints the SSO login URL (and will try to open it automatically
in a browser).

<Admonition  type="tip">
Teleport can use multiple SAML connectors. In this case a connector name
can be passed via the `--auth` flag. For the connector we created above:

```code
$ tsh login --proxy=proxy.example.com --user=alice@example.com --auth=okta
```

</Admonition>

## Troubleshooting

(!docs/pages/includes/sso/loginerrortroubleshooting.mdx!)
