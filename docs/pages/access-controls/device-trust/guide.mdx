---
title: Getting Started with Device Trust (Preview)
description: Get started with Teleport Device Trust
videoBanner: gBQyj_X1LVw
---

<Admonition type="warning">
  Device Trust is currently in Preview mode and supports following components:

  - User devices: macOS and Windows.
  - Teleport client: `tsh` and Teleport connect.
  - Resources: SSH, Database and Kubernetes.

  Support for other operating systems, access from Web UI and application
  access is planned for upcoming Teleport versions.
</Admonition>

Device Trust requires two of the following steps to have been configured:

- Device enforcement mode configured via either a role or a cluster-wide config.
- Trusted device registered and enrolled with Teleport.

In this guide, you will update an existing user profile to assign the preset `require-trusted-device`
role and then enroll a trusted device into Teleport to access a resource (a test linux server)
protected with Teleport.

### Prerequisites

(!docs/pages/includes/no-oss-prereqs-tabs.mdx!)

(!docs/pages/includes/device-trust/prereqs.mdx!)

- User with `editor` role.
  - ```code
    $ tsh status
    > Profile URL:      https://teleport.example.com:443
    Logged in as:       myuser
    Cluster:            teleport.example.com
    Roles:              access, auditor, editor
    Logins:             root, ubuntu, ec2-user
    Kubernetes:         disabled
    Valid until:        2023-08-22 03:30:24 -0400 EDT [valid for 11h52m0s]
    Extensions:         login-ip, permit-agent-forwarding, permit-port-forwarding, permit-pty, private-key-policy
    ```
- Access to a linux server (You can pick any test linux server enrolled in Teleport which
  your Teleport user is allowed for SSH access).
  - ```code
    $ tsh ls
    Node Name        Address        Labels
    ---------------- -------------- --------------------------------------
    ip-172-31-35-170 ‚üµ Tunnel

    # test connection to ip-172-31-35-170
    $ tsh ssh root@ip-172-31-35-170
    root@ip-172-31-35-170:~#
    ```

Once the above prerequisites are met, begin with the following step.

## Step 1/2. Update user profile to enforce Device Trust

To enforce Device Trust, a user must be assigned with a role with Device Trust mode "required".

For this guide, we will use the preset `require-trusted-device` role to udpate current user profile.
<Admonition type="warning" title="v13.3.5 and Below">
  The preset `require-trusted-device` role, as referenced in this guide, is only available
  from Teleport version 13.3.6 and above. For older Teleport cluster, you will need to update
  a role with `device_trust_mode: required`.

  <Details title="Update a role to enforce Device Trust" closed>
    For simplicity, the example below updates the preset `access` role but you can update
    any existing access granting role which the user is assigned with to enforce Device Trust.

    First, fetch a role so you can update it locally:
    ```code
    $ tctl get roles/access > access.yaml
    ```

    Edit the role with device trust mode:
    ```diff
    kind: role
    version: v6
    metadata:
      labels:
        teleport.internal/resource-type: preset
      name: access
    spec:
      allow:
        logins: ['root']
        ...
      options:
        # require authenticated device check for this role
    +   device_trust_mode: "required" # add this line
        ...
      deny:
        ...

    ```

    Save and update the role:

    ```code
    $ tctl create -f access.yaml
    ```

    Now that the `access` role is configured with device mode "required", users with
    this role will be enforced with Device Trust.
  </Details>
</Admonition>

First, let's fetch the user profile locally so we can update it with the preset `require-trusted-device` role.

```code
$ tctl get users/myuser > myuser.yaml
```

Edit the profile:
```diff
kind: user
metadata:
  id: 1692716146877042322
  name: myuser
spec:
  created_by:
    time: "2023-08-14T13:42:22.291972449Z"
  expires: "0001-01-01T00:00:00Z"
  roles:
  - access
  - auditor
  - editor
+ - require-trusted-device # add this line
  status:
    is_locked: false
  ...
```

Save and update user:

```code
$ tctl create -f myuser.yaml
```

Now that the user profile is updated to enforce Device Trust, try to access the test server
again.

```code
$ tsh ssh root@ip-172-31-35-170
ERROR: access denied to root connecting to ip-172-31-35-170:0
```

As you can verify from the above step, access to `ip-172-31-35-170` ssh server,
which was previously accessible, is now forbidden.

## Step 2/2. Enroll device

To access `ip-172-31-35-170` server again, you will have to enroll your device.

Enrolling your device is easy, and can be done using `tsh` client:

```code
$ tsh enroll device --current-device
Device "(=devicetrust.asset_tag=)"/macOS registered and enrolled
```

<Admonition type="tip" title="self enrollment: v13.3.5+">
  `--current-device` flag tells `tsh` to enroll current device. User must have the preset `editor`
  role or the preset `device-enroll` role (available from v13.3.6 and above)to be able to self-enroll
  their device. For user's without the `editor` or `device-enroll` role, an enrollment token must be generated by
  device admin, which can then be used to enroll the device. Learn more about manual device operation in
  [device management guide](./device-management.mdx#register-a-trusted-device)
</Admonition>

<Admonition type="note" title="Windows">
  On Windows, the `tsh device enroll` command attempts to elevate to
  administrator privileges on the device. Privilege elevation is required to
  perform a TPM Credential Activation. This step is only required for
  enrollment and is not required on future device authentications.
</Admonition>

Relogin to fetch updated certificate with device extension:

```code
$ tsh logout; tsh login --proxy=teleport.example.com --user=myuser

$ tsh status
> Profile URL:        https://teleport.example.com:443
  Logged in as:       myuser
  Cluster:            teleport.example.com:443
  Roles:              access, auditor, editor
  Logins:             root
  Kubernetes:         enabled
  Valid until:        2023-08-22 04:06:53 -0400 EDT [valid for 12h0m0s]
  Extensions:         login-ip, ... teleport-device-asset-tag, teleport-device-credential-id, teleport-device-id
```

The presence of the `teleport-device-*` extensions shows that the device was successfully authenticated.

Now, let's try to access server (`ip-172-31-35-170`) again:

```bash
$ tsh ssh root@ip-172-31-35-170
root@ip-172-31-35-170:~#
```

Congratulations! You have successfully configured a Trusted Device and accessed a resource protected with
Device Trust enforcement.

## Next steps

- [Device Management](./device-management.mdx)
- [Enforcing Device Trust](./enforcing-device-trust.mdx)
- [Jamf Pro Integration](./jamf-integration.mdx)
