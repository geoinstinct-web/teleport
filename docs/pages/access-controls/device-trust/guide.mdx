---
title: Getting Started with Device Trust (Preview)
description: Get started with Teleport Device Trust
videoBanner: gBQyj_X1LVw
---

<Admonition type="warning">
Device Trust is currently in Preview mode.
</Admonition>

For an effective Device Trust enforcement, two condition needs to be met:
- a role configured with Device Trust mode.
- user's device enrolled with Teleport.

In this guide, you will configure an existing role to demonstrate effectiveness of
Device Trust enforcement, then enroll a trusted device to Teleport to access a test ssh server.

### Prerequisites

(!docs/pages/includes/no-oss-prereqs-tabs.mdx!)

(!docs/pages/includes/device-trust/prereqs.mdx!)

- User with `editor` role.
  - ```code
    $ tsh status
    > Profile URL:      https://tele.example.com:443
    Logged in as:       myuser
    Cluster:            tele.example.com
    Roles:              access, auditor, editor
    Logins:             root, ubuntu, ec2-user
    Kubernetes:         disabled
    Valid until:        2023-08-22 03:30:24 -0400 EDT [valid for 11h52m0s]
    Extensions:         login-ip, permit-agent-forwarding, permit-port-forwarding, permit-pty, private-key-policy
    ```

- Access to a test ssh server (You can pick any test SSH server avaialable in your Teleport cluster which
your Teleport user can access).
  - ```code
    $ tsh ls
    Node Name        Address        Labels
    ---------------- -------------- --------------------------------------
    ip-172-31-35-170 âŸµ Tunnel

    $ tsh ssh root@ip-172-31-35-170
    root@ip-172-31-35-170:~#
    ```

Once the above prerequisites are met, begin with the following step.

## Step 1/2. Update role to enforce Device Trust

First, let's fetch the default preset `access` role so we can configure it with device trust:

```code
$ tctl get roles/access > access.yaml
```

<Admonition type="warning" title="Device Role">

For simplicity, this guide works on the default preset `access` role. If other users in
your cluster are already assigned with this `access` role to access resources, and you do
not want to enforce device trust for them yet, create a separate `device-enforcment`
role and use that role for testing to avoid disruption.
</Admonition>

Update role with device mode "required" ``spec.options.device_trust_mode.required``.

```diff
$ vi access.yaml
kind: role
version: v6
metadata:
  labels:
    teleport.internal/resource-type: preset
  name: access
spec:
  allow:
    logins: ['root']
    ...
  options:
    # require authenticated device check for this role
+   device_trust_mode: "required" # add this line
    ...
  deny:
    ...

```

Save and update the role:
```code
$ tctl create -f access.yaml
```

Now that the `access` role is configured with device mode "required", users with
this role will be enforced with Device Trust.

```code
$ tsh logout; tsh login --proxy=teleport.example.com --user=myuser

$ tsh ssh root@ip-172-31-35-170
ERROR: access denied to root connecting to ip-172-31-35-170
```

As you can verify from the above step, access to `ip-172-31-35-170` ssh server,
which was previously accessible, is now forbidden.

## Step 2/2. Enroll Device
To access `ip-172-31-35-170` ssh server again, you will have to enroll your device.

Enrolling your device is easy, and can be done using `tsh` client:
```code
$ tsh enroll device --current-device
Device "C01FS22RMD6Y"/macOS enrolled
```

<Admonition type="note" title="self enrollment">
`--current-device` flag tells `tsh` to enroll current device. User must have `editor` role to be able
to self-enroll their device. For user's without the `editor` role, an erollment token must be generated by
cluster admin, which can then be used to enroll the device. Learn more about manual device operation in
[device management guide](./device-management.mdx)
</Admonition>

<Admonition type="note" title="Windows">
On Windows, the `tsh device enroll` command attempts to elevate to
administrator privileges on the device. Privilege elevation is required to
perform a TPM Credential Activation. This step is only required for
enrollment and is not required on future device authentications.
</Admonition>

Relogin to fetch updated certificate with device extension:

```code
$ tsh logout; tsh login --proxy=teleport.example.com --user=myuser

$ tsh status
> Profile URL:        https://tele.example.com:443
  Logged in as:       myuser
  Cluster:            tele.example.com:443
  Roles:              access, auditor, editor
  Logins:             root
  Kubernetes:         enabled
  Valid until:        2023-08-22 04:06:53 -0400 EDT [valid for 12h0m0s]
  Extensions:         login-ip, ... teleport-device-asset-tag, teleport-device-credential-id, teleport-device-id
```

The presence of the `teleport-device-*` extensions shows that the device was successfully authenticated.

Now, let's try to access ssh server (`ip-172-31-35-170`) again:
```bash
$ tsh ssh root@ip-172-31-35-170
root@ip-172-31-35-170:~#
```

Congratulations! You have successfuly configured a Trusted Device and accessed a resource protected with
Device Trust enforcement.

## Next steps
- [Device Registration and Enrollment](./device-management.mdx)
- [Device Trust Enforcement](./enforcing-device-trust.mdx)
- [Jamf Pro Integration](./jamf-integration.mdx)