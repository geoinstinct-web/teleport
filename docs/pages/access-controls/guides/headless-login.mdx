---
title: Headless Login (Preview)
description: Headless Login
---

## Introduction

<Admonition type="warning" title="Preview">
  Headless Login is currently in Preview mode.
</Admonition>

Headless Login provides Teleport users with a secure way to authenticate with WebAuthn from a remote machine. This enables use cases which usually are not compatible with WebAuthn features, such as:

* Logging into Teleport with WebAuthn from a remote dev box
* Connecting to a Teleport Node from a remote dev box with Per-session MFA 
* Performing `tsh scp` from one Teleport Node to another with Per-session MFA

<Admonition type="note" title="Headless Login Support">
  Headless Login only supports following `tsh` commands:
  
  * `tsh ls`
  * `tsh ssh`
  * `tsh scp`

  In the future, Headless Login may be extended to other `tsh` commands.
</Admonition>

## Prerequisites

- A Teleport cluster with WebAuthn configured.
  See the [Second Factor: WebAuthn](./webauthn.mdx) guide.
- WebAuthn hardware device, such as YubiKey or SoloKey.
- A Web browser with [WebAuthn support](
  https://developers.yubico.com/WebAuthn/WebAuthn_Browser_Support/).

A Teleport cluster capable of WebAuthn is automatically capable of Headless Login.

## Step 1/2. Initiate Headless Login

Run a headless tsh command with the `--headless` flag. This will initiate headless login, printing a URL and `tsh` command.

```code
$ tsh ls --headless --proxy=example --user=user
# Complete headless authentication in your local web browser:
# 
# https://proxy.example.com:3080/web/headless/86172f78-af7c-5935-a7c1-ed06b94f17dc
# 
# or execute this command in your local terminal:
# 
# tsh headless approve --user=dev --proxy=proxy.example.com:3080 86172f78-af7c-5935-a7c1-ed06b94f17dc
```

## Step 2/2. Approve Headless Login

To approve the headless login, go to the URL in your local web browser or enter the `tsh` command in your local terminal. You will be prompted to approve the login with WebAuthn verification. Once approved, your initial `tsh --headless <command>` should continue as if you had logged in locally.

## Additional Options

### Set Headless login as default

To make headless login the default authentication method for your Teleport Cluster, add `connector_name: headless` to your cluster configuration:


<ScopedBlock scope={["oss", "enterprise"]}>
<Tabs>
  <TabItem label="Static Config">
    Auth Server `teleport.yaml` file:

    ```yaml
    auth_service:
      authentication:
        type: local
        second_factor: on
        webauthn:
          rp_id: example.com
        connector_name: headless # headless by default
    ```
  </TabItem>
  <TabItem label="Dynamic resources">
    Create a `cap.yaml` file or get the existing configuration using
    `tctl get cluster_auth_preference`:

    ```yaml
    kind: cluster_auth_preference
    version: v2
    metadata:
      name: cluster-auth-preference
    spec:
      type: local
      second_factor: "on"
      webauthn:
        rp_id: example.com
      connector_name: headless # headless by default
    ```

    Update the configuration:

    ```code
    $ tctl create -f cap.yaml
    # cluster auth preference has been updated
    ```
  </TabItem>
</Tabs>
</ScopedBlock>

<ScopedBlock scope={["cloud"]}>
Create a `cap.yaml` file or get the existing configuration using
`tctl get cluster_auth_preference`:

```yaml
kind: cluster_auth_preference
version: v2
metadata:
  name: cluster-auth-preference
spec:
  type: local
  second_factor: "on"
  webauthn:
    rp_id: example.com
  connector_name: headless # headless by default
```

Update the configuration:

```code
$ tctl create -f cap.yaml
# cluster auth preference has been updated
```
</ScopedBlock>

### Set environment variable

Users can also set the following environment variables to reduce the number of flags passed to `tsh`:

* `TELEPORT_PROXY` (string)
* `TELEPORT_USER` (string)
* `TELEPORT_HEADLESS` (bool)

### Disable Headless Login

Headless Login is enabled automatically when WebAuthn is configured. If you want to forbid headless login to your cluster, add `headless: false` to your configuration:

<ScopedBlock scope={["oss", "enterprise"]}>
<Tabs>
  <TabItem label="Static Config">
    Auth Server `teleport.yaml` file:

    ```yaml
    # snippet from /etc/teleport.yaml:
    auth_service:
      authentication:
        type: local
        second_factor: on
        webauthn:
          rp_id: example.com
        headless: false # disable headless login
    ```
  </TabItem>
  <TabItem label="Dynamic resources">
    Create a `cap.yaml` file or get the existing configuration using
    `tctl get cluster_auth_preference`:

    ```yaml
    kind: cluster_auth_preference
    version: v2
    metadata:
      name: cluster-auth-preference
    spec:
      type: local
      second_factor: "on"
      webauthn:
        rp_id: example.com
      headless: false # disable headless login
    ```

    Update the configuration:

    ```code
    $ tctl create -f cap.yaml
    # cluster auth preference has been updated
    ```
  </TabItem>
</Tabs>
</ScopedBlock>

<ScopedBlock scope={["cloud"]}>
Create a `cap.yaml` file or get the existing configuration using
`tctl get cluster_auth_preference`:

```yaml
kind: cluster_auth_preference
version: v2
metadata:
  name: cluster-auth-preference
spec:
  type: local
  second_factor: "on"
  webauthn:
    rp_id: example.com
  headless: false # disable headless login
```

Update the configuration:

```code
$ tctl create -f cap.yaml
# cluster auth preference has been updated
```
</ScopedBlock>
