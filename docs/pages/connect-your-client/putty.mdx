---
title: Using PuTTY to connect to SSH nodes via Teleport
description: This reference shows you how to use PuTTY to connect to SSH nodes via Teleport
---

This guide will show you how to use the Teleport client tool `tsh` to add saved sessions for use
with [PuTTY](https://www.putty.org/), then use PuTTY as a client to connect to SSH nodes.

You will learn how to:

- Generate saved PuTTY sessions for SSH nodes attached to a Teleport cluster.
- Log in to an interactive shell using these saved PuTTY sessions.


## Prerequisites

- A client machine running Windows 10 or higher (`tsh` support for adding saved sessions to PuTTY is only implemented for Windows)
- The Teleport `tsh.exe` client version 14.0.0 or higher installed

  ```code
  $ curl.exe -O https://cdn.teleport.dev/teleport-v(=teleport.version=)-windows-amd64-bin.zip
  # Unzip the archive and move `tsh.exe` to your %PATH%
  ```
- PuTTY for Windows version 0.78 or higher installed (you can [download PuTTY here](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html))


## Summary

To be able to add saved sessions to PuTTY, you will need an active `tsh` login.

<ScopedBlock scope={["oss","enterprise"]}>

```bash
# Log into a Teleport cluster. This command retrieves the user's certificates
# and saves them into %USERPROFILE%/.tsh/teleport.example.com
C:\Users\gus>tsh login --proxy=teleport.example.com
...

# List SSH nodes that the user can connect to inside the cluster
C:\Users\gus>tsh ls
Node Name                           Address        Labels
----------------------------------- -------------- ----------------------------
ip-172-31-30-140                    127.0.0.1:3022 company=acmecorp,env=aws,...
ip-172-31-34-128.us-east-2.compu... ⟵ Tunnel      access=open,enhanced_reco...


# Add a saved session for the login 'ubuntu' on the node 'ip-172-31-30-140' to the Windows registry
# If you do not provide a login to this command, your local Windows username will be used
# instead ('gus' in this example)
C:\Users\gus>tsh puttyconfig ubuntu@ip-172-31-30-140
Added PuTTY session for ubuntu@ip-172-31-30-140 [proxy:teleport.example.com]
```

</ScopedBlock>
<ScopedBlock scope={["cloud"]}>

```bash
# Log into a Teleport cluster. This command retrieves the user's certificates
# and saves them into %USERPROFILE%/.tsh/mytenant.teleport.sh
C:\Users\gus>tsh login --proxy=mytenant.teleport.sh
...

# List SSH nodes that the user can connect to inside the cluster
C:\Users\gus>tsh ls
Node Name                           Address        Labels
----------------------------------- -------------- ----------------------------
ip-172-31-30-140                    ⟵ Tunnel      company=acmecorp,env=aws,...
ip-172-31-34-128.us-east-2.compu... ⟵ Tunnel      access=open,enhanced_reco...

# Add a saved session for the login 'ubuntu' on the node 'ip-172-31-30-140' to the Windows registry
# If you do not provide a login to this command, your local Windows username will be used
# instead ('gus' in this example)
C:\Users\gus>tsh puttyconfig ubuntu@ip-172-31-30-140
Added PuTTY session for ubuntu@ip-172-31-30-140 [proxy:mytenant.teleport.sh]
```

</ScopedBlock>


## Use a saved session to connect with PuTTY

Starting PuTTY will show you the available saved sessions for your cluster.

<Figure width="452" height="437" caption="Main PuTTY window">
![Main PuTTY window](../../img/connect-your-client/putty-window.png)
</Figure>

Double-clicking a session will connect you to the host (via Teleport).

<Figure width="661" height="418" caption="PuTTY console">
![PuTTY console](../../img/connect-your-client/putty-console.png)
</Figure>

This session will generate Teleport audit log entries for start and finish, appear in the list of
"Active Sessions" within Teleport, and if session recording is enabled for your cluster, a session
recording will be available when the session ends.

You can run `teleport status` inside a session to make sure that it is correctly connected via
the Teleport proxy and output the session's UUID for tracking.


## Leaf clusters

```bash
# List available leaf clusters
C:\Users\gus>tsh clusters
Cluster Name         Status Cluster Type Labels Selected
-----------------    ------ ------------ ------ --------
teleport.example.com online root                *
example.teleport.sh  online leaf
```

To access a leaf cluster via PuTTY, you can use the `--leaf <leaf cluster name>` parameter to `tsh puttyconfig`.

For example, if your leaf cluster is named `example.teleport.sh` and your node is called `ip-172-31-34-128.us-east-2.compute.internal`,
you can add a PuTTY session for the login `ec2-user` using the following command:

```bash
C:\Users\gus>tsh puttyconfig --leaf example.teleport.sh ec2-user@ip-172-31-34-128.us-east-2.compute.internal
Added PuTTY session for ec2-user@ip-172-31-34-128.us-east-2.compute.internal [leaf:webby.teleport.sh,proxy:teleport.example.com]
```


## Session naming

Sessions are named using the following schema:

Root clusters: `<login>@<hostname> [proxy:<proxy address>]`

Leaf clusters: `<login>@<hostname> [leaf:<leaf cluster name>,proxy:<proxy address>]`

## Frequently asked questions

#### Do I need administrator rights on my machine to run `tsh puttyconfig`?

No, `tsh` only makes changes to the `HKEY_CURRENT_USER` registry key.

#### Can I add saved PuTTY sessions for all users on a machine?

No, sessions are only added for the current user. You can export the sessions for another user to import using the
registry export method described below.

#### Can I export my saved PuTTY sessions to another machine?

Yes, use the Registry Editor to export the `HKEY_CURRENT_USER\Software\SimonTatham\PuTTY` registry key to a file
and import this file on another machine. Note that you will need admin rights to run Registry Editor.

#### Can I change the font size, window size or other preference for my saved PuTTY sessions?

Once a session has been added, you can make any desired modifications in the PuTTY UI by clicking the session name in the
"Saved sessions" list, then clicking "Load". Make all the necessary changes, then choose the session again and click "Save".

#### If I re-run `tsh puttyconfig` for a given host, will it overwrite any custom changes I've made to the saved session?

Teleport will only modify the config parameters that it relies on, like proxy name, proxy command, hostname, username etc.
Any changes to font size, window size and other parameters will be untouched.

#### Can I use other graphical clients like MobaXterm or SecureCRT?

Only PuTTY support is implemented at present. Most other graphical clients do not fully support the use of both SSH user
certificates and SSH host certificates for authentication which is a requirement to use Teleport.

Please contact the authors of those clients if you wish to see support for Teleport sessions added.

#### Can I use forks of PuTTY like KiTTY or Solar PuTTY?

If the fork uses PuTTY 0.78 or higher as its base, it may work. However, the Teleport team only tests stock versions of PuTTY
and cannot provide support for forked versions.

#### Can I use my saved Teleport PuTTY sessions with WinSCP?

At the time of writing, WinSCP has not implemented support for validation of host certificates, which means WinSCP is unable
to connect via Teleport.

You can track the status of this feature request and vote for it on the WinSCP bug tracker: https://winscp.net/tracker/2145

#### Can I use an alternative Teleport authentication method (`tsh login --auth`) with saved sessions?

No, PuTTY calls `tsh proxy ssh` which will use the default authentication method configured for the Teleport cluster.

You can see [Teleport's documentation on authentication options here](../reference/authentication.mdx).

Advanced users can use the Registry Editor to modify the PuTTY proxy command themselves under the `ProxyTelnetCommand`
key. Note that if you re-run `tsh puttyconfig` for the given hostname, this command will be overwritten.

## Troubleshooting

#### `proxy: ERROR: access denied to <user> connecting to <proxy>`

You have provided an incorrect login username to the `tsh puttyconfig` command. Re-run the command with a login username
that your Teleport user/role has permissions to use, i.e. set under the `logins` role specification or user trait.

If you can log in successfully with `tsh ssh`, you should be able to use the name login/hostname with `tsh puttyconfig`.

#### `proxy: ERROR: ssh: subsystem request failed`

The Teleport proxy is unable to connect to the given host/port provided in the saved session. This may mean that the node is
offline. Check that the node is visible in `tsh ls` and that you can connect to it with `tsh ssh login@hostname`. If this is
successful, check the Teleport proxy logs for more detailed errors.

#### `Unable to use certificate file "C:\Users\<username>\.tsh\keys\<proxy>\<user>-ssh\<cluster>-cert.pub" (unable to open file)`

You are not logged into Teleport correctly. Run `tsh login --proxy=<proxy hostname>` to get valid certificates before
trying to start a PuTTY saved session.

Note that if you are using a saved session for a leaf cluster via a root cluster's proxy, you must log into the root cluster
itself to be able to start a session against the leaf cluster.

#### `ERROR: No proxy address specified, missed --proxy flag?`

You do not have valid `tsh` credentials locally. Run `tsh login --proxy=<proxy hostname>` to log in first, or provide the `--proxy`
parameter when running `tsh puttyconfig`.


## Uninstalling tsh

To remove `tsh` and associated user data see
[Uninstalling Teleport](../management/admin/uninstall-teleport.mdx).

## Further reading
- [CLI Reference](../reference/cli.mdx#tsh-puttyconfig).

