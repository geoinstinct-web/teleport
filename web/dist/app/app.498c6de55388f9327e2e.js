!function(e){function t(t){for(var r,i,s=t[0],u=t[1],c=t[2],f=0,p=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/web/app";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;a.push([0,1]),n()}({0:function(e,t,n){e.exports=n("rVcD")},"7WIf":function(e,t,n){},BBHA:function(e,t,n){e.exports.getters=n("F+qq"),e.exports.actions=n("VW/0")},CtRu:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return h}));var r=n("xSHT"),o=n("Z9Rw"),a=n("LMli"),i=n("wd/R"),s=n.n(i),u=n("i3tb"),c=n("lZJN"),l=n("zMbK"),f=c.a.create("Modules/Sessions");function p(e,t){e=e||s()(new Date).endOf("day").toDate(),t=t||s()(t).subtract(3,"day").startOf("day").toDate(),e=e.toISOString(),t=t.toISOString();var n=r.a.evaluate(u.a.siteId);return o.a.get(a.a.api.getSiteEventsFilterUrl({start:e,end:t,siteId:n})).done((function(e){e&&e.events&&r.a.dispatch(l.b,{siteId:n,json:e.events})})).fail((function(e){f.error("fetchSiteEvents",e)}))}function h(){var e=r.a.evaluate(u.a.siteId);return o.a.get(a.a.api.getFetchSessionsUrl(e)).done((function(t){var n=t.sessions||[];r.a.dispatch(l.a,{siteId:e,json:n})})).fail((function(e){f.error("fetchActiveSessions",e)}))}},"F+qq":function(e,t,n){"use strict";n.r(t);t.default={filter:[["tlpt_sessions_filter"],function(e){return e.toJS()}]}},KdfW:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={TOKEN:"grv_teleport_token",TOKEN_RENEW:"grv_teleport_token_renew"},o={clear:function(){window.localStorage.clear()},subscribe:function(e){window.addEventListener("storage",e)},unsubscribe:function(e){window.removeEventListener("storage",e)},setBearerToken:function(e){window.localStorage.setItem(r.TOKEN,JSON.stringify(e))},getBearerToken:function(){var e=window.localStorage.getItem(r.TOKEN);return e?JSON.parse(e):null},broadcast:function(e,t){window.localStorage.setItem(e,t),window.localStorage.removeItem(e)}};t.b=o},LMli:function(e,t,n){"use strict";var r=n("cIpc"),o=n("K5fH"),a=n.n(o),i=n("gOk0"),s={baseUrl:Object(i.a)()?"localhost":window.location.origin,helpUrl:"https://gravitational.com/teleport/docs/quickstart/",maxSessionLoadSize:50,displayDateFormat:"MM/DD/YYYY HH:mm:ss",auth:{},canJoinSessions:!0,routes:{app:"/web",login:"/web/login",nodes:"/web/nodes",currentSession:"/web/cluster/:siteId/sessions/:sid",sessions:"/web/sessions",newUser:"/web/newuser/:inviteToken",error:"/web/msg/error(/:type)",info:"/web/msg/info(/:type)",pageNotFound:"/web/notfound",terminal:"/web/cluster/:siteId/node/:serverId/:login(/:sid)",player:"/web/player/cluster/:siteId/sid/:sid",webApi:"/v1/webapi/*",settingsBase:"/web/settings",settingsAccount:"/web/settings/account"},api:{scp:"/v1/webapi/sites/:siteId/nodes/:serverId/:login/scp?location=:location&filename=:filename",ssoOidc:"/v1/webapi/oidc/login/web?redirect_url=:redirect&connector_id=:providerName",ssoSaml:"/v1/webapi/saml/sso?redirect_url=:redirect&connector_id=:providerName",renewTokenPath:"/v1/webapi/sessions/renew",sessionPath:"/v1/webapi/sessions",userContextPath:"/v1/webapi/user/context",userStatusPath:"/v1/webapi/user/status",invitePath:"/v1/webapi/users/invites/:inviteToken",createUserPath:"/v1/webapi/users",changeUserPasswordPath:"/v1/webapi/users/password",u2fCreateUserChallengePath:"/v1/webapi/u2f/signuptokens/:inviteToken",u2fCreateUserPath:"/v1/webapi/u2f/users",u2fSessionChallengePath:"/v1/webapi/u2f/signrequest",u2fChangePassChallengePath:"/v1/webapi/u2f/password/changerequest",u2fChangePassPath:"/v1/webapi/u2f/password",u2fSessionPath:"/v1/webapi/u2f/sessions",sitesBasePath:"/v1/webapi/sites",sitePath:"/v1/webapi/sites/:siteId",nodesPath:"/v1/webapi/sites/:siteId/nodes",siteSessionPath:"/v1/webapi/sites/:siteId/sessions",sessionEventsPath:"/v1/webapi/sites/:siteId/sessions/:sid/events",siteEventSessionFilterPath:"/v1/webapi/sites/:siteId/sessions",siteEventsFilterPath:"/v1/webapi/sites/:siteId/events?event=session.start&event=session.end&from=:start&to=:end",ttyWsAddr:":fqdm/v1/webapi/sites/:cluster/connect?access_token=:token&params=:params",getSiteUrl:function(e){return Object(r.a)(s.api.sitePath,{siteId:e})},getSiteNodesUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-current-";return Object(r.a)(s.api.nodesPath,{siteId:e})},getSiteSessionUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-current-";return Object(r.a)(s.api.siteSessionPath,{siteId:e})},getSsoUrl:function(e,t,n){return s.baseUrl+Object(r.a)(e,{redirect:n,providerName:t})},getSiteEventsFilterUrl:function(e){var t=e.start,n=e.end,o=e.siteId;return Object(r.a)(s.api.siteEventsFilterPath,{start:t,end:n,siteId:o})},getSessionEventsUrl:function(e){var t=e.sid,n=e.siteId;return Object(r.a)(s.api.sessionEventsPath,{sid:t,siteId:n})},getScpUrl:function(e){var t=e.siteId,n=e.serverId,o=e.login,a=e.location,i=e.filename;return Object(r.a)(s.api.scp,{siteId:t,serverId:n,login:o,location:a,filename:i})},getFetchSessionsUrl:function(e){return Object(r.a)(s.api.siteEventSessionFilterPath,{siteId:e})},getFetchSessionUrl:function(e){var t=e.sid,n=e.siteId;return Object(r.a)(s.api.siteSessionPath+"/:sid",{sid:t,siteId:n})},getInviteUrl:function(e){return Object(r.a)(s.api.invitePath,{inviteToken:e})},getU2fCreateUserChallengeUrl:function(e){return Object(r.a)(s.api.u2fCreateUserChallengePath,{inviteToken:e})}},getPlayerUrl:function(e){var t=e.siteId,n=e.sid;return Object(r.a)(s.routes.player,{siteId:t,sid:n})},getTerminalLoginUrl:function(e){var t=e.siteId,n=e.serverId,o=e.login,a=e.sid;if(!a){var i=this.stripOptionalParams(s.routes.terminal);return Object(r.a)(i,{siteId:t,serverId:n,login:o})}return Object(r.a)(s.routes.terminal,{siteId:t,serverId:n,login:o,sid:a})},getCurrentSessionRouteUrl:function(e){var t=e.sid,n=e.siteId;return Object(r.a)(s.routes.currentSession,{sid:t,siteId:n})},getAuthProviders:function(){return s.auth&&s.auth.providers?s.auth.providers:[]},getAuth2faType:function(){return s.auth?s.auth.second_factor:null},getU2fAppId:function(){return s.auth&&s.auth.u2f?s.auth.u2f.app_id:null},getWsHostName:function(){return""+("https:"===location.protocol?"wss://":"ws://")+(location.hostname+(location.port?":"+location.port:""))},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.a.extend(!0,this,e)},stripOptionalParams:function(e){return e.replace(/\(.*\)/,"")}};t.a=s},LYgY:function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"e",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return u}));var r="TRYING_TO_SIGN_UP",o="TRYING_TO_LOGIN",a="FETCHING_INVITE",i="TRYING_TO_INIT_APP",s="TRYING_TO_INIT_SETTINGS",u="TRYING_TO_CHANGE_PSW"},OcN7:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r="TLPT_STORED_SESSINS_FILTER_SET_RANGE"},PVWJ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("L7e8"),o=n("tGXY"),a=n("JPcv"),i=new a.Record({isProcessing:!1,isFailed:!1,isSuccess:!1,message:""});function s(e,t){return e.set(t.type,new i({isProcessing:!0}))}function u(e,t){return e.set(t.type,new i({isFailed:!0,message:t.message}))}function c(e,t){return e.set(t.type,new i({isSuccess:!0,message:t.message}))}function l(e,t){return e.set(t.type,new i)}t.b=Object(r.Store)({getInitialState:function(){return Object(r.toImmutable)({})},initialize:function(){this.on(o.c,s),this.on(o.b,u),this.on(o.d,c),this.on(o.a,l)}})},RnhZ:function(e,t,n){var r={"./af":"K/tc","./af.js":"K/tc","./ar":"jnO4","./ar-dz":"o1bE","./ar-dz.js":"o1bE","./ar-kw":"Qj4J","./ar-kw.js":"Qj4J","./ar-ly":"HP3h","./ar-ly.js":"HP3h","./ar-ma":"CoRJ","./ar-ma.js":"CoRJ","./ar-sa":"gjCT","./ar-sa.js":"gjCT","./ar-tn":"bYM6","./ar-tn.js":"bYM6","./ar.js":"jnO4","./az":"SFxW","./az.js":"SFxW","./be":"H8ED","./be.js":"H8ED","./bg":"hKrs","./bg.js":"hKrs","./bm":"p/rL","./bm.js":"p/rL","./bn":"kEOa","./bn.js":"kEOa","./bo":"0mo+","./bo.js":"0mo+","./br":"aIdf","./br.js":"aIdf","./bs":"JVSJ","./bs.js":"JVSJ","./ca":"1xZ4","./ca.js":"1xZ4","./cs":"PA2r","./cs.js":"PA2r","./cv":"A+xa","./cv.js":"A+xa","./cy":"l5ep","./cy.js":"l5ep","./da":"DxQv","./da.js":"DxQv","./de":"tGlX","./de-at":"s+uk","./de-at.js":"s+uk","./de-ch":"u3GI","./de-ch.js":"u3GI","./de.js":"tGlX","./dv":"WYrj","./dv.js":"WYrj","./el":"jUeY","./el.js":"jUeY","./en-au":"Dmvi","./en-au.js":"Dmvi","./en-ca":"OIYi","./en-ca.js":"OIYi","./en-gb":"Oaa7","./en-gb.js":"Oaa7","./en-ie":"4dOw","./en-ie.js":"4dOw","./en-nz":"b1Dy","./en-nz.js":"b1Dy","./eo":"Zduo","./eo.js":"Zduo","./es":"iYuL","./es-do":"CjzT","./es-do.js":"CjzT","./es-us":"Vclq","./es-us.js":"Vclq","./es.js":"iYuL","./et":"7BjC","./et.js":"7BjC","./eu":"D/JM","./eu.js":"D/JM","./fa":"jfSC","./fa.js":"jfSC","./fi":"gekB","./fi.js":"gekB","./fo":"ByF4","./fo.js":"ByF4","./fr":"nyYc","./fr-ca":"2fjn","./fr-ca.js":"2fjn","./fr-ch":"Dkky","./fr-ch.js":"Dkky","./fr.js":"nyYc","./fy":"cRix","./fy.js":"cRix","./gd":"9rRi","./gd.js":"9rRi","./gl":"iEDd","./gl.js":"iEDd","./gom-latn":"DKr+","./gom-latn.js":"DKr+","./gu":"4MV3","./gu.js":"4MV3","./he":"x6pH","./he.js":"x6pH","./hi":"3E1r","./hi.js":"3E1r","./hr":"S6ln","./hr.js":"S6ln","./hu":"WxRl","./hu.js":"WxRl","./hy-am":"1rYy","./hy-am.js":"1rYy","./id":"UDhR","./id.js":"UDhR","./is":"BVg3","./is.js":"BVg3","./it":"bpih","./it.js":"bpih","./ja":"B55N","./ja.js":"B55N","./jv":"tUCv","./jv.js":"tUCv","./ka":"IBtZ","./ka.js":"IBtZ","./kk":"bXm7","./kk.js":"bXm7","./km":"6B0Y","./km.js":"6B0Y","./kn":"PpIw","./kn.js":"PpIw","./ko":"Ivi+","./ko.js":"Ivi+","./ky":"lgnt","./ky.js":"lgnt","./lb":"RAwQ","./lb.js":"RAwQ","./lo":"sp3z","./lo.js":"sp3z","./lt":"JvlW","./lt.js":"JvlW","./lv":"uXwI","./lv.js":"uXwI","./me":"KTz0","./me.js":"KTz0","./mi":"aIsn","./mi.js":"aIsn","./mk":"aQkU","./mk.js":"aQkU","./ml":"AvvY","./ml.js":"AvvY","./mr":"Ob0Z","./mr.js":"Ob0Z","./ms":"6+QB","./ms-my":"ZAMP","./ms-my.js":"ZAMP","./ms.js":"6+QB","./my":"honF","./my.js":"honF","./nb":"bOMt","./nb.js":"bOMt","./ne":"OjkT","./ne.js":"OjkT","./nl":"+s0g","./nl-be":"2ykv","./nl-be.js":"2ykv","./nl.js":"+s0g","./nn":"uEye","./nn.js":"uEye","./pa-in":"8/+R","./pa-in.js":"8/+R","./pl":"jVdC","./pl.js":"jVdC","./pt":"8mBD","./pt-br":"0tRk","./pt-br.js":"0tRk","./pt.js":"8mBD","./ro":"lyxo","./ro.js":"lyxo","./ru":"lXzo","./ru.js":"lXzo","./sd":"Z4QM","./sd.js":"Z4QM","./se":"//9w","./se.js":"//9w","./si":"7aV9","./si.js":"7aV9","./sk":"e+ae","./sk.js":"e+ae","./sl":"gVVK","./sl.js":"gVVK","./sq":"yPMs","./sq.js":"yPMs","./sr":"zx6S","./sr-cyrl":"E+lV","./sr-cyrl.js":"E+lV","./sr.js":"zx6S","./ss":"Ur1D","./ss.js":"Ur1D","./sv":"X709","./sv.js":"X709","./sw":"dNwA","./sw.js":"dNwA","./ta":"PeUW","./ta.js":"PeUW","./te":"XLvN","./te.js":"XLvN","./tet":"V2x9","./tet.js":"V2x9","./th":"EOgW","./th.js":"EOgW","./tl-ph":"Dzi0","./tl-ph.js":"Dzi0","./tlh":"z3Vd","./tlh.js":"z3Vd","./tr":"DoHr","./tr.js":"DoHr","./tzl":"z1FC","./tzl.js":"z1FC","./tzm":"wQk9","./tzm-latn":"tT3J","./tzm-latn.js":"tT3J","./tzm.js":"wQk9","./uk":"raLr","./uk.js":"raLr","./ur":"UpQW","./ur.js":"UpQW","./uz":"Loxo","./uz-latn":"AQ68","./uz-latn.js":"AQ68","./uz.js":"Loxo","./vi":"KSF8","./vi.js":"KSF8","./x-pseudo":"/X5v","./x-pseudo.js":"/X5v","./yo":"fzPg","./yo.js":"fzPg","./zh-cn":"XDpg","./zh-cn.js":"XDpg","./zh-hk":"SatO","./zh-hk.js":"SatO","./zh-tw":"kOpN","./zh-tw.js":"kOpN"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="RnhZ"},"VW/0":function(e,t,n){"use strict";n.r(t),n.d(t,"fetchSiteEventsWithinTimeRange",(function(){return u})),n.d(t,"setTimeRange",(function(){return c}));var r=n("xSHT"),o=n("F+qq"),a=n("CtRu"),i=n("OcN7"),s=n("lZJN").a.create("Modules/Sessions");function u(){var e=r.a.evaluate(o.default.filter);return l(e.start,e.end)}function c(e,t){r.a.batch((function(){r.a.dispatch(i.a,{start:e,end:t}),l(e,t)}))}function l(e,t){return Object(a.b)(e,t).fail((function(e){s.error("fetching filtered set of sessions",e)}))}},Z9Rw:function(e,t,n){"use strict";var r=n("K5fH"),o=n.n(r),a=n("KdfW"),i={put:function(e,t){return i.ajax({url:e,data:JSON.stringify(t),type:"PUT"})},post:function(e,t){return i.ajax({url:e,data:JSON.stringify(t),type:"POST"})},delete:function(e,t){return i.ajax({url:e,data:JSON.stringify(t),type:"DELETE"})},get:function(e){return i.ajax({url:e})},ajax:function(e){var t=this,n={cache:!1,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(e){return t.setAuthHeaders(e)}};return o.a.ajax(o.a.extend({},n,e))},getErrorText:function(e){var t="Unknown error";return e instanceof Error?e.message||t:e.responseJSON&&e.responseJSON.message?e.responseJSON.message:e.responseJSON&&e.responseJSON.error?e.responseJSON.error.message||t:e.responseText?e.responseText:t},setAuthHeaders:function(e){var t=this.getAccessToken(),n=this.getXCSRFToken();e.setRequestHeader("X-CSRF-Token",n),e.setRequestHeader("Authorization","Bearer "+t)},setNoCacheHeaders:function(e){e.setRequestHeader("cache-control","max-age=0"),e.setRequestHeader("expires","0"),e.setRequestHeader("pragma","no-cache")},getAccessToken:function(){return(a.b.getBearerToken()||{}).accessToken},getXCSRFToken:function(){var e=document.querySelector("[name=grv_csrf_token]");return e?e.content:""}};t.a=i},cIpc:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return c}));var r=n("QLaP"),o=n.n(r);function a(e){return function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(e).replace(/\/+/g,"/+")}var i={};function s(e){return e in i||(i[e]=function(e){for(var t="",n=[],r=[],o=void 0,i=0,s=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|\*\*|\*|\(|\)/g;o=s.exec(e);)o.index!==i&&(r.push(e.slice(i,o.index)),t+=a(e.slice(i,o.index))),o[1]?(t+="([^/?#]+)",n.push(o[1])):"**"===o[0]?(t+="([\\s\\S]*)",n.push("splat")):"*"===o[0]?(t+="([\\s\\S]*?)",n.push("splat")):"("===o[0]?t+="(?:":")"===o[0]&&(t+=")?"),r.push(o[0]),i=s.lastIndex;return i!==e.length&&(r.push(e.slice(i,e.length)),t+=a(e.slice(i,e.length))),{pattern:e,regexpSource:t,paramNames:n,tokens:r}}(e)),i[e]}function u(e,t){"/"!==e.charAt(0)&&(e="/"+e),"/"!==t.charAt(0)&&(t="/"+t);var n=s(e),r=n.regexpSource,o=n.paramNames,a=n.tokens;r+="/*";var i="*"!==a[a.length-1];i&&(r+="([\\s\\S]*?)");var u=t.match(new RegExp("^"+r+"$","i")),c=void 0,l=void 0;if(null!=u){if(i){c=u.pop();var f=u[0].substr(0,u[0].length-c.length);if(c&&"/"!==f.charAt(f.length-1))return{remainingPathname:null,paramNames:o,paramValues:null}}else c="";l=u.slice(1).map((function(e){return null!=e?decodeURIComponent(e):e}))}else c=l=null;return{remainingPathname:c,paramNames:o,paramValues:l}}function c(e,t){t=t||{};for(var n=s(e).tokens,r=0,a="",i=0,u=void 0,c=void 0,l=void 0,f=0,p=n.length;f<p;++f)"*"===(u=n[f])||"**"===u?(l=Array.isArray(t.splat)?t.splat[i++]:t.splat,o()(null!=l||r>0,'Missing splat #%s for path "%s"',i,e),null!=l&&(a+=encodeURI(l))):"("===u?r+=1:")"===u?r-=1:":"===u.charAt(0)?(l=t[c=u.substring(1)],o()(null!=l||r>0,'Missing "%s" parameter for path "%s"',c,e),null!=l&&(a+=encodeURIComponent(l))):a+=u;return a.replace(/\/+/g,"/")}},gOk0:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));var r=function(){return"test"===e.env.NODE_ENV_TYPE}}).call(this,n("8oxB"))},i3tb:function(e,t,n){"use strict";var r=n("oHDm");t.a={initAttempt:r.c,siteId:["tlpt","siteId"]}},lZJN:function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t}return r(e,[{key:"log",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"log",n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=window.console)[t].apply(e,["%c["+this.name+"]","color: blue;"].concat(r))}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["trace"].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["warn"].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["info"].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["error"].concat(t))}}]),e}();t.a={create:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(o,[null].concat(t)))}}},oHDm:function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"a",(function(){return l}));var r=n("PVWJ"),o=n("LYgY"),a=function(e){return[["tlpt_status",e],function(e){return e||new r.a}]},i=a(o.c),s=a(o.e),u=a(o.a),c=a(o.f),l=(a(o.d),a(o.b))},rVcD:function(e,t,n){"use strict";n.r(t);var r=n("sbe7"),o=n.n(r),a=n("i8i4"),i=n.n(a),s=n("0cfB"),u=n("l2sx"),c=n("sIaI"),l=n("LMli"),f=n("cIpc"),p=null,h={original:function(){return p},init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.browserHistory;p=e},push:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=this.ensureSafeRoute(e),t?this._pageRefresh(e):p.push(e)},goBack:function(e){this.original().goBack(e)},goToLogin:function(e){var t=l.a.routes.login;if(e){var n=p.getCurrentLocation(),r=p.createHref(n);r=this.ensureSafeRoute(r),t=t+"?redirect_uri="+(r=this.ensureBaseUrl(r))}this._pageRefresh(t)},getRedirectParam:function(){var e=this.original().getCurrentLocation();return e.query&&e.query.redirect_uri?e.query.redirect_uri:""},ensureSafeRoute:function(e){return e=this._canPush(e)?e:l.a.routes.app},ensureBaseUrl:function(e){return 0!==(e=e||"").indexOf(l.a.baseUrl)&&(e=l.a.baseUrl+e),e},getRoutes:function(){return Object.getOwnPropertyNames(l.a.routes).map((function(e){return l.a.routes[e]}))},_canPush:function(e){e=e||"";var t=this.getRoutes();return 0===e.indexOf(l.a.baseUrl)&&(e=e.replace(l.a.baseUrl,"")),t.some(d(e))},_pageRefresh:function(e){window.location.href=this.ensureBaseUrl(e)}},d=function(e){return function(t){var n=Object(f.b)(t,e).remainingPathname;return null!==n&&0===n.length}},v=h,m=n("xSHT"),y=n("K5fH"),b=n.n(y),g=(n("q1Yt"),n("Z9Rw")),w=(n("KDbw"),{login:function(e,t,n){var r={user:e,pass:t,second_factor_token:n};return g.a.post(l.a.api.sessionPath,r,!1)},loginWithU2f:function(e,t){var n={user:e,pass:t};return g.a.post(l.a.api.u2fSessionChallengePath,n,!1).then((function(t){var n=b.a.Deferred();return window.u2f.sign(t.appId,t.challenge,[t],(function(t){if(t.errorCode){var r=w._getU2fErr(t.errorCode);n.reject(r)}else{var o={user:e,u2f_sign_response:t};g.a.post(l.a.api.u2fSessionPath,o,!1).then((function(e){n.resolve(e)})).fail((function(e){n.reject(e)}))}})),n.promise()}))},loginWithU2fRecovery:function(e,t,n){var r={user:e,pass:t};return g.a.post(l.a.api.u2fSessionChallengePath,r,!1).then((function(){var t={user:e,u2f_sign_response:{signatureData:n}};return g.a.post(l.a.api.u2fSessionPath,t,!1)}))},acceptInvite:function(e,t,n,r){var o={invite_token:r,pass:t,second_factor_token:n,user:e};return g.a.post(l.a.api.createUserPath,o,!1)},acceptInviteWithU2f:function(e,t,n){return g.a.get(l.a.api.getU2fCreateUserChallengeUrl(n)).then((function(r){var o=b.a.Deferred();return window.u2f.register(r.appId,[r],[],(function(r){if(r.errorCode){var a=w._getU2fErr(r.errorCode);o.reject(a)}else{var i={user:e,pass:t,u2f_register_response:r,invite_token:n};g.a.post(l.a.api.u2fCreateUserPath,i,!1).then((function(e){o.resolve(e)})).fail((function(e){o.reject(e)}))}})),o.promise()}))},changePassword:function(e,t,n){var r={old_password:window.btoa(e),new_password:window.btoa(t),second_factor_token:n};return g.a.put(l.a.api.changeUserPasswordPath,r)},changePasswordWithU2f:function(e,t){var n={user:name,pass:e};return g.a.post(l.a.api.u2fChangePassChallengePath,n).then((function(e){var n=b.a.Deferred();return window.u2f.sign(e.appId,e.challenge,[e],(function(e){if(e.errorCode){var r=w._getU2fErr(e.errorCode);n.reject(r)}else{var o={new_password:window.btoa(t),u2f_sign_response:e};g.a.put(l.a.api.changeUserPasswordPath,o).then((function(e){n.resolve(e)})).fail((function(e){n.reject(e)}))}})),n.promise()}))},_getU2fErr:function(e){var t="";for(var n in window.u2f.ErrorCodes)window.u2f.ErrorCodes[n]==e&&(t=n);return{responseJSON:{message:"Please check your U2F settings, make sure it is plugged in and you are using the supported browser.\nU2F error: "+t}}}}),E=w,_=n("lZJN"),O=n("KdfW");var j=_.a.create("services/sessions"),k=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.accessToken=t.token,this.expiresIn=t.expires_in,this.created=(new Date).getTime()},P=null,S={logout:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];g.a.delete(l.a.api.sessionPath).always((function(){v.goToLogin(e)})),this.clear()},clear:function(){this._stopSessionChecker(),O.b.unsubscribe(T),O.b.setBearerToken(null),O.b.clear()},ensureSession:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._stopSessionChecker(),this._ensureLocalStorageSubscription();var n=this._getBearerToken();return n?this._shouldRenewToken()?this._renewToken().done(this._startSessionChecker.bind(this)).fail((function(){return e.logout(t)})):(this._startSessionChecker(),b.a.Deferred().resolve(n)):(this.logout(t),b.a.Deferred().reject())},_getBearerToken:function(){var e=null;try{(e=this._extractBearerTokenFromHtml())?O.b.setBearerToken(e):e=O.b.getBearerToken()}catch(e){j.error("Cannot find bearer token",e)}return e},_extractBearerTokenFromHtml:function(){var e=document.querySelector("[name=grv_bearer_token]"),t=null;if(null!==e){var n=e.content||"";if(n.length>20){var r=window.atob(n),o=JSON.parse(r);t=new k(o)}e.parentNode.removeChild(e)}return t},_shouldRenewToken:function(){return!this._getIsRenewing()&&this._timeLeft()<22500},_shouldCheckStatus:function(){return!this._getIsRenewing()&&this._timeLeft()>3e4},_renewToken:function(){var e=this;return this._setAndBroadcastIsRenewing(!0),g.a.post(l.a.api.renewTokenPath).then(this._receiveBearerToken.bind(this)).always((function(){e._setAndBroadcastIsRenewing(!1)}))},_receiveBearerToken:function(e){var t=new k(e);O.b.setBearerToken(t)},_fetchStatus:function(){var e=this;g.a.get(l.a.api.userStatusPath).fail((function(t){403==t.status&&e.logout()}))},_setAndBroadcastIsRenewing:function(e){this._setIsRenewing(e),O.b.broadcast(O.a.TOKEN_RENEW,e)},_setIsRenewing:function(e){this._isRenewing=e},_getIsRenewing:function(){return!!this._isRenewing},_timeLeft:function(){var e=this._getBearerToken();if(!e)return 0;var t=e.expiresIn,n=e.created;return n&&t?n+(t*=1e3)-(new Date).getTime():0},_ensureLocalStorageSubscription:function(){O.b.subscribe(T)},_startSessionChecker:function(){var e=this;this._stopSessionChecker(),P=setInterval((function(){e.ensureSession(),e._shouldCheckStatus()&&e._fetchStatus()}),15e3)},_stopSessionChecker:function(){clearInterval(P),P=null}};function T(e){var t=e.key,n=e.newValue;null===O.b.getBearerToken()&&S.logout(),t===O.a.TOKEN_RENEW&&n&&S._setIsRenewing(JSON.parse(n))}var C=S,N=n("tGXY"),I=n("LYgY");function x(e){return{start:function(){m.a.dispatch(N.c,{type:e})},success:function(t){m.a.dispatch(N.d,{type:e,message:t})},fail:function(t){m.a.dispatch(N.b,{type:e,message:t})},clear:function(){m.a.dispatch(N.a,{type:e})}}}var R=x(I.c),D=x(I.e),A=x(I.a),U=x(I.f),L=x(I.d),F=x(I.b),W="TLPT_RECEIVE_USER",z=_.a.create("flux/user/actions"),M={fetchInvite:function(e){var t=l.a.api.getInviteUrl(e);A.start(),g.a.get(t).done((function(e){A.success(),m.a.dispatch("TLPT_RECEIVE_USER_INVITE",e)})).fail((function(e){var t=g.a.getErrorText(e);A.fail(t)}))},ensureUser:function(e,t,n){C.ensureSession(!0).done((function(){n()}))},acceptInvite:function(e,t,n,r){var o=E.acceptInvite(e,t,n,r);M._handleAcceptInvitePromise(o)},acceptInviteWithU2f:function(e,t,n){var r=E.acceptInviteWithU2f(e,t,n);return M._handleAcceptInvitePromise(r)},loginWithSso:function(e,t){var n=this._getEntryRoute();v.push(l.a.api.getSsoUrl(t,e,n),!0)},loginWithU2f:function(e,t){var n=E.loginWithU2f(e,t);M._handleLoginPromise(n)},loginWithU2fRecovery:function(e,t,n){var r=E.loginWithU2fRecovery(e,t,n);M._handleLoginPromise(r)},login:function(e,t,n){var r=E.login(e,t,n);M._handleLoginPromise(r)},logout:function(){C.logout()},_handleAcceptInvitePromise:function(e){return U.start(),e.done((function(){v.push(l.a.routes.app,!0)})).fail((function(e){var t=g.a.getErrorText(e);z.error("accept invite",e),U.fail(t)}))},_handleLoginPromise:function(e){var t=this;D.start(),e.done((function(){var e=t._getEntryRoute();v.push(e,!0)})).fail((function(e){var t=g.a.getErrorText(e);z.error("login",e),D.fail(t)}))},_getEntryRoute:function(){var e=v.getRedirectParam();return e=e?v.ensureSafeRoute(e):l.a.routes.app,v.ensureBaseUrl(e)}},B=M,q=n("oHDm"),V="tlpt_user";function H(){return m.a.evaluate([V])}var K={userName:[V,"name"],invite:[["tlpt_user_invite"],function(e){return e}],pswChangeAttempt:q.a,loginAttemp:q.d,attemp:q.f,fetchingInvite:q.b},J=function(){return o.a.createElement("div",{className:"grv-google-auth text-left"},o.a.createElement("div",{className:"grv-icon-google-auth"}),o.a.createElement("strong",null,"Google Authenticator"),o.a.createElement("div",null,"Download",o.a.createElement("a",{href:"https://support.google.com/accounts/answer/1066447?hl=en",rel:"noreferrer"},o.a.createElement("span",null," Google Authenticator ")),"on your phone to access your two factor token"))},Y=n("TSYQ"),G=n.n(Y),Z=n("TglN"),X=n("Y9yc"),Q=function(){return o.a.createElement("svg",{className:"grv-icon-logo-tlpt"},o.a.createElement("use",{xlinkHref:"#"+Z.a.id}))},$=function(){return o.a.createElement("svg",{className:"grv-icon-close"},o.a.createElement("use",{xlinkHref:"#"+X.a.id}))},ee=function(e){var t=e.name,n=void 0===t?"":t,r=e.isDark,a=G()("grv-icon-user",{"--dark":r});return o.a.createElement("div",{title:n,className:a},o.a.createElement("span",null,o.a.createElement("strong",null,n[0])))},te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ie=function(e){function t(){return re(this,t),oe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ae(t,e),ne(t,[{key:"componentDidUpdate",value:function(e){e.title!==this.props.title&&this.setTitle(this.props.title)}},{key:"componentDidMount",value:function(){this.setTitle(this.props.title)}},{key:"getTitle",value:function(){return document.title}},{key:"setTitle",value:function(e){document.title=e}},{key:"render",value:function(){return this.props.children}}]),t}(o.a.Component),se=function(e,t){var n,r;return r=n=function(n){function r(){return re(this,r),oe(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return ae(r,n),ne(r,[{key:"componentDidMount",value:function(){this.setTitle(e)}},{key:"setTitle",value:function(e){document.title=e}},{key:"render",value:function(){return o.a.createElement(t,te({},this.props))}}]),r}(o.a.Component),n.displayName="withDocTitleWrapper",r},ue=function(e){var t=e.message;return-1!==(t=t||"").indexOf("U2F")?o.a.createElement("label",{className:"grv-invite-login-error"},t,o.a.createElement("br",null),o.a.createElement("small",{className:"grv-invite-login-error-u2f-codes"},o.a.createElement("span",null,"click ",o.a.createElement("a",{target:"_blank",href:"https://developers.yubico.com/U2F/Libraries/Client_error_codes.html"},"here")," to learn more about U2F error codes"))):o.a.createElement("label",{className:"error"},t," ")},ce="oidc",le="github",fe=403,pe={UTF:"u2f",OTP:"otp",DISABLED:"off"},he="sso",de=function(e){var t=e.providers,n=e.prefixText,r=e.isDisabled,a=e.onClick,i=t.map((function(e,t){var i=e.name,s=e.type,u=e.displayName,c=n+" "+(u=u||i),l="btn grv-user-btn-sso full-width "+function(e,t){return-1!==(e=e.toLowerCase()).indexOf("microsoft")?"btn-microsoft":-1!==e.indexOf("bitbucket")?"btn-bitbucket":-1!==e.indexOf("google")?"btn-google":-1!==e.indexOf("github")||t===le?"btn-github":t===ce?"btn-openid":"--unknown"}(u,s);return o.a.createElement("button",{key:t,disabled:r,className:l,onClick:function(t){t.preventDefault(),a(e)}},o.a.createElement("div",{className:"--sso-icon"},o.a.createElement("span",{className:"fa"})),o.a.createElement("span",null,c))}));return 0===i.length?o.a.createElement("h4",null," You have no SSO providers configured "):o.a.createElement("div",null," ",i," ")},ve=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ge=function(e){function t(){var e,n,r;me(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=ye(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onLoginWithSso=function(e){B.loginWithSso(e.name,e.url)},r.onLoginWithU2f=function(e,t){B.loginWithU2f(e,t)},r.onLoginWithU2fRecovery=function(e,t,n){B.loginWithU2fRecovery(e,t,n)},r.onLogin=function(e,t,n){B.login(e,t,n)},ye(r,n)}return be(t,e),ve(t,[{key:"render",value:function(){var e=this.props.attemp,t=l.a.getAuthProviders(),n=l.a.getAuth2faType();return o.a.createElement("div",{className:"grv-login text-center"},o.a.createElement(Q,null),o.a.createElement("div",{className:"grv-content grv-flex"},o.a.createElement("div",{className:"grv-flex-column"},o.a.createElement(we,{authProviders:t,auth2faType:n,onLoginWithSso:this.onLoginWithSso,onLoginWithU2f:this.onLoginWithU2f,onLoginWithU2fRecovery:this.onLoginWithU2fRecovery,onLogin:this.onLogin,attemp:e}),o.a.createElement(Ee,{auth2faType:n}))))}}]),t}(o.a.Component),we=function(e){function t(e){me(this,t);var n=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onLogin=function(e){if(e.preventDefault(),n.isValid()){var t=n.state,r=t.user,o=t.password,a=t.token;n.props.onLogin(r,o,a)}},n.onLoginWithU2f=function(e){if(e.preventDefault(),n.isValid()){var t=n.state,r=t.user,o=t.password;n.props.onLoginWithU2f(r,o)}},n.onLoginWithU2fRecovery=function(e){if(e.preventDefault(),n.isValid()){var t=n.state,r=t.user,o=t.password,a=t.recoveryCode;n.props.onLoginWithU2fRecovery(r,o,a)}},n.onLoginWithSso=function(e){n.props.onLoginWithSso(e)},n.onChangeState=function(e,t){n.setState(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t))},n.state={user:"",password:"",token:"",code:""},n}return be(t,e),ve(t,[{key:"isValid",value:function(){var e=b()(this.refs.form);return 0===e.length||e.valid()}},{key:"needs2fa",value:function(){return!!this.props.auth2faType&&this.props.auth2faType!==pe.DISABLED}},{key:"needsSso",value:function(){return this.props.authProviders&&this.props.authProviders.length>0}},{key:"render2faFields",value:function(){var e=this;return this.needs2fa()&&this.props.auth2faType===pe.OTP?o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{autoComplete:"off",value:this.state.token,onChange:function(t){return e.onChangeState("token",t.target.value)},className:"form-control required",name:"token",placeholder:"Two factor token (Google Authenticator)"})):null}},{key:"renderNameAndPassFields",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{autoFocus:!0,value:this.state.user,onChange:function(t){return e.onChangeState("user",t.target.value)},className:"form-control required",placeholder:"User name",name:"userName"})),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{value:this.state.password,onChange:function(t){return e.onChangeState("password",t.target.value)},type:"password",name:"password",className:"form-control required",placeholder:"Password"})))}},{key:"renderLoginBtn",value:function(){var e=this.props.attemp.isProcessing,t=e&&this.props.auth2faType===pe.UTF?o.a.createElement("div",{className:"help-block"},"Insert your U2F key and press the button on the key"):null,n=this.props.auth2faType===pe.UTF?this.onLoginWithU2f:this.onLogin;return o.a.createElement("div",null,o.a.createElement("button",{onClick:n,disabled:e,type:"submit",className:"btn btn-primary block full-width m-b"},"Login"),t)}},{key:"renderRecoveryInput",value:function(){var e=this;return o.a.createElement("div",null,"Or use your recovery code:",o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{value:this.state.recoveryCode,onChange:function(t){return e.onChangeState("recoveryCode",t.target.value)},className:"form-control required",placeholder:"Recovery code",name:"code"})),o.a.createElement("button",{onClick:this.onLoginWithU2fRecovery,type:"submit",className:"btn btn-primary block full-width m-b"},"Use recovery code"))}},{key:"renderSsoBtns",value:function(){var e=this.props,t=e.authProviders,n=e.attemp;return this.needsSso()?o.a.createElement(de,{prefixText:"Login with ",isDisabled:n.isProcessing,providers:t,onClick:this.onLoginWithSso}):null}},{key:"render",value:function(){var e=this.props.attemp,t=e.isFailed,n=e.message,r=t?o.a.createElement(ue,{message:n}):null,a=!!l.a.auth;return o.a.createElement("div",null,o.a.createElement("form",{ref:"form",className:"grv-login-input-form"},o.a.createElement("h3",null," Welcome to Teleport "),a?o.a.createElement("div",null,this.renderNameAndPassFields(),this.render2faFields(),this.renderLoginBtn(),this.props.attemp.isProcessing&&this.props.auth2faType===pe.UTF?this.renderRecoveryInput():null,this.renderSsoBtns()):o.a.createElement("div",null," You have no authentication options configured ")),r)}}]),t}(o.a.Component);we.propTypes={authProviders:o.a.PropTypes.array,auth2faType:o.a.PropTypes.string,onLoginWithSso:o.a.PropTypes.func.isRequired,onLoginWithU2f:o.a.PropTypes.func.isRequired,onLoginWithU2fRecovery:o.a.PropTypes.func.isRequired,onLogin:o.a.PropTypes.func.isRequired,attemp:o.a.PropTypes.object.isRequired};var Ee=function(e){var t=e.auth2faType===pe.OTP?o.a.createElement(J,null):null;return o.a.createElement("div",null,t,o.a.createElement("div",{className:"grv-login-info"},o.a.createElement("i",{className:"fa fa-question"}),o.a.createElement("strong",null,"New Account or forgot password?"),o.a.createElement("div",null,"Ask for assistance from your Company administrator")))};var _e=se("Login",Object(c.connect)((function(){return{attemp:K.loginAttemp}}))(ge)),Oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},je="login_failed",ke="expired_invite",Pe="not_found",Se="access_denied",Te="login_success",Ce=se("Info",(function(e){return e.params.type===Te?o.a.createElement(ze,null):null})),Ne=se("Error",(function(e){var t=e.params,n=e.location,r=t.type,a=n.query.details;switch(r){case je:return o.a.createElement(We,{message:a});case ke:return o.a.createElement(Fe,null);case Pe:return o.a.createElement(De,null);case Se:return o.a.createElement(Ue,{message:a});default:return o.a.createElement(Le,{message:a})}})),Ie=function(e){return o.a.createElement("div",{className:"grv-msg-page"},o.a.createElement("div",{className:"grv-header"},o.a.createElement("i",{className:e.iconClass})),e.children)},xe=function(e){return o.a.createElement(Ie,Oe({iconClass:"fa fa-exclamation-triangle"},e))},Re=function(e){var t=e.message,n=void 0===t?"":t;return o.a.createElement("div",{className:"m-t text-muted"},o.a.createElement("small",{className:"grv-msg-page-details-text"},n),o.a.createElement("p",null,o.a.createElement("small",{className:"contact-section"},"If you believe this is an issue with Teleport, please ",o.a.createElement("a",{href:"https://github.com/gravitational/teleport/issues/new"},"create a GitHub issue."))))},De=function(){return o.a.createElement(xe,null,o.a.createElement("h1",null,"404 Not Found"),o.a.createElement(Re,{message:"Looks like the page you are looking for isn't here any longer."}))},Ae=se("Not Found",De),Ue=function(e){var t=e.message;return o.a.createElement(Ie,{iconClass:"fa fa-frown-o"},o.a.createElement("h1",null,"Access denied"),o.a.createElement(Re,{message:t}))},Le=function(e){var t=e.message;return o.a.createElement(xe,null,o.a.createElement("h1",null,"Internal Error"),o.a.createElement(Re,{message:t}))},Fe=function(){return o.a.createElement(xe,null,o.a.createElement("h1",null,"Invite code has expired."),o.a.createElement(Re,{message:"Looks like your invite code isn't valid anymore."}))},We=function(e){var t=e.message;return o.a.createElement(xe,null,o.a.createElement("h1",null,"Login unsuccessful. Please try again, if the problem persists, contact your system administrator."),o.a.createElement(Re,{message:t}))},ze=function(){return o.a.createElement(Ie,{iconClass:"fa fa-check-circle m-b-md"},o.a.createElement("h1",null,"Login successful"),o.a.createElement("p",{className:"m-t",style:Me},"You have successfully signed into your account. You can close this window and continue using the product."))},Me={textAlign:"center",maxWidth:"500px",marginLeft:"auto",marginRight:"auto"},Be=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function He(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Ke=function(e){return!!e&&e!==pe.DISABLED},Je=function(e){function t(){var e,n,r;qe(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=Ve(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onSubmitWithU2f=function(e,t){B.acceptInviteWithU2f(e,t,r.props.params.inviteToken)},r.onSubmit=function(e,t,n){B.acceptInvite(e,t,n,r.props.params.inviteToken)},Ve(r,n)}return He(t,e),Be(t,[{key:"componentDidMount",value:function(){B.fetchInvite(this.props.params.inviteToken)}},{key:"render",value:function(){var e=this.props,t=e.fetchingInvite,n=e.invite,r=e.attemp,a=l.a.getAuth2faType();if(t.isFailed)return o.a.createElement(Fe,null);if(!n)return null;var i=G()("grv-invite-content grv-flex",{"---with-2fa-data":Ke(a)});return o.a.createElement("div",{className:"grv-invite text-center"},o.a.createElement(Q,null),o.a.createElement("div",{className:i},o.a.createElement("div",{className:"grv-flex-column"},o.a.createElement(Ye,{auth2faType:a,attemp:r,invite:n,onSubmitWithU2f:this.onSubmitWithU2f,onSubmit:this.onSubmit}),o.a.createElement(Ze,{auth2faType:a})),o.a.createElement(Ge,{auth2faType:a,qr:n.qr})))}}]),t}(o.a.Component),Ye=function(e){function t(e){qe(this,t);var n=Ve(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onSubmit=function(e){if(e.preventDefault(),n.isValid()){var t=n.state,r=t.userName,o=t.password,a=t.token;n.props.onSubmit(r,o,a)}},n.onSubmitWithU2f=function(e){if(e.preventDefault(),n.isValid()){var t=n.state,r=t.userName,o=t.password;n.props.onSubmitWithU2f(r,o)}},n.onChangeState=function(e,t){n.setState(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t))},n.state={userName:n.props.invite.user,password:"",passwordConfirmed:"",token:""},n}return He(t,e),Be(t,[{key:"componentDidMount",value:function(){b()(this.refs.form).validate({rules:{password:{minlength:6,required:!0},passwordConfirmed:{required:!0,equalTo:this.refs.password}},messages:{passwordConfirmed:{minlength:b.a.validator.format("Enter at least {0} characters"),equalTo:"Enter the same password as above"}}})}},{key:"isValid",value:function(){var e=b()(this.refs.form);return 0===e.length||e.valid()}},{key:"renderNameAndPassFields",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{disabled:!0,value:this.state.userName,onChange:function(t){return e.onChangeState("userName",t.target.value)},className:"form-control required",placeholder:"User name",name:"userName"})),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{value:this.state.password,onChange:function(t){return e.onChangeState("password",t.target.value)},autoFocus:!0,ref:"password",type:"password",name:"password",className:"form-control required",placeholder:"Password"})),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{value:this.state.passwordConfirmed,onChange:function(t){return e.onChangeState("passwordConfirmed",t.target.value)},type:"password",name:"passwordConfirmed",className:"form-control",placeholder:"Password confirm"})))}},{key:"render2faFields",value:function(){var e=this,t=this.props.auth2faType;return Ke(t)&&t===pe.OTP?o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{autoComplete:"off",value:this.state.token,onChange:function(t){return e.onChangeState("token",t.target.value)},className:"form-control required",name:"token",placeholder:"Two factor token (Google Authenticator)"})):null}},{key:"renderSubmitBtn",value:function(){var e=this.props.attemp.isProcessing,t=e&&this.props.auth2faType===pe.UTF?o.a.createElement("div",{className:"help-block"},"Insert your U2F key and press the button on the key"):null,n=this.props.auth2faType===pe.UTF?this.onSubmitWithU2f:this.onSubmit;return o.a.createElement("div",null,o.a.createElement("button",{onClick:n,disabled:e,type:"submit",className:"btn btn-primary block full-width m-b"},"Sign up"),t)}},{key:"render",value:function(){var e=this.props.attemp,t=e.isFailed,n=e.message,r=t?o.a.createElement(ue,{message:n}):null;return o.a.createElement("form",{ref:"form",className:"grv-invite-input-form"},o.a.createElement("h3",null," Get started with Teleport "),this.renderNameAndPassFields(),this.render2faFields(),this.renderSubmitBtn(),r)}}]),t}(o.a.Component);Ye.propTypes={auth2faType:o.a.PropTypes.string,authType:o.a.PropTypes.string,onSubmitWithU2f:o.a.PropTypes.func.isRequired,onSubmit:o.a.PropTypes.func.isRequired,attemp:o.a.PropTypes.object.isRequired};var Ge=function(e){var t=e.auth2faType,n=e.qr;return Ke(t)?t===pe.OTP?o.a.createElement("div",{className:"grv-flex-column grv-invite-barcode"},o.a.createElement("h4",null,"Scan bar code for auth token ",o.a.createElement("br",null),o.a.createElement("small",null,"Scan below to generate your two factor token")),o.a.createElement("img",{className:"img-thumbnail",src:"data:image/png;base64,"+n})):t===pe.UTF?o.a.createElement("div",{className:"grv-flex-column"},o.a.createElement("h3",null,"Insert your U2F key "),o.a.createElement("div",{className:"m-t-md"},"Press the button on the U2F key after you press the sign up button"),o.a.createElement("div",{className:"m-t text-muted"},o.a.createElement("small",null,"Click",o.a.createElement("a",{a:!0,target:"_blank",href:"https://support.google.com/accounts/answer/6103523?hl=en",rel:"noreferrer"}," here "),"to learn more about U2F 2-Step Verification."))):null:null},Ze=function(e){var t=e.auth2faType===pe.OTP?o.a.createElement(J,null):null;return o.a.createElement("div",null,t)};var Xe=se("Invite",Object(c.connect)((function(){return{invite:K.invite,attemp:K.attemp,fetchingInvite:K.fetchingInvite}}))(Je));function Qe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[{path:l.a.routes.error,component:Ne},{path:l.a.routes.info,component:Ce},{path:l.a.routes.login,component:_e},{path:l.a.routes.newUser,component:Xe},{path:l.a.routes.app,onEnter:function(e,t){return t(l.a.routes.nodes)}}].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e),[{path:"*",component:Ae}])}var $e={userAcl:["tlpt_user_acl"]},et={siteNodes:[["tlpt_nodes"],["tlpt","siteId"],function(e,t){return e.getSiteServers(t)}]},tt=n("i3tb"),nt=n("LvDl"),rt={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i},ot=/:\d+$/;function at(e){return(e=e||"").replace(ot,"")}function it(e,t,n){var r=n.searchableProps,o=n.cb;t=t.toLocaleUpperCase();for(var a=r||Object.getOwnPropertyNames(e),i=0;i<a.length;i++){var s=e[a[i]];if(s){if("function"==typeof o){var u=o(s,t,a[i]);if(!0===u)return u}if(-1!==s.toString().toLocaleUpperCase().indexOf(t))return!0}}return!1}var st=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ut=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.onChange=function(e){n.setState({value:e.target.value}),n.debouncedNotify()},n.debouncedNotify=Object(nt.debounce)((function(){n.props.onChange(n.state.value)}),200);var r=e.value||"";return n.state={value:r},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),st(t,[{key:"componentDidMount",value:function(){var e=i.a.findDOMNode(this);if(e){var t=e.querySelector("input"),n=t.value.length;t.selectionEnd=n,t.selectionStart=n}}},{key:"render",value:function(){var e=this.props,t=e.className,n=void 0===t?"":t,r=e.autoFocus,a=void 0!==r&&r;return n="grv-search input-group-sm "+n,o.a.createElement("div",{className:n},o.a.createElement("input",{placeholder:"Search...",className:"form-control",autoFocus:a,value:this.state.value,onChange:this.onChange}))}}]),t}(o.a.Component),ct=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function ft(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var pt=/(^\w+@(\S+)$)/,ht=-1,dt={UP:38,DOWN:40},vt=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=ft(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.prevLoginIndex=ht,r.state={hasErrors:!1,value:""},r.onChange=function(e){var t=e.target.value;r.isValid(t)&&!0===r.state.hasErrors&&r.setState({hasErrors:!1,value:t}),r.setState({value:t})},r.onKeyUp=function(e){if(0!==r.getPrevLogins().length){var t=0,n=e.which;if(n===dt.UP&&(t=1),n===dt.DOWN&&(t=-1),0!==t){var o=r.getNextLogin(t);r.setState({value:o})}}},r.onKeyPress=function(e){var t=e.target.value,n=r.isValid(t);if(("Enter"===e.key||"click"===e.type)&&t&&(r.setState({hasErrors:!n}),n)){var o=t.split("@"),a=ct(o,2),i=a[0],s=a[1];r.props.onEnter(i,s)}},ft(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),lt(t,[{key:"setDefaultPrevIndex",value:function(){this.prevLoginIndex=ht}},{key:"componentWillReceiveProps",value:function(e){e.clusterId===this.props.clusterId&&e.sshHistory===this.props.sshHistory||(this.setDefaultPrevIndex(),this.setState({value:""}))}},{key:"getPrevLogins",value:function(){var e=this.props,t=e.sshHistory,n=e.clusterId;return t.getPrevLogins(n)}},{key:"getNextLogin",value:function(e){var t=this.getPrevLogins();if(0===t.length)return"";var n=this.prevLoginIndex+e;return n<0?(this.setDefaultPrevIndex(),""):(n>=t.length?n=this.prevLoginIndex:this.prevLoginIndex=n,t[this.prevLoginIndex])}},{key:"isValid",value:function(e){return!!pt.exec(e)}},{key:"render",value:function(){var e=this,t=this.state,n=t.value,r=t.hasErrors,a=this.props.autoFocus,i=void 0!==a&&a,s=G()("grv-sshserver-input",{"--error":r});return o.a.createElement("div",{className:s},o.a.createElement("div",{className:"m-l input-group-sm",title:"login to SSH server"},o.a.createElement("input",{ref:function(t){e.inputRef=t},className:"form-control",placeholder:"login@host",value:n,autoFocus:i,onChange:this.onChange,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress})),o.a.createElement("label",{className:"m-l grv-sshserver-input-errors"}," Invalid format "))}}]),t}(o.a.Component);vt.propTypes={sshHistory:r.PropTypes.object.isRequired,clusterId:r.PropTypes.string.isRequired,onEnter:r.PropTypes.func.isRequired};var mt=vt,yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function gt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Et(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _t(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}var Ot=function(e){var t=e.rowIndex,n=e.data,r=e.columnKey,a=_t(e,["rowIndex","data","columnKey"]);return o.a.createElement(St,a,n[t][r])},jt={ASC:"ASC",DESC:"DESC"},kt=function(e){var t=e.sortDir,n="grv-table-indicator-sort fa fa-sort";return t===jt.DESC&&(n+="-desc"),t===jt.ASC&&(n+="-asc"),o.a.createElement("i",{className:n})},Pt=function(e){function t(){var e,n,r;gt(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=wt(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onSortChange=function(e){if(e.preventDefault(),r.props.onSortChange){var t=jt.DESC;r.props.sortDir&&(t=r.props.sortDir===jt.DESC?jt.ASC:jt.DESC),r.props.onSortChange(r.props.columnKey,t)}},wt(r,n)}return Et(t,e),bt(t,[{key:"render",value:function(){var e=this.props,t=e.sortDir,n=e.title,r=_t(e,["sortDir","title"]);return o.a.createElement(St,r,o.a.createElement("a",{onClick:this.onSortChange},n),o.a.createElement(kt,{sortDir:t}))}}]),t}(o.a.Component),St=function(e){var t=e.isHeader,n=e.children,r=e.className,a=void 0===r?"":r;return a="grv-table-cell "+a,t?o.a.createElement("th",{className:a},n):o.a.createElement("td",null,n)},Tt=function(e){function t(){return gt(this,t),wt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Et(t,e),bt(t,[{key:"renderHeader",value:function(e){var t=this,n=this.props.data,r=e.map((function(e,r){return t.renderCell(e.props.header,yt({index:r,key:r,isHeader:!0,data:n},e.props))}));return o.a.createElement("thead",{className:"grv-table-header"},o.a.createElement("tr",null,r))}},{key:"renderBody",value:function(e){for(var t=this,n=this.props.data,r=this.props.rowCount,a=[],i=0;i<r;i++){var s=e.map((function(e,r){return t.renderCell(e.props.cell,yt({rowIndex:i,key:r,isHeader:!1,data:n},e.props))}));a.push(o.a.createElement("tr",{key:i},s))}return o.a.createElement("tbody",null,a)}},{key:"renderCell",value:function(e,t){var n=null;return o.a.isValidElement(e)?n=o.a.cloneElement(e,t):"function"==typeof e&&(n=e(t)),n}},{key:"render",value:function(){var e=[];o.a.Children.forEach(this.props.children,(function(t){if(null!=t){if(!t.props._isColumn)throw"Should be Column";e.push(t)}}));var t="table grv-table "+this.props.className;return o.a.createElement("table",{className:t},this.renderHeader(e),this.renderBody(e))}}]),t}(o.a.Component),Ct=function(e){function t(){return gt(this,t),wt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Et(t,e),bt(t,[{key:"render",value:function(){throw new Error("Component <Column /> should never render")}}]),t}(o.a.Component);Ct.defaultProps={_isColumn:!0};var Nt=function(e){var t=e.text;return o.a.createElement("div",{className:"grv-table-indicator-empty text-muted"},o.a.createElement("span",null,t))},It="online",xt=function(e){return e.status===It},Rt={sites:[["tlpt_sites"],function(e){return e.filter(xt).toArray()}]},Dt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function At(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Ut=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=At(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onClick=function(e){e.preventDefault();var t=r.props.options[b()(e.target).parent().index()],n=Object(nt.isObject)(t)?t.value:t;r.props.onChange(n)},At(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Dt(t,[{key:"renderOption",value:function(e,t){var n=Object(nt.isObject)(e)?e.label:e;return o.a.createElement("li",{key:t},o.a.createElement("a",{href:"#"},n))}},{key:"getDisplayValue",value:function(e){for(var t=this.props.options,n=void 0===t?[]:t,r=0;r<n.length;r++){var o=n[r];if(Object(nt.isObject)(o)&&o.value===e)return o.label;if(o===e)return e}return null}},{key:"render",value:function(){var e=this.props,t=e.options,n=e.value,r=e.classRules,a=e.className,i=void 0===a?"":a,s=e.name,u=e.size,c=void 0===u?"default":u,l=e.align,f=void 0===l?"left":l,p=t.map(this.renderOption),h=n,d=this.getDisplayValue(n);d=d||"Select...";var v=G()("grv-dropdown-value",{"text-muted":!h}),m="grv-dropdown "+i,y=G()("btn btn-default full-width dropdown-toggle",{"btn-sm":"sm"===c}),b=G()("dropdown-menu",{"pull-right":"right"===f}),g=t.length>0?o.a.createElement("ul",{onClick:this.onClick,className:b},p):null;return o.a.createElement("div",{className:m},o.a.createElement("div",{className:"dropdown"},o.a.createElement("div",{className:y,type:"button","data-toggle":"dropdown"},o.a.createElement("div",{className:v},o.a.createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden"}},d),o.a.createElement("span",{className:"caret m-l-sm"}))),g),o.a.createElement("input",{className:r,value:h,type:"hidden",ref:"input",name:s}))}}]),t}(o.a.Component),Lt="TLPT_NODES_RECEIVE",Ft=_.a.create("Modules/Nodes");function Wt(){var e=m.a.evaluate(tt.a.siteId);return g.a.get(l.a.api.getSiteNodesUrl(e)).then((function(e){return e.items||[]})).done((function(e){return m.a.dispatch(Lt,e)})).fail((function(e){return Ft.error("fetchNodes",e)}))}var zt="TLPT_APP_SET_SITE_ID",Mt="TLPT_APP_ADD_NAV_ITEM",Bt="TLPT_CLUSTER_RECEIVE",qt="TLPT_USERACL_RECEIVE",Vt=n("CtRu");var Ht=_.a.create("flux/app");function Kt(e){m.a.dispatch(Mt,e)}function Jt(e){m.a.dispatch(zt,e)}function Yt(e,t){return R.start(),function(e){return b.a.when(g.a.get(l.a.api.sitesBasePath).then((function(e){var t=e.trusted||[],n=[e.current].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t));return m.a.dispatch(Bt,n),e.current.name})).fail((function(e){Ht.error("fetchSites",e)})),g.a.get(l.a.api.userContextPath).done((function(e){m.a.dispatch(W,{name:e.userName,authType:e.authType}),m.a.dispatch(qt,e.userAcl),Ht.info("Teleport ver:",e.version)}))).then((function(t){return Jt(e||t),b.a.when(Wt(),Object(Vt.a)())}))}(e).done((function(){t.onload(),R.success()})).fail((function(e){var t=g.a.getErrorText(e);R.fail(t)}))}var Gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Zt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Xt=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=Zt(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onChangeSite=function(e){Jt(e),Wt(),Object(Vt.a)()},Zt(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Gt(t,[{key:"render",value:function(){var e=this.props,t=e.sites,n=e.siteId,r=t.map((function(e){return{label:e.name,value:e.name}}));return 1===r.length&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",n=rt[t];return n&&n.test(e)}(r[0].value)&&(r[0].label=location.hostname),o.a.createElement("div",{className:"grv-clusters-selector"},o.a.createElement("div",{className:"m-r-sm"},"Cluster:"),o.a.createElement(Ut,{className:"m-r-sm",size:"sm",align:"right",onChange:this.onChangeSite,value:n,options:r}))}}]),t}(o.a.Component);var Qt=Object(c.connect)((function(){return{sites:Rt.sites,siteId:tt.a.siteId}}))(Xt),$t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},en=o.a.createClass({displayName:"PagedTable",onPrev:function(){var e=this.state,t=e.startFrom;(t-=e.pageSize)<0&&(t=0),this.setState({startFrom:t})},onNext:function(){var e=this.props.data,t=void 0===e?[]:e,n=this.state,r=n.startFrom,o=n.pageSize,a=r+o;a<t.length&&(a=r+o,this.setState({startFrom:a}))},getInitialState:function(){var e=this.props.pageSize;return{startFrom:0,pageSize:void 0===e?7:e}},componentWillReceiveProps:function(e){var t=e.data||[],n=this.props.data||[];t.length!==n.length&&this.setState({startFrom:0})},render:function(){var e=this.state,t=e.startFrom,n=e.pageSize,r=this.props,a=r.data,i=void 0===a?[]:a,s=r.tableClass,u=void 0===s?"":s,c=r.className,l=void 0===c?"":c,f=i.length,p=0,h=i;i.length>0&&((p=t+(n>i.length?i.length:n))>i.length&&(p=i.length),h=i.slice(t,p));var d=$t({},this.props,{rowCount:h.length,data:h}),v={pageSize:n,startFrom:t,endAt:p,totalRows:f};return o.a.createElement("div",{className:l},o.a.createElement(tn,$t({},v,{onPrev:this.onPrev,onNext:this.onNext})),o.a.createElement("div",{className:u},o.a.createElement(Tt,d)),o.a.createElement(tn,$t({},v,{onPrev:this.onPrev,onNext:this.onNext})))}}),tn=function(e){var t=e.startFrom,n=e.endAt,r=e.totalRows,a=e.onPrev,i=e.onNext;if(!(r>e.pageSize))return null;var s=G()("btn btn-white",{disabled:0===t}),u=G()("btn btn-white",{disabled:n===r});return o.a.createElement("div",{className:"m-b-sm grv-table-paged-info"},o.a.createElement("span",{className:"m-r-sm"},o.a.createElement("span",{className:"text-muted"},"Showing "),o.a.createElement("span",{className:"font-bold"},t+1),o.a.createElement("span",{className:"text-muted"}," to "),o.a.createElement("span",{className:"font-bold"},n),o.a.createElement("span",{className:"text-muted"}," of "),o.a.createElement("span",{className:"font-bold"},r)),o.a.createElement("div",{className:"btn-group btn-group-sm"},o.a.createElement("a",{onClick:a,className:s,type:"button"},"Prev"),o.a.createElement("a",{onClick:i,className:u,type:"button"},"Next")))},nn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function rn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function on(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function an(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function sn(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}var un=function(e){var t=e.text,n=void 0===t?"Empty":t;return o.a.createElement("small",{className:"text-muted"},o.a.createElement("span",null,n))},cn=function(){return o.a.createElement("span",{style:{cursor:"default"},title:"This node is connected to cluster through reverse tunnel"},"⟵ tunnel")},ln=function(e){var t=e.rowIndex,n=e.data,r=sn(e,["rowIndex","data"]),a=n[t],i=a.addr,s=a.tunnel;return o.a.createElement(St,r,s?o.a.createElement(cn,null):i)},fn=function(e){var t=e.rowIndex,n=e.data,r=sn(e,["rowIndex","data"]),a=n[t].tags.map((function(e,t){return o.a.createElement("span",{key:t,title:e.name+":"+e.value,className:"label label-default grv-nodes-table-label"},e.name," ",o.a.createElement("li",{className:"fa fa-long-arrow-right m-r-xs"}),e.value)}));return 0===a.length&&(a=o.a.createElement(un,{text:"No assigned labels"})),o.a.createElement(St,r,a)},pn=function(e){function t(){var e,n,r;rn(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=on(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onKeyPress=function(e){if("Enter"===e.key&&e.target.value){var t=r.makeUrl(e.target.value);v.push(t)}},r.onShowLoginsClick=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),r.refs.customLogin.focus()},on(r,n)}return an(t,e),nn(t,[{key:"makeUrl",value:function(e){var t=this.props,n=t.data[t.rowIndex],r=n.siteId,o=n.id;return l.a.getTerminalLoginUrl({siteId:r,serverId:o,login:e})}},{key:"render",value:function(){for(var e=this.props,t=e.logins,n=sn(e,["logins"]),r=[],a=t[0]||"",i=this.makeUrl(a),s=0;s<t.length;s++){var c=this.makeUrl(t[s]);r.push(o.a.createElement("li",{key:s},o.a.createElement(u.Link,{to:c},t[s])))}return o.a.createElement(St,n,o.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},0===t.length&&o.a.createElement(un,{text:"No assigned logins"}),t.length>0&&o.a.createElement("div",{style:{display:"flex"},className:"btn-group"},o.a.createElement(u.Link,{className:"btn btn-xs btn-primary",to:i},a),o.a.createElement("button",{"data-toggle":"dropdown",onClick:this.onShowLoginsClick,className:"btn btn-default btn-xs dropdown-toggle"},o.a.createElement("span",{className:"caret"})),o.a.createElement("ul",{className:"dropdown-menu pull-right"},o.a.createElement("li",null,o.a.createElement("div",{className:"input-group-sm grv-nodes-custom-login"},o.a.createElement("input",{className:"form-control",ref:"customLogin",placeholder:"Enter login name...",onKeyPress:this.onKeyPress,autoFocus:!0}))),r))))}}]),t}(o.a.Component),hn=function(e){function t(e){rn(this,t);var n=on(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.storageKey="NodeList",n.searchableProps=["addr","hostname","tags"],n.onSortChange=function(e,t){var r,o,a;n.state.colSortDirs=(a=t,(o=e)in(r={})?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a,r),n.setState(n.state)},n.onFilterChange=function(e){n.state.filter=e,n.setState(n.state)},n.onSshInputEnter=function(e,t){var r=l.a.getTerminalLoginUrl({siteId:n.props.siteId,serverId:t,login:e});v.push(r)},e.storage&&(n.state=e.storage.findByKey(n.storageKey)),n.state||(n.state={filter:"",colSortDirs:{hostname:jt.DESC}}),n}return an(t,e),nn(t,[{key:"componentWillUnmount",value:function(){this.props.storage&&this.props.storage.save(this.storageKey,this.state)}},{key:"searchAndFilterCb",value:function(e,t,n){if("tags"===n)return e.some((function(e){var n=e.name,r=e.value;return-1!==n.toLocaleUpperCase().indexOf(t)||-1!==r.toLocaleUpperCase().indexOf(t)}))}},{key:"sortAndFilter",value:function(e){var t=this,n=this.state.colSortDirs,r=e.filter((function(e){return it(e,t.state.filter,{searchableProps:t.searchableProps,cb:t.searchAndFilterCb})})),o=Object.getOwnPropertyNames(n)[0],a=n[o],i=Object(nt.sortBy)(r,o);return a===jt.ASC&&(i=i.reverse()),i}},{key:"render",value:function(){var e=this.props,t=e.sshHistory,n=e.siteId,r=e.nodeRecords,a=e.logins,i=e.onLoginClick,s=this.state.filter,u=this.sortAndFilter(r);return o.a.createElement("div",{className:"grv-nodes m-t"},o.a.createElement("div",{className:"grv-flex grv-header",style:{justifyContent:"space-between"}},o.a.createElement("h2",{className:"text-center no-margins"}," Nodes "),o.a.createElement("div",{className:"grv-flex"},o.a.createElement(Qt,null),o.a.createElement(ut,{autoFocus:!0,value:s,onChange:this.onFilterChange}),o.a.createElement(mt,{clusterId:n,sshHistory:t,onEnter:this.onSshInputEnter}))),o.a.createElement("div",{className:"m-t"},0===u.length&&this.state.filter.length>0?o.a.createElement(Nt,{text:"No matching nodes found"}):o.a.createElement(en,{className:"grv-nodes-table",tableClass:"table-striped",data:u,pageSize:100},o.a.createElement(Ct,{columnKey:"hostname",header:o.a.createElement(Pt,{sortDir:this.state.colSortDirs.hostname,onSortChange:this.onSortChange,title:"Hostname"}),cell:o.a.createElement(Ot,null)}),o.a.createElement(Ct,{header:o.a.createElement(Pt,{sortDir:this.state.colSortDirs.addr,onSortChange:this.onSortChange,title:"Address"}),cell:o.a.createElement(ln,null)}),o.a.createElement(Ct,{header:o.a.createElement(St,null,"Labels"),cell:o.a.createElement(fn,null)}),o.a.createElement(Ct,{className:"grv-nodes-table-login",onLoginClick:i,header:o.a.createElement(St,null,"Login as"),cell:o.a.createElement(pn,{logins:a})}))))}}]),t}(o.a.Component),dn=n("L7e8"),vn=n("JPcv"),mn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var yn=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),mn(t,[{key:"getPrevLogins",value:function(e){return this.clusterLogins.get(e)||[]}},{key:"addLoginString",value:function(e){var t=e.login,n=e.serverId,r=e.siteId,o=this.getIn(["clusterLogins",r]);o||(o=[]);var a=t+"@"+n;return o.some((function(e){return e===a}))?this:(o.unshift(a),this.setIn(["clusterLogins",r],o))}}]),t}(Object(vn.Record)({clusterLogins:new vn.Map})),bn=Object(dn.Store)({getInitialState:function(){return new yn},initialize:function(){this.on("TLPT_SSH_HISTORY",(function(e,t){return e.addLoginString(t)}))}}),gn={store:["tlpt_ssh_history"]};var wn=Object(dn.Store)({getInitialState:function(){return new dn.Immutable.Map},initialize:function(){this.on("MISC_SET",(function(e,t){var n=t.key,r=t.payload;return e.set(n,r)}))}}),En={save:function(e,t){m.a.dispatch("MISC_SET",{key:e,payload:t})},findByKey:function(e){return m.a.evaluate(["tlpt_misc",e])}},_n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},On=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var jn=function(e){var t,n;return n=t=function(t){function n(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),On(n,[{key:"render",value:function(){var t=this.props;return o.a.createElement(e,_n({},t,{storage:En}))}}]),n}(o.a.Component),t.displayName="withTmpStorageWrapper",n};var kn=jn((function(e){var t=e.siteNodes,n=e.sshHistory,r=e.aclStore,a=e.sites,i=e.siteId,s=e.storage,u=r.getSshLogins().toJS(),c=t.toJS(),l=i+" · Nodes";return o.a.createElement("div",{className:"grv-page"},o.a.createElement(ie,{title:l},o.a.createElement(hn,{sshHistory:n,storage:s,siteId:i,sites:a,nodeRecords:c,logins:u})))})),Pn=Object(c.connect)((function(){return{siteId:tt.a.siteId,siteNodes:et.siteNodes,aclStore:$e.userAcl,sshHistory:gn.store}}))(kn),Sn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Tn=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._timer=null,n.state={canDisplay:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Sn(t,[{key:"componentDidMount",value:function(){var e=this;this._timer=setTimeout((function(){e.setState({canDisplay:!0})}),100)}},{key:"componentWillUnmount",value:function(){clearTimeout(this._timer)}},{key:"render",value:function(){var e=this.props.type,t=void 0===e?"bounce":e;return this.state.canDisplay?"bounce"===t?o.a.createElement(Cn,null):void 0:null}}]),t}(o.a.Component),Cn=function(){return o.a.createElement("div",{className:"grv-spinner sk-spinner sk-spinner-three-bounce"},o.a.createElement("div",{className:"sk-bounce1"}),o.a.createElement("div",{className:"sk-bounce2"}),o.a.createElement("div",{className:"sk-bounce3"}))},Nn=Tn,In=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Rn=_.a.create("components/withFeature"),Dn=function(e){return function(t){var n,r;return r=n=function(n){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return n._unsubscribeFn=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,n),xn(r,[{key:"componentDidMount",value:function(){var t=this;try{this._unsubscribeFn=m.a.observe(e.initAttemptGetter,(function(){t.setState({})})),m.a.batch((function(){e.componentDidMount()}))}catch(e){Rn.error("failed to initialize a feature",e)}}},{key:"componentWillUnmount",value:function(){this._unsubscribeFn()}},{key:"render",value:function(){if(e.isProcessing())return o.a.createElement(Nn,{delay:"long",type:"bounce"});if(e.isFailed()){var n=e.getErrorText();return e.getErrorCode()===fe?o.a.createElement(Ue,{message:n}):o.a.createElement(Le,{message:n})}if(!e.wasInitialized())return null;var r=this.props;return o.a.createElement(t,In({},r,{feature:e}))}}]),r}(o.a.Component),n.displayName="withFeatureWrapper",r}},An=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Un=0,Ln=function(e){return e||"TRYING_TO_INIT_FEATURE_"+ ++Un},Fn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Ln(t),this.initStatus=x(Ln(t)),this.initAttemptGetter=Object(q.e)(t)}return An(e,[{key:"preload",value:function(){return b.a.Deferred().resolve()}},{key:"onload",value:function(){}},{key:"startProcessing",value:function(){this.initStatus.start()}},{key:"stopProcessing",value:function(){this.initStatus.success()}},{key:"isReady",value:function(){return this._getInitAttempt().isSuccess}},{key:"isProcessing",value:function(){return this._getInitAttempt().isProcessing}},{key:"isFailed",value:function(){return this._getInitAttempt().isFailed}},{key:"wasInitialized",value:function(){var e=this._getInitAttempt();return e.isFailed||e.isProcessing||e.isSuccess}},{key:"componentDidMount",value:function(){}},{key:"getErrorText",value:function(){var e=this._getInitAttempt().message;return Object(nt.isObject)(e)?e.text:e}},{key:"getErrorCode",value:function(){var e=this._getInitAttempt().message;return Object(nt.isObject)(e)?e.code:null}},{key:"handleAccesDenied",value:function(){this.handleError(new Error("Access Denied"))}},{key:"handleError",value:function(e){var t=g.a.getErrorText(e);e.status===fe&&(t={code:fe,text:t}),this.initStatus.fail(t)}},{key:"withMe",value:function(e){return Dn(this)(e)}},{key:"_getInitAttempt",value:function(){return m.a.evaluate(this.initAttemptGetter)}}]),e}(),Wn={store:["tlpt_terminal"]},zn="/flux/fileTransfer:open",Mn="/flux/fileTransfer:close",Bn="/flux/fileTransfer:add",qn="/flux/fileTransfer:remove",Vn="/flux/fileTransfer:status",Hn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Kn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function Jn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Gn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Zn={isFailed:!1,isProcessing:!1,isCompleted:!1,error:""},Xn=function(e){function t(e){return Jn(this,t),e=Kn({},e,{id:(new Date).getTime()+e.name}),Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Gn(t,e),t}(Object(vn.Record)(Kn({id:"",url:"",name:"",isUpload:"",blob:null},Zn))),Qn=function(e){function t(e){return Jn(this,t),Yn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Gn(t,e),Hn(t,[{key:"open",value:function(e){var t=e.isUpload,n=e.siteId,r=e.serverId,o=e.login;return this.merge({isOpen:!0,isUpload:t,siteId:n,serverId:r,login:o})}},{key:"close",value:function(){return new t}},{key:"makeUrl",value:function(e,t){var n=this.siteId,r=this.serverId,o=this.login;return l.a.api.getScpUrl({siteId:n,serverId:r,login:o,location:e,filename:t})}},{key:"removeFile",value:function(e){var t=this.files.delete(e);return this.set("files",t)}},{key:"addFile",value:function(e){var t=e.location,n=e.name,r=e.blob,o=e.isUpload,a=this.makeUrl(t,n),i=new Xn({url:a,name:n,isUpload:o,blob:r});return this.update("files",(function(e){return e.set(i.id,i)}))}},{key:"updateStatus",value:function(e){var t=e.id,n=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["id"]),r=this.files.get(t),o=Kn({},Zn,n);return r=r.merge(o),this.update("files",(function(e){return e.set(t,r)}))}},{key:"isTransfering",value:function(){return this.files.some((function(e){return!0===e.isProcessing}))}}]),t}(Object(vn.Record)({isOpen:!1,isUpload:!1,siteId:"",serverId:"",login:"",files:new vn.OrderedMap})),$n=Object(dn.Store)({getInitialState:function(){return new Qn},initialize:function(){this.on(zn,(function(e,t){return e.open(t)})),this.on(Mn,(function(e){return e.close()})),this.on(Bn,(function(e,t){return e.addFile(t)})),this.on(qn,(function(e,t){return e.removeFile(t)})),this.on(Vn,(function(e,t){return e.updateStatus(t)}))}});var er="tlpt_files";var tr={store:[er]},nr=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),rr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function or(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ar(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ir(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var sr=function(e){function t(e){or(this,t);var n=new vn.List(Object(dn.toImmutable)(e.tags));return ar(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,rr({},e,{tags:n})))}return ir(t,e),t}(Object(vn.Record)({id:"",siteId:"",hostname:"",tags:new vn.List,addr:"",tunnel:!1})),ur=function(e){function t(){return or(this,t),ar(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ir(t,e),nr(t,[{key:"findServer",value:function(e){return this.servers.find((function(t){return t.id===e}))}},{key:"getSiteServers",value:function(e){return this.servers.filter((function(t){return t.siteId===e}))}},{key:"addSiteServers",value:function(e){var t=(new vn.List).withMutations((function(t){return e.forEach((function(e){return t.push(new sr(e))})),t}));return t.equals(this.servers)?this:this.set("servers",t)}}]),t}(Object(vn.Record)({servers:new vn.List}));function cr(){return m.a.evaluate(["tlpt_nodes"])}var lr=Object(dn.Store)({getInitialState:function(){return new ur},initialize:function(){this.on(Lt,(function(e,t){return e.addSiteServers(t)}))}}),fr=n("wd/R"),pr=n.n(fr),hr={START:"session.start",JOIN:"session.join",END:"session.end",PRINT:"print",RESIZE:"resize"},dr="terminal.resize",vr="terminal.close",mr="terminal.reset",yr="terminal.data",br="connection.close",gr=1e3,wr=function(e){return["tlpt_sessions_events",e,hr.START,"addr.local"]};function Er(e){var t=e.get("id"),n=e.siteId,r=e.nodeIp,o=e.created,a=e.server_id,i=e.parties,s=e.last_active,u=pr()(s).diff(o),c=kr(n,a,r),f=jr(o),p=l.a.getPlayerUrl({sid:t,siteId:n});return{active:!1,parties:Or(i),sid:t,duration:u,siteId:n,sessionUrl:p,created:o,createdDisplayText:f,nodeDisplayText:c,lastActive:s}}function _r(e){var t=e.get("id"),n=Or(e.parties),r=e.siteId,o=e.created,a=e.login,i=e.last_active,s=e.server_id,u=pr()(i).diff(o),c=kr(r,s,m.a.evaluate(wr(t))),f=jr(o);return{active:!0,parties:n,sid:t,duration:u,siteId:r,sessionUrl:l.a.getTerminalLoginUrl({sid:t,siteId:r,login:a,serverId:s}),created:o,createdDisplayText:f,nodeDisplayText:c,lastActive:i}}function Or(e){return e.toJS().map((function(e){var t=at(e.serverIp);return e.user+" ["+t+"]"}))}function jr(e){return pr()(e).format(l.a.displayDateFormat)}function kr(e,t,n){var r=cr().findServer(t),o=at(n),a=o;return r&&r.hostname&&(a=r.hostname,o&&(a=a+" ["+o+"]")),a}var Pr={storedSessionList:[["tlpt_sessions_archived"],["tlpt","siteId"],function(e,t){return(e=e.filter((function(e){return e.get("siteId")===t}))).valueSeq().map(Er).toJS()}],activeSessionList:[["tlpt_sessions_active"],["tlpt","siteId"],function(e,t){return(e=e.filter((function(e){return e.get("siteId")===t}))).valueSeq().map(_r).toJS()}],activeSessionById:function(e){return["tlpt_sessions_active",e]},activePartiesById:function(e){return[["tlpt_sessions_active",e,"parties"],function(e){return e?e.toJS():[]}]},storedSessionById:function(e){return["tlpt_sessions_archived",e]},createStoredListItem:Er},Sr="TLPT_TERMINAL_INIT",Tr="TLPT_TERMINAL_CLOSE",Cr=function(e){var t=e.login,n=e.serverId,r=e.siteId;m.a.dispatch("TLPT_SSH_HISTORY",{login:t,serverId:n,siteId:r})},Nr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ir=_.a.create("flux/terminal"),xr=function(e){return m.a.dispatch("TLPT_TERMINAL_SET_STATUS",e)};function Rr(e){var t=e.serverId,n=cr().findServer(t),r=n?n.hostname:"";m.a.dispatch(Sr,Nr({},e,{hostname:r}))}function Dr(e){Ir.info("attempt to open a terminal",e);var t=e.sid;(xr({isLoading:!0}),t)?m.a.evaluate(Pr.activeSessionById(t))?(Rr(e),xr({isReady:!0})):xr({isNotFound:!0}):function(e){var t=e.login,n=e.siteId,r={session:{terminal_params:{w:45,h:5},login:t}};return g.a.post(l.a.api.getSiteSessionUrl(n),r)}(e).done((function(t){var n=t.session.id,r=Nr({},e,{sid:n});Rr(r),xr({isReady:!0}),Ur(r),Cr(e)})).fail((function(e){var t=g.a.getErrorText(e);xr({isError:!0,errorText:t})}))}function Ar(){m.a.dispatch(Tr),v.push(l.a.routes.nodes)}function Ur(e){var t=l.a.getTerminalLoginUrl(e);v.push(t)}var Lr=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Fr=function(e){var t=e.indexOf("root");return-1!==t?(e=e.remove(t)).sort().unshift("root"):e},Wr=new vn.Record({list:!1,read:!1,edit:!1,create:!1,remove:!1}),zr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=Object(dn.toImmutable)(e),r=new vn.List(n.get("sshLogins")),o={sshLogins:Fr(r),authConnectors:new Wr(n.get("authConnectors")),trustedClusters:new Wr(n.get("trustedClusters")),roles:new Wr(n.get("roles")),sessions:new Wr(n.get("sessions"))};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Lr(t,[{key:"getSessionAccess",value:function(){return this.get("sessions")}},{key:"getRoleAccess",value:function(){return this.get("roles")}},{key:"getConnectorAccess",value:function(){return this.get("authConnectors")}},{key:"getClusterAccess",value:function(){return this.get("trustedClusters")}},{key:"getSshLogins",value:function(){return this.get("sshLogins")}}]),t}(Object(vn.Record)({authConnectors:new Wr,trustedClusters:new Wr,roles:new Wr,sessions:new Wr,sshLogins:new vn.List}));function Mr(){return m.a.evaluate(["tlpt_user_acl"])}var Br=Object(dn.Store)({getInitialState:function(){return new zr},initialize:function(){this.on(qt,(function(e,t){return new zr(t)}))}});function qr(){var e=Mr().getSessionAccess().read?l.a.routes.sessions:l.a.routes.app;v.push(e)}var Vr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function Hr(e){m.a.dispatch(Bn,e)}function Kr(e){m.a.dispatch(Vn,e)}function Jr(){m.a.dispatch(Mn,{})}var Yr=n("/LiH"),Gr=n.n(Yr),Zr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xr=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Qr=r.PropTypes.shape({dispatch:r.PropTypes.func.isRequired,evaluate:r.PropTypes.func.isRequired,evaluateToJS:r.PropTypes.func.isRequired,observe:r.PropTypes.func.isRequired});function $r(e,t){return t=t||function(){return{}},function(n){var o=function(o){function a(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t));return n.reactor=e.reactor||t.reactor,n.unsubscribeFns=[],n.updatePropMap(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,o),Xr(a,[{key:"resubscribe",value:function(e){this.unsubscribe(),this.updatePropMap(e),this.updateState(),this.subscribe()}},{key:"componentWillMount",value:function(){this.updateState(),this.subscribe(this.props)}},{key:"componentWillUnmount",value:function(){this.unsubscribe()}},{key:"updatePropMap",value:function(t){this.propMap=e?e(t):{}}},{key:"updateState",value:function(){var e=this.propMap,t={};for(var n in e){var r=e[n];t[n]=this.reactor.evaluate(r)}this.setState(t)}},{key:"subscribe",value:function(){var e=this,t=this.propMap,n=function(n){var r=t[n],o=e.reactor.observe(r,(function(t){e.setState(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n,t))}));e.unsubscribeFns.push(o)};for(var r in t)n(r)}},{key:"unsubscribe",value:function(){if(0!==this.unsubscribeFns.length)for(;this.unsubscribeFns.length>0;)this.unsubscribeFns.shift()()}},{key:"render",value:function(){var e=t(this.props);return Object(r.createElement)(n,Zr({reactor:this.reactor},e,this.props,this.state))}}]),a}(r.Component);return o.displayName="Connect("+function(e){return e.displayName||e.name||"Component"}(n)+")",o.WrappedComponent=n,o.contextTypes={reactor:Qr},o.propTypes={reactor:Qr},Gr()(o,n)}}var eo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function to(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var no={width:"30px",height:"30px",display:"block",margin:"0 auto"},ro=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=to(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.openFileTransferDialog=function(e){var t=r.props,n=t.store,o=t.params;n.isOpen||(e?function(e){var t=Vr({},e,{isUpload:!0});m.a.dispatch(zn,t)}(o):function(e){var t=Vr({},e,{isUpload:!1});m.a.dispatch(zn,t)}(o))},r.close=function(){Ar()},r.openUploadDialog=function(){r.openFileTransferDialog(!0)},r.openDownloadDialog=function(){r.openFileTransferDialog(!1)},to(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),eo(t,[{key:"componentWillUnmount",value:function(){Jr()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.store.isOpen,r=G()("grv-terminal-actions-files",n&&"--isOpen");return o.a.createElement("div",{className:"grv-terminal-actions"},o.a.createElement("div",{title:"Close",style:no,onClick:this.close},o.a.createElement($,null)),o.a.createElement("div",{className:"grv-terminal-actions-participans"},t),o.a.createElement("div",{className:r},o.a.createElement("a",{title:"Download files",className:"grv-terminal-actions-files-btn m-b-sm",onClick:this.openDownloadDialog},o.a.createElement("i",{className:"fa fa-download"})),o.a.createElement("a",{title:"Upload files",className:"grv-terminal-actions-files-btn",onClick:this.openUploadDialog},o.a.createElement("i",{className:"fa fa-upload"}))))}}]),t}(o.a.Component);var oo=$r((function(){return{store:tr.store}}))(Object(u.withRouter)(ro)),ao=n("J21I"),io=n.n(ao);var so=Object(c.connect)((function(e){return{parties:Pr.activePartiesById(e.sid)}}))((function(e){var t=(e.parties||[]).map((function(e,t){return o.a.createElement("div",{key:t,className:"animated m-t"},o.a.createElement(ee,{colorIndex:t,isDark:!0,name:e.user}))}));return o.a.createElement(io.a,{className:"m-t",component:"div",transitionEnterTimeout:500,transitionLeaveTimeout:500,transitionName:{enter:"fadeIn",leave:"fadeOut"}},o.a.createElement("hr",{className:"grv-divider m-t"}),t)})),uo=n("Q92V"),co=n.n(uo),lo=n("OgkW"),fo=n("tjlA"),po=n.n(fo),ho=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},vo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var mo={RAW:"r",AUDIT:"a",SESSION_END:"c",RESIZE:"w"},yo={payload:{code:26},version:{code:10,length:1,values:{v1:49}},type:{length:1,code:18,values:{resize:mo.RESIZE.charCodeAt(0),data:mo.RAW.charCodeAt(0),event:mo.AUDIT.charCodeAt(0),close:mo.SESSION_END.charCodeAt(0)}}},bo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return vo(e,[{key:"encode",value:function(e,t){var n=[];return this.encodeVersion(n),this.encodeType(n,e),this.encodePayload(n,t),n}},{key:"encodeResizeMessage",value:function(e){return this.encode(yo.type.values.resize,e)}},{key:"encodeRawMessage",value:function(e){return this.encode(yo.type.values.data,e)}},{key:"encodePayload",value:function(e,t){e.push(yo.payload.code);var n=this._textToUintArray(t);this.encodeVarint(e,n.length);for(var r=0;r<n.length;r++)e.push(n[r])}},{key:"encodeVersion",value:function(e){e[0]=yo.version.code,e[1]=yo.version.length,e[2]=yo.version.values.v1}},{key:"encodeType",value:function(e,t){e[3]=yo.type.code,e[4]=yo.type.length,e[5]=t}},{key:"encodeVarint",value:function(e,t){for(var n=t>>>0,r=Math.floor((t-n)/4294967296)>>>0;r>0||n>127;)e.push(127&n|128),n=(n>>>7|r<<25)>>>0,r>>>=7;e.push(n)}},{key:"decode",value:function(e){return{version:this.decodeVersion(e),type:this.decodeType(e),payload:this.decodePayload(e)}}},{key:"decodeVersion",value:function(e){if(e[0]===yo.version.code&&e[1]===yo.version.length)return String.fromCharCode(e[2]);throw new Error("invalid version field")}},{key:"decodeType",value:function(e){if(e[3]===yo.type.code&&e[4]===yo.type.length)return String.fromCharCode(e[5]);throw new Error("invalid type field")}},{key:"decodePayload",value:function(e){if(!e[6])return"";if(e[6]!==yo.payload.code)throw new Error("invalid payload field");var t=e.slice(7),n=this.decodeVarint(t),r=ho(n,2),o=r[0],a=r[1],i=t.slice(o,o+a);return this._uintArrayToText(i)}},{key:"decodeVarint",value:function(e){for(var t=0,n=0,r=0;r<e.length;r++){var o=e[r];if(o<128){if(r>9||9==r&&o>1)throw new Error("unable to decode varint: overflow");return[r+1,t|o<<n]}t|=o&127<<n,n+=7}throw new Error("unable to decode varint: empty array")}},{key:"_textToUintArray",value:function(e){return po.a.Buffer(e)}},{key:"_uintArrayToText",value:function(e){return window.TextDecoder?new TextDecoder("utf-8").decode(e):po.a.Buffer(e).toString()}}]),e}();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice});var go=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},wo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Eo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var _o=_.a.create("Tty"),Oo={buffered:!0},jo=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.socket=null,r._buffered=!0,r._addressResolver=null;var o=wo({},Oo,n);return r._addressResolver=e,r._buffered=o.buffered,r._proto=new bo,r._onOpenConnection=r._onOpenConnection.bind(r),r._onCloseConnection=r._onCloseConnection.bind(r),r._onMessage=r._onMessage.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Eo(t,[{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gr;null!==this.socket&&this.socket.close(e)}},{key:"connect",value:function(e,t){var n=this._addressResolver.getConnStr(e,t);this.socket=new WebSocket(n),this.socket.binaryType="arraybuffer",this.socket.onopen=this._onOpenConnection,this.socket.onmessage=this._onMessage,this.socket.onclose=this._onCloseConnection}},{key:"send",value:function(e){var t=this._proto.encodeRawMessage(e),n=new Uint8Array(t);this.socket.send(n.buffer)}},{key:"requestResize",value:function(e,t){_o.info("requesting new screen size","w:"+e+" and h:"+t);var n=JSON.stringify({event:hr.RESIZE,width:e,height:t,size:e+":"+t}),r=this._proto.encodeResizeMessage(n),o=new Uint8Array(r);this.socket.send(o.buffer)}},{key:"_flushBuffer",value:function(){this.emit(yr,this._attachSocketBuffer),this._attachSocketBuffer=null,clearTimeout(this._attachSocketBufferTimer),this._attachSocketBufferTimer=null}},{key:"_pushToBuffer",value:function(e){this._attachSocketBuffer?this._attachSocketBuffer+=e:(this._attachSocketBuffer=e,setTimeout(this._flushBuffer.bind(this),10))}},{key:"_onOpenConnection",value:function(){this.emit("open"),_o.info("websocket is open")}},{key:"_onCloseConnection",value:function(e){this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket=null,this.emit(br,e),_o.info("websocket is closed")}},{key:"_onMessage",value:function(e){try{var t=new Uint8Array(e.data),n=this._proto.decode(t);switch(n.type){case mo.AUDIT:this._processAuditPayload(n.payload);break;case mo.SESSION_END:this.emit(vr,n.payload);break;case mo.RAW:this._buffered?this._pushToBuffer(n.payload):this.emit(yr,n.payload);break;default:throw Error("unknown message type",n.type)}}catch(e){_o.error("failed to parse incoming message.",e)}}},{key:"_processAuditPayload",value:function(e){var t=JSON.parse(e);if(t.event===hr.RESIZE){var n=t.size.split(":"),r=go(n,2),o=r[0],a=r[1];o=Number(o),a=Number(a),this.emit(dr,{w:o,h:a})}}}]),t}(lo.EventEmitter),ko=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Po=_.a.create("lib/term/terminal"),So=200,To=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.addressResolver,r=t.el,o=t.scrollBack,a=void 0===o?1e3:o;this._el=r,this.tty=new jo(n),this.scrollBack=a,this.rows=void 0,this.cols=void 0,this.term=null,this.debouncedResize=Object(nt.debounce)(this._requestResize.bind(this),So)}return ko(e,[{key:"open",value:function(){var e=this;this._el.classList.add("grv-terminal"),this.term=new co.a({cols:15,rows:5,scrollback:this.scrollBack,cursorBlink:!1}),this.term.open(this._el),this.resize(this.cols,this.rows),this.term.on("data",(function(t){e.tty.send(t)})),window.addEventListener("resize",this.debouncedResize),this.tty.on(mr,this.reset.bind(this)),this.tty.on(br,this._processClose.bind(this)),this.tty.on(yr,this._processData.bind(this)),this.tty.on(dr,(function(t){var n=t.h,r=t.w;return e.resize(r,n)})),this.connect()}},{key:"connect",value:function(){this.tty.connect(this.cols,this.rows)}},{key:"destroy",value:function(){window.removeEventListener("resize",this.debouncedResize),this._disconnect(),null!==this.term&&(this.term.destroy(),this.term.removeAllListeners()),this._el.innerHTML=null,this._el.classList.remove("grv-terminal")}},{key:"reset",value:function(){this.term.reset()}},{key:"resize",value:function(e,t){try{if(!Object(nt.isInteger)(e)||!Object(nt.isInteger)(t)){var n=this._getDimensions();e=n.cols,t=n.rows}if(e===this.cols&&t===this.rows)return;this.cols=e,this.rows=t,this.term.resize(e,t)}catch(n){Po.error("xterm.resize",{w:e,h:t},n),this.term.reset()}}},{key:"_processData",value:function(e){try{this.term.write(e)}catch(t){Po.error("xterm.write",e,t),this.term.reset()}}},{key:"_processClose",value:function(e){var t=e.reason,n="disconnected";t&&(n=n+": "+t),n="[31m"+n+"[m\r\n",this.term.write(n)}},{key:"_disconnect",value:function(){this.tty.disconnect(),this.tty.removeAllListeners()}},{key:"_requestResize",value:function(){var e=this._getDimensions(),t=e.cols,n=e.rows;if(Object(nt.isInteger)(t)&&Object(nt.isInteger)(n)){var r=t<5?5:t,o=n<5?5:n;this.resize(r,o),this.tty.requestResize(r,o)}else Po.info("unable to calculate terminal dimensions (container might be hidden) "+t+":"+n)}},{key:"_getDimensions",value:function(){var e=this._el.querySelector(".terminal"),t=document.createElement("div");t.innerHTML="<span>&nbsp;</span>",e.appendChild(t);var n=t.getBoundingClientRect().height,r=t.firstElementChild.getBoundingClientRect().width,o=this._el.clientWidth,a=this._el.clientHeight,i=Math.floor(o/r),s=Math.floor(a/n);return e.removeChild(t),{cols:i,rows:s}}}]),e}(),Co=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},No=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Io=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._params={login:null,target:function(){throw Error("target method is not provided")},sid:null,clusterName:null,ttyUrl:null},this._params=Co({},t)}return No(e,[{key:"getConnStr",value:function(e,t){var n=this._params,r=n.getTarget,o=n.ttyUrl,a=n.login,i=n.sid,s=JSON.stringify(Co({},r(),{login:a,sid:i,term:{h:t,w:e}})),u=window.encodeURI(s);return this.format(o).replace(":params",u)}},{key:"format",value:function(e){return e.replace(":fqdm",l.a.getWsHostName()).replace(":token",this._params.token).replace(":cluster",this._params.cluster).replace(":sid",this._params.sid)}}]),e}(),xo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ro=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),xo(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.onSessionEnd,n=e.ttyParams,r=e.title,o=new Io(n);this.terminal=new To({el:this.refs.container,addressResolver:o}),this.terminal.open(),this.terminal.tty.on(vr,t),document.title=r}},{key:"componentWillUnmount",value:function(){this.terminal.destroy()}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"focus",value:function(){this.terminal.term.focus()}},{key:"render",value:function(){return o.a.createElement("div",{ref:"container"})}}]),t}(o.a.Component),Do=function(e){return o.a.createElement("div",{className:G()("grv-file-transfer-text",e.className)},e.children)},Ao=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Uo(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Lo=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=Uo(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={path:"~/"},r.onChangePath=function(e){r.setState({path:e.target.value})},r.onDownload=function(){r.isValidPath(r.state.path)&&r.props.onDownload(r.state.path)},r.onKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),r.onDownload())},Uo(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ao(t,[{key:"isValidPath",value:function(e){return e&&"/"!==e[e.length-1]}},{key:"moveCaretAtEnd",value:function(e){var t=e.target.value;e.target.value="",e.target.value=t}},{key:"render",value:function(){var e=this,t=this.state.path,n=!this.isValidPath(t);return o.a.createElement("div",{className:"grv-file-transfer-header m-b"},o.a.createElement(Do,{className:"m-b"},o.a.createElement("h4",null,"SCP DOWNLOAD")),o.a.createElement(Do,{className:"m-b-xs"},"File path"),o.a.createElement("div",{className:"grv-file-transfer-download"},o.a.createElement("input",{onChange:this.onChangePath,ref:function(t){return e.inputRef=t},value:t,className:"grv-file-transfer-input m-r-sm",autoFocus:!0,onFocus:this.moveCaretAtEnd,onKeyDown:this.onKeyDown}),o.a.createElement("button",{className:"btn btn-sm grv-file-transfer-btn",style:{width:"105px"},disabled:n,onClick:this.onDownload},"Download")))}}]),t}(o.a.Component);Lo.propTypes={onDownload:r.PropTypes.func.isRequired};var Fo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Wo(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var zo=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=Wo(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.state={files:[],remoteLocation:"~/"},r.onFileSelected=function(e){r.addFiles([],e.target.files),r.inputRef.focus()},r.onFilePathChanged=function(e){r.setState({remoteLocation:e.target.value})},r.onUpload=function(){for(var e=r.state,t=e.files,n=e.remoteLocation,o=0;o<t.length;o++)r.props.onUpload(n,t[o].name,t[o]);r.setState({files:[]}),r.setFocus()},r.onOpenFilePicker=function(){r.fileSelectorRef.value="",r.fileSelectorRef.click()},r.onDrop=function(e){e.preventDefault(),e.stopPropagation(),r.addFiles(r.state.files,e.dataTransfer.files),r.setFocus()},r.onKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),r.onOpenFilePicker())},Wo(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Fo(t,[{key:"componentWillUnmount",value:function(){document.removeEventListener("drop",this.onDocumentDrop),document.removeEventListener("dragover",this.preventDefault)}},{key:"componentDidMount",value:function(){document.addEventListener("dragover",this.preventDefault,!1),document.addEventListener("drop",this.onDocumentDrop,!1)}},{key:"preventDefault",value:function(e){e.preventDefault()}},{key:"onDocumentDrop",value:function(e){this.refDropzone&&this.refDropzone.contains(e.target)||(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")}},{key:"setFocus",value:function(){this.inputRef.focus()}},{key:"moveCaretAtEnd",value:function(e){var t=e.target.value;e.target.value="",e.target.value=t}},{key:"addFiles",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0;n<t.length;n++)e.push(t[n]);this.setState({files:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.remoteLocation,r=t.files,a=!n||0===r.length,i=r.length>0;return o.a.createElement("div",{className:"grv-file-transfer-header m-b"},o.a.createElement(Do,{className:"m-b"},o.a.createElement("h4",null,"SCP UPLOAD")),o.a.createElement("div",{className:"grv-file-transfer-upload"},o.a.createElement("div",{className:"grv-file-transfer-upload-selected-files",ref:function(t){return e.refDropzone=t},onDragOver:function(e){return e.preventDefault()},onDrop:this.onDrop},!i&&o.a.createElement("div",null,o.a.createElement("a",{onClick:this.onOpenFilePicker},"Select files")," to upload or drag & drop them here"),i&&o.a.createElement("div",null,o.a.createElement("a",{onClick:this.onOpenFilePicker}," ",r.length," files selected "))),o.a.createElement(Do,{className:"m-b-xs m-t"},"Upload destination"),o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("input",{className:"grv-file-transfer-input m-r-sm",ref:function(t){return e.inputRef=t},value:n,autoFocus:!0,onFocus:this.moveCaretAtEnd,onChange:this.onFilePathChanged,onKeyDown:this.onKeyDown}),o.a.createElement("button",{className:"btn btn-sm grv-file-transfer-btn",style:{width:"105px"},disabled:a,onClick:this.onUpload},"Upload")),o.a.createElement("input",{ref:function(t){return e.fileSelectorRef=t},type:"file",multiple:!0,style:{display:"none"},accept:"*.*",name:"file",onChange:this.onFileSelected})))}}]),t}(o.a.Component);zo.propTypes={onUpload:r.PropTypes.func.isRequired};var Mo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Bo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qo(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Vo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Ho=_.a.create("api/fileTransfer"),Ko="Network request failed",Jo=function(e){function t(){Bo(this,t);var e=qo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._xhr=new XMLHttpRequest;var n=e._xhr;return n.onload=function(){200!==n.status?e.handleError(n):e.handleSuccess(n)},n.onerror=function(){e.emit("error",new Error(Ko))},n.ontimeout=function(){e.emit("error",new Error(Ko))},n.onabort=function(){e.emit("error",new DOMException("Aborted","AbortError"))},e}return Vo(t,e),Mo(t,[{key:"abort",value:function(){this._xhr.abort()}},{key:"onProgress",value:function(e){this.on("progress",e)}},{key:"onCompleted",value:function(e){this.on("completed",e)}},{key:"onError",value:function(e){this.on("error",e)}},{key:"handleSuccess",value:function(){throw Error("not implemented")}},{key:"handleError",value:function(e){var t=Zo(e.response);this.emit("error",new Error(t))}},{key:"handleProgress",value:function(e){var t=0;if(e.lengthComputable)t=Math.round(e.loaded/e.total*100);else{var n=e.position||e.loaded,r=e.totalSize||e.total;t=Math.floor(n/r*1e3)/10}this.emit("progress",t)}}]),t}(lo.EventEmitter),Yo=function(e){function t(){return Bo(this,t),qo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return Vo(t,e),Mo(t,[{key:"handleSuccess",value:function(){this.emit("completed")}},{key:"do",value:function(e,t){var n=this;this._xhr.upload.addEventListener("progress",(function(e){n.handleProgress(e)})),this._xhr.open("post",e,!0),g.a.setAuthHeaders(this._xhr),g.a.setNoCacheHeaders(this._xhr),this._xhr.send(t)}}]),t}(Jo),Go=function(e){function t(){return Bo(this,t),qo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return Vo(t,e),Mo(t,[{key:"do",value:function(e){var t=this;this._xhr.open("get",e,!0),this._xhr.onprogress=function(e){t.handleProgress(e)},g.a.setAuthHeaders(this._xhr),this._xhr.responseType="blob",this._xhr.send()}},{key:"handleSuccess",value:function(e){var t=function(e){var t="",n=e.getResponseHeader("Content-Disposition");if(n){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(n);null!=r&&r[1]&&(t=r[1].replace(/['"]/g,""))}return decodeURIComponent(t)}(e);t?this.emit("completed",{fileName:t,blob:e.response}):this.emit("error",new Error("Bad response"))}},{key:"handleError",value:function(e){var t=this,n=new FileReader;n.onerror=function(e){t.emit("error",e)},n.onload=function(){var e=Zo(n.result);t.emit("error",new Error(e))},n.readAsText(e.response)}}]),t}(Jo);function Zo(e,t){if(!e)return t||"Bad request";try{var n=JSON.parse(e);if(n.message)return n.message;if(t)return t}catch(e){Ho.error("faild to parse error message",e)}return"Bad request"}var Xo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Qo=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var $o=function(e){return function(t){var n,r;return r=n=function(n){function r(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n));return o.state={progress:"0",response:null},o.onRemove=function(){var e;e=o.fileId,m.a.dispatch(qn,e)},o.http=new e,o.fileId=t.file.id,o.fileBlob=t.file.blob,o.fileUrl=t.file.url,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,n),Qo(r,[{key:"componentWillUnmount",value:function(){this.http.removeAllListeners(),this.http.abort()}},{key:"componentDidMount",value:function(){var e=this;Kr({id:this.fileId,isProcessing:!0}),this.http.onProgress((function(t){e.setState({progress:t})})),this.http.onCompleted((function(t){e.state.response=t,Kr({id:e.fileId,isCompleted:!0})})),this.http.onError((function(t){Kr({id:e.fileId,isFailed:!0,error:t.message})})),this.http.do(this.fileUrl,this.fileBlob)}},{key:"render",value:function(){var e=this.state,n=e.response,r=e.progress;return o.a.createElement(t,Xo({},this.props,{onRemove:this.onRemove,httpResponse:n,httpProgress:r}))}}]),r}(o.a.Component),n.displayName="WithHttpRequestWrapper",r}},ea=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function ta(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var na=function(e){var t=e.files;if(0===t.length)return null;var n=t.map((function(e){var t=e.id;return e.isUpload?o.a.createElement(oa,{key:t,file:e}):o.a.createElement(aa,{key:t,file:e})}));return o.a.createElement("div",{className:"m-t-sm"},o.a.createElement("div",{className:"grv-file-transfer-header m-b-sm"}),o.a.createElement("div",{className:"grv-file-transfer-file-list-cols"},o.a.createElement(Do,null," File "),o.a.createElement(Do,null,"Status "),o.a.createElement("div",null," ")),o.a.createElement("div",{className:"grv-file-transfer-content"},o.a.createElement("div",{className:"grv-file-transfer-file-list"},n)))},ra=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=ta(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.savedToDisk=!1,r.onRemove=function(){r.props.onRemove()},ta(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ea(t,[{key:"componentDidUpdate",value:function(){var e=this.props.file,t=e.isCompleted,n=e.isUpload;t&&!n&&this.saveToDisk(this.props.httpResponse)}},{key:"saveToDisk",value:function(e){var t=e.fileName,n=e.blob;if(!this.savedToDisk)if(this.savedToDisk=!0,window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,t);else{var r=document.createElement("a");r.href=window.URL.createObjectURL(n),r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)}}},{key:"render",value:function(){var e=this.props.file,t=e.name,n=e.isFailed,r=e.isProcessing,a=e.isCompleted,i=e.error,s=this.props.httpProgress,u=G()("grv-file-transfer-file-list-item",n&&"--failed",r&&"--processing",a&&"--completed");return o.a.createElement("div",{className:u},o.a.createElement("div",{className:"grv-file-transfer-file-path"},t,n&&o.a.createElement("div",null," ",i," ")),o.a.createElement("div",{className:"grv-file-transfer-file-status"},n&&o.a.createElement("div",null,"failed"),r&&o.a.createElement("div",null,s,"%"),a&&o.a.createElement(Do,null,"completed")),r&&o.a.createElement("div",{className:"grv-file-transfer-file-close"},o.a.createElement("a",{onClick:this.onRemove},"cancel")))}}]),t}(r.Component);ra.propTypes={file:r.PropTypes.object.isRequired,onRemove:r.PropTypes.func.isRequired,httpResponse:r.PropTypes.object};var oa=$o(Yo)(ra),aa=$o(Go)(ra),ia=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function sa(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ua=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=sa(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onDownload=function(e){r.transfer(e,e,!1)},r.onUpload=function(e,t,n){r.transfer(e,t,!0,n)},r.onKeyDown=function(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),r.onClose())},r.onClose=function(){var e=r.props.store.isTransfering();e||r.props.onClose(),e&&window.confirm("Are you sure you want to cancel file transfers?")&&r.props.onClose()},sa(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ia(t,[{key:"transfer",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.props.onTransfer({location:e,name:t,isUpload:n,blob:r})}},{key:"render",value:function(){var e=this.props.store;if(!e.isOpen)return null;var t=e.files,n=e.isUpload,r=t.toArray().reverse();return o.a.createElement("div",{className:"grv-file-transfer p-sm",onKeyDown:this.onKeyDown},!n&&o.a.createElement(Lo,{onDownload:this.onDownload}),n&&o.a.createElement(zo,{onUpload:this.onUpload}),o.a.createElement(na,{files:r}),o.a.createElement("div",{className:"grv-file-transfer-footer"},o.a.createElement("button",{onClick:this.onClose,className:"btn btn-sm  grv-file-transfer-btn"},"Close")))}}]),t}(r.Component);ua.propTypes={store:r.PropTypes.object.isRequired,onTransfer:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired};var ca=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},la=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var fa=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.startNew=function(){var e=ca({},n.props.routeParams,{sid:void 0});Ur(e),Dr(e)},n.replay=function(){var e=n.props.routeParams;!function(e,t){var n=l.a.getPlayerUrl({siteId:e,sid:t});v.push(n)}(e.siteId,e.sid)},n.onCloseFileTransfer=function(){Jr(),n.termRef&&n.termRef.focus()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),la(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){return Dr(e.props.routeParams)}),0)}},{key:"render",value:function(){var e=this,t=this.props,n=t.termStore,r=t.fileStore,a=n.status,i=n.sid,s=n.getServerLabel(),u=null,c=null;if(a.isLoading&&(u=o.a.createElement(Nn,{type:"bounce"})),a.isError&&(u=o.a.createElement(pa,{text:a.errorText})),a.isNotFound&&(u=o.a.createElement(ha,{onReplay:this.replay,onNew:this.startNew})),a.isReady){var l=n.getTtyParams();u=o.a.createElement(Ro,{ref:function(t){return e.termRef=t},title:s,onSessionEnd:Ar,ttyParams:l}),c=o.a.createElement(so,{sid:i})}return o.a.createElement("div",null,o.a.createElement(ua,{store:r,onClose:this.onCloseFileTransfer,onTransfer:Hr}),o.a.createElement("div",{className:"grv-terminalhost"},o.a.createElement(oo,null,c),o.a.createElement("div",{className:"grv-terminalhost-server-info"},o.a.createElement("h3",null,s)),u))}}]),t}(o.a.Component),pa=function(e){var t=e.text;return o.a.createElement("div",{className:"grv-terminalhost-indicator-error"},o.a.createElement("i",{className:"fa fa-exclamation-triangle fa-3x text-warning"}),o.a.createElement("div",{className:"m-l"},o.a.createElement("strong",null,"Connection error"),o.a.createElement("div",null,o.a.createElement("small",null,t))))},ha=function(e){var t=e.onNew,n=e.onReplay;return o.a.createElement("div",{className:"grv-terminalhost-indicator-error"},o.a.createElement("div",{className:"text-center"},o.a.createElement("strong",null,"The session is no longer active"),o.a.createElement("div",{className:"m-t"},o.a.createElement("button",{onClick:t,className:"btn btn-sm btn-primary m-r"}," Start New "),o.a.createElement("button",{onClick:n,className:"btn btn-sm btn-primary"}," Replay "))))};var da=Object(c.connect)((function(){return{termStore:Wn.store,fileStore:tr.store}}))(fa),va=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ma=[{path:l.a.routes.nodes,title:"Nodes",component:Pn},{path:l.a.routes.terminal,title:"Terminal",components:{CurrentSessionHost:da}}],ya={icon:"fa fa-share-alt",to:l.a.routes.nodes,title:"Nodes"},ba=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.push.apply(e,ma),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),va(t,[{key:"onload",value:function(){Kt(ya)}}]),t}(Fn),ga=n("VW/0"),wa=n("F+qq"),Ea=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var _a=3e3,Oa=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._timerId=null,n._request=null,n._intervalTime=e.time||_a,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ea(t,[{key:"fetch",value:function(){var e=this;this._request||(this._request=this.props.onFetch().always((function(){e._request=null})))}},{key:"componentDidMount",value:function(){this.fetch(),this._timerId=setInterval(this.fetch.bind(this),this._intervalTime)}},{key:"componentWillUnmount",value:function(){clearInterval(this._timerId)}},{key:"render",value:function(){return null}}]),t}(r.Component),ja=n("BBHA"),ka=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var Pa={flex:{display:"flex"},justify:{start:{justifyContent:"flex-start"},end:{justifyContent:"flex-end"},between:{justifyContent:"space-between"}},align:{center:{alignItems:"center"},start:{alignItems:"flex-start"},end:{alignItems:"flex-end"},baseline:{alignItems:"baseline"}},dir:{row:{flexDirection:"row"},col:{flexDirection:"column"}}},Sa=function(e){var t,n,r,a,i,s,u,c,l=e.className,f=void 0===l?"":l,p=e.children,h=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["className","children"]);return o.a.createElement("div",{className:f,style:(t=h,n=t.dir,r=void 0===n?"col":n,a=t.align,i=void 0===a?"start":a,s=t.justify,u=void 0===s?"start":s,c=t.style,ka({},void 0===c?{}:c,Pa.flex,Pa.dir[r],Pa.justify[u],Pa.align[i]))},p)},Ta=n("X2Fi"),Ca=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Na=o.a.PropTypes.oneOf(["click","hover","focus"]),Ia={trigger:o.a.PropTypes.oneOfType([Na,o.a.PropTypes.arrayOf(Na)]),delay:o.a.PropTypes.number,delayShow:o.a.PropTypes.number,delayHide:o.a.PropTypes.number,defaultOverlayShown:o.a.PropTypes.bool,overlay:o.a.PropTypes.node.isRequired,onBlur:o.a.PropTypes.func,onClick:o.a.PropTypes.func,onFocus:o.a.PropTypes.func,onMouseOut:o.a.PropTypes.func,onMouseOver:o.a.PropTypes.func,target:o.a.PropTypes.oneOf([null]),onHide:o.a.PropTypes.oneOf([null]),show:o.a.PropTypes.oneOf([null])},xa=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.getElement=r.getElement.bind(r),r.handleToggle=r.handleToggle.bind(r),r.handleHide=r.handleHide.bind(r),r.state={show:e.defaultOverlayShown},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ca(t,[{key:"handleToggle",value:function(){this.state.show?this.hide():this.show()}},{key:"handleHide",value:function(){this.hide()}},{key:"show",value:function(){this.setState({show:!0})}},{key:"hide",value:function(){this.setState({show:!1})}},{key:"getElement",value:function(){return i.a.findDOMNode(this)}},{key:"render",value:function(){var e=this,t=this.props,n=t.container,r=void 0===n?this:n,a=t.placement,i=t.overlay;return o.a.createElement("div",{onClick:this.handleToggle},this.props.children,o.a.createElement(Ta.Overlay,{rootClose:!0,placement:a,show:this.state.show,onHide:this.handleHide,target:function(){return e.getElement()},container:r},i))}}]),t}(o.a.Component);xa.propTypes=Ia,xa.defaultProps={defaultOverlayShown:!1,trigger:["hover","focus"]};var Ra=xa,Da={"btn grv-btn-details":!0},Aa=function(e){return o.a.createElement("button",{className:G()(e.className,Da)},o.a.createElement("span",null,"…"))};Aa.WithOverlay=function(e){return o.a.createElement(Ra,e,o.a.createElement(Aa,null))};var Ua=Aa,La=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Fa=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Wa={placement:o.a.PropTypes.oneOf(["top","right","bottom","left"]),positionTop:o.a.PropTypes.oneOfType([o.a.PropTypes.number,o.a.PropTypes.string]),positionLeft:o.a.PropTypes.oneOfType([o.a.PropTypes.number,o.a.PropTypes.string]),arrowOffsetTop:o.a.PropTypes.oneOfType([o.a.PropTypes.number,o.a.PropTypes.string]),arrowOffsetLeft:o.a.PropTypes.oneOfType([o.a.PropTypes.number,o.a.PropTypes.string]),title:o.a.PropTypes.node},za=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Fa(t,[{key:"render",value:function(){var e,t,n,r=this.props,a=r.placement,i=r.positionTop,s=r.positionLeft,u=r.arrowOffsetTop,c=r.arrowOffsetLeft,l=r.title,f=r.className,p=r.style,h=r.children,d=(n=!0,(t=a)in(e={popover:!0})?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e),v=La({display:"block",top:i,left:s},p),m={top:u,left:c};return o.a.createElement("div",{role:"tooltip",className:G()(f,d),style:v},o.a.createElement("div",{className:"arrow",style:m}),l&&o.a.createElement("h3",{className:"popover-title"},l),o.a.createElement("div",{className:"popover-content"},h))}}]),t}(o.a.Component);za.propTypes=Wa,za.defaultProps={placement:"right"};var Ma=za;function Ba(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}var qa=function(e){var t=e.rowIndex,n=e.data,r=Ba(e,["rowIndex","data"]),a=n[t].createdDisplayText;return o.a.createElement(St,r,a)},Va=function(e){var t=e.rowIndex,n=e.data,r=Ba(e,["rowIndex","data"]),a=n[t].duration,i=pr.a.duration(a).humanize();return o.a.createElement(St,r,i)},Ha=function(e){var t=e.rowIndex,n=e.data,r=Ba(e,["rowIndex","data"]),a=n[t],i=a.parties,s=a.user,u=o.a.createElement("div",{className:"grv-sessions-user"},s);return i.length>0&&(u=i.map((function(e,t){return o.a.createElement("div",{key:t,className:"grv-sessions-user"},e)}))),o.a.createElement(St,r,o.a.createElement("div",null,u))},Ka=function(e){return o.a.createElement(Ma,{className:"grv-sessions-stored-details"},o.a.createElement("div",null,e))},Ja=function(e){var t=e.rowIndex,n=e.canJoin,r=e.data,a=e.container,i=Ba(e,["rowIndex","canJoin","data","container"]),s=r[t],c=s.sessionUrl,l=s.active,f=s.sid,p=l&&!n,h=f.slice(0,8),d=l?"join":"play",v=G()("btn btn-xs m-r-sm",{"btn-primary":!l,"btn-warning":l,disabled:p});return o.a.createElement(St,i,o.a.createElement(Sa,{dir:"row",align:"center"},p&&o.a.createElement("button",{className:v},d),!p&&o.a.createElement(u.Link,{to:c,className:v,type:"button"},d),o.a.createElement("span",{style:{width:"75px"}},h),o.a.createElement(Ua.WithOverlay,{trigger:"click",placement:"bottom",container:a,overlay:Ka(f)})))},Ya=function(e){var t=e.rowIndex,n=e.data,r=Ba(e,["rowIndex","data"]),a=n[t].nodeDisplayText;return o.a.createElement(St,r,a)},Ga=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function Za(e,t){return pr()(e).isSame(t,"day")}var Xa=o.a.createClass({displayName:"DateRangePicker",getDates:function(){var e=b()(this.refs.dpPicker1).datepicker("getDate"),t=b()(this.refs.dpPicker2).datepicker("getDate");return[e,pr()(t).endOf("day").toDate()]},setDates:function(e){var t=e.startDate,n=e.endDate;b()(this.refs.dpPicker1).datepicker("setDate",t),b()(this.refs.dpPicker2).datepicker("setDate",n)},getDefaultProps:function(){return{startDate:pr()().startOf("month").toDate(),endDate:pr()().endOf("month").toDate(),onChange:function(){}}},componentWillUnmount:function(){b()(this.refs.dp).datepicker("destroy")},componentWillReceiveProps:function(e){var t=this.getDates(),n=Ga(t,2),r=n[0],o=n[1];Za(r,e.startDate)&&Za(o,e.endDate)||this.setDates(e)},shouldComponentUpdate:function(){return!1},componentDidMount:function(){this.onChange=Object(nt.debounce)(this.onChange,1),b()(this.refs.rangePicker).datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,autoclose:!0}),this.setDates(this.props),b()(this.refs.rangePicker).datepicker().on("changeDate",this.onChange)},onChange:function(){var e=this.getDates(),t=Ga(e,2),n=t[0],r=t[1];Za(n,this.props.startDate)&&Za(r,this.props.endDate)||this.props.onChange({startDate:n,endDate:r})},render:function(){return o.a.createElement("div",{className:"grv-datepicker input-group input-group-sm input-daterange",ref:"rangePicker"},o.a.createElement("input",{ref:"dpPicker1",type:"text",className:"input-sm form-control",name:"start"}),o.a.createElement("span",{className:"input-group-addon"},"to"),o.a.createElement("input",{ref:"dpPicker2",type:"text",className:"input-sm form-control",name:"end"}))}}),Qa=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function $a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var ei=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.searchableProps=["nodeDisplayText","createdDisplayText","sid","parties"],n._mounted=!1,n.onSearchChange=function(e){n.state.searchValue=e,n.setState(n.state)},n.onSortChange=function(e,t){var r,o,a;n.state.colSortDirs=(a=t,(o=e)in(r={})?Object.defineProperty(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a,r),n.setState(n.state)},n.onRangePickerChange=function(e){var t=e.startDate,r=e.endDate;n._mounted&&ja.actions.setTimeRange(t,r)},e.storage&&(n.state=e.storage.findByKey("SessionList")),n.state||(n.state={searchValue:"",colSortDirs:{created:"ASC"}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Qa(t,[{key:"componentDidMount",value:function(){this._mounted=!0}},{key:"componentWillUnmount",value:function(){this._mounted=!1,this.props.storage&&this.props.storage.save("SessionList",this.state)}},{key:"searchAndFilterCb",value:function(e,t,n){if("parties"===n)return-1!==(e=e||[]).join("").toLocaleUpperCase().indexOf(t)}},{key:"sortAndFilter",value:function(e){var t=this,n=e.filter((function(e){return it(e,t.state.searchValue,{searchableProps:t.searchableProps,cb:t.searchAndFilterCb})})),r=Object.getOwnPropertyNames(this.state.colSortDirs)[0],o=this.state.colSortDirs[r],a=Object(nt.sortBy)(n,r);return o===jt.ASC&&(a=a.reverse()),a}},{key:"render",value:function(){var e=this.props,t=e.filter,n=e.storedSessions,r=e.activeSessions,a=t.start,i=t.end,s=l.a.canJoinSessions,u=this.state.searchValue,c=n.filter((function(e){return pr()(e.created).isBetween(a,i)})),f=r.filter((function(e){return e.parties.length>0})).filter((function(e){return pr()(e.created).isBetween(a,i)}));c=this.sortAndFilter(c),f=this.sortAndFilter(f);var p=[].concat($a(f),$a(c));return o.a.createElement("div",{className:"grv-sessions-stored m-t"},o.a.createElement("div",{className:"grv-header"},o.a.createElement("div",{className:"grv-flex m-b-md",style:{justifyContent:"space-between"}},o.a.createElement("div",{className:"grv-flex"},o.a.createElement("h2",{className:"text-center"}," Sessions ")),o.a.createElement("div",{className:"grv-flex"},o.a.createElement(Qt,null),o.a.createElement(ut,{autoFocus:!0,value:u,onChange:this.onSearchChange}),o.a.createElement("div",{className:"m-l-sm"},o.a.createElement(Xa,{startDate:a,endDate:i,onChange:this.onRangePickerChange}))))),o.a.createElement("div",{className:"grv-content"},0===p.length?o.a.createElement(Nt,{text:"No matching sessions found"}):o.a.createElement(Tt,{data:p,rowCount:p.length},o.a.createElement(Ct,{header:o.a.createElement(St,{className:"grv-sessions-col-sid"}," Session ID "),cell:o.a.createElement(Ja,{canJoin:s,container:this})}),o.a.createElement(Ct,{header:o.a.createElement(St,null," User "),cell:o.a.createElement(Ha,null)}),o.a.createElement(Ct,{columnKey:"nodeIp",header:o.a.createElement(St,{className:"grv-sessions-stored-col-ip"},"Node"),cell:o.a.createElement(Ya,null)}),o.a.createElement(Ct,{columnKey:"created",header:o.a.createElement(Pt,{sortDir:this.state.colSortDirs.created,onSortChange:this.onSortChange,title:"Created (UTC)"}),cell:o.a.createElement(qa,null)}),o.a.createElement(Ct,{columnKey:"duration",header:o.a.createElement(Pt,{sortDir:this.state.colSortDirs.duration,onSortChange:this.onSortChange,title:"Duration"}),cell:o.a.createElement(Va,null)}))))}}]),t}(o.a.Component),ti=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function ni(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ri=jn(function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=ni(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.refresh=function(){return Object(ga.fetchSiteEventsWithinTimeRange)()},ni(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ti(t,[{key:"render",value:function(){var e=this.props,t=e.siteId,n=e.storedSessions,r=e.activeSessions,a=e.storedSessionsFilter,i=t+" · Sessions";return o.a.createElement(ie,{title:i},o.a.createElement("div",{className:"grv-page grv-sessions"},o.a.createElement(ei,{storage:this.props.storage,activeSessions:r,storedSessions:n,filter:a}),o.a.createElement(Oa,{onFetch:this.refresh})))}}]),t}(o.a.Component)),oi=$r((function(){return{siteId:tt.a.siteId,activeSessions:Pr.activeSessionList,storedSessions:Pr.storedSessionList,storedSessionsFilter:wa.default.filter}}))(ri),ai=n("Se41"),ii=n.n(ai),si=n("uz9f"),ui=n.n(si),ci=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},li=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function fi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var pi=_.a.create("TtyPlayer"),hi=po.a.Buffer,di=function(){function e(t){var n=t.url;fi(this,e),this.url=n,this.events=[]}return li(e,[{key:"getDuration",value:function(){var e=this.events.length;return 0===e?0:this.events[e-1].msNormalized}},{key:"init",value:function(){var e=this;return this._fetchEvents().then((function(t){e.events=t;var n=e.events.filter(mi);if(0!==n.length)return e._fetchContent(n).then((function(t){e._populatePrintEvents(t,n)}))}))}},{key:"_fetchEvents",value:function(){var e=this,t=this.url+"/events";return g.a.get(t).then((function(t){return t.events?e._createEvents(t.events):[]}))}},{key:"_fetchContent",value:function(e){for(var t=e[0].offset,n=e.length-1,r=e[n].offset-t+e[n].bytes,o=Math.ceil(r/5242880),a=[],i=0;i<o;i++){var s=this.url+"/stream?offset="+t+"&bytes=5242880";a.push(g.a.ajax({url:s,processData:!0,dataType:"text"})),t+=5242880}return b.a.when.apply(b.a,a).then((function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=(t=1===a.length?[[t]]:t).reduce((function(e,t){return e+t[0]}),"");return new hi(r)}))}},{key:"_populatePrintEvents",value:function(e,t){var n=t[0].bytes;t[0].data=e.slice(0,n).toString("utf8");for(var r=1;r<t.length;r++){var o=t[r].bytes;t[r].data=e.slice(n,n+o).toString("utf8"),n+=o}}},{key:"_createEvents",value:function(e){for(var t=void 0,n=void 0,r=[],o=0;o<e.length;o++){var a=e[o],i=a.ms,s=a.event,u=a.offset,c=a.time,l=a.bytes;if(s===hr.RESIZE||s===hr.START){var f=e[o].size.split(":"),p=ci(f,2);t=p[0],n=p[1]}if(s===hr.END){var h=new Date(r[0].time),d=new Date(c).getTime()-h.getTime();r.push({eventType:s,ms:d,time:new Date(c)});break}s===hr.PRINT&&r.push({eventType:hr.PRINT,ms:i,bytes:l,offset:u,data:null,w:Number(t),h:Number(n),time:new Date(c)})}return this._normalizeEventsByTime(r)}},{key:"_normalizeEventsByTime",value:function(e){if(!e||0===e.length)return[];e.forEach((function(e){e.displayTime=function(e){if(e<=0)return"00:00";var t=Math.floor(e/1e3)%31536e3%86400,n=Math.floor(t/3600),r=Math.floor(t%3600/60),o=t%3600%60;return""+(n=n>0?n+":":"")+(r=r>9?r:"0"+r)+":"+(o=o>9?o:"0"+o)}(e.ms),e.ms=e.ms>0?Math.floor(e.ms/10):0,e.msNormalized=e.ms}));for(var t=e[0],n=[],r=1;r<e.length;r++){var o=t.w===e[r].w&&t.h===e[r].h,a=e[r].ms-t.ms;a<2&&o?t.bytes+=e[r].bytes:(e[r].msNormalized=t.msNormalized+vi(a),n.push(t),t=e[r])}return-1===n.indexOf(t)&&n.push(t),n}}]),e}();function vi(e){return e>=25&&e<50?25:e>=50&&e<100?50:e>=100?100:e}function mi(e){return e.eventType===hr.PRINT}var yi=function(e){function t(e){var n=e.url;fi(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{}));return r.currentEventIndex=0,r.current=0,r.duration=0,r.isPlaying=!1,r.isError=!1,r.isReady=!1,r.isLoading=!0,r.errText="",r._posToEventIndexMap=[],r._eventProvider=new di({url:n}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),li(t,[{key:"send",value:function(){}},{key:"connect",value:function(){var e=this;this._setStatusFlag({isLoading:!0}),this._eventProvider.init().then((function(){e._init(),e._setStatusFlag({isReady:!0})})).fail((function(t){pi.error("unable to init event provider",t),e.handleError(t)})).always(this._change.bind(this)),this._change()}},{key:"handleError",value:function(e){this._setStatusFlag({isError:!0,errText:g.a.getErrorText(e)})}},{key:"_init",value:function(){var e=this;this.duration=this._eventProvider.getDuration(),this._eventProvider.events.forEach((function(t){return e._posToEventIndexMap.push(t.msNormalized)}))}},{key:"move",value:function(e){if(this.isReady){void 0===e&&(e=this.current+1),e<0&&(e=0),e>this.duration&&this.stop();var t=this._getEventIndex(e)+1;if(t===this.currentEventIndex)return this.current=e,void this._change();var n=this.currentEventIndex>t;try{n&&this.emit(mr);var r=n?0:this.currentEventIndex,o=t,a=this._eventProvider.events.slice(r,o).filter(mi);this._display(a),this.currentEventIndex=t,this.current=e,this._change()}catch(e){pi.error("move",e),this.handleError(e)}}}},{key:"stop",value:function(){this.isPlaying=!1,this.timer=clearInterval(this.timer),this._change()}},{key:"play",value:function(){this.isPlaying||(this.isPlaying=!0,this.current>=this.duration&&(this.current=0,this.emit(mr)),this.timer=setInterval(this.move.bind(this),5),this._change())}},{key:"getCurrentTime",value:function(){return this.currentEventIndex?this._eventProvider.events[this.currentEventIndex-1].displayTime:"--:--"}},{key:"getEventCount",value:function(){return this._eventProvider.events.length}},{key:"_display",value:function(e){if(e&&0!==e.length){for(var t=[{data:[e[0].data],w:e[0].w,h:e[0].h}],n=t[0],r=1;r<e.length;r++)n.w===e[r].w&&n.h===e[r].h?n.data.push(e[r].data):(n={data:[e[r].data],w:e[r].w,h:e[r].h},t.push(n));for(var o=0;o<t.length;o++){var a=t[o].data.join(""),i=t[o],s=i.h,u=i.w;a.length>0&&(this.emit(dr,{h:s,w:u}),this.emit(yr,a))}}}},{key:"_setStatusFlag",value:function(e){var t=e.isReady,n=void 0!==t&&t,r=e.isError,o=void 0!==r&&r,a=e.isLoading,i=void 0!==a&&a,s=e.errText,u=void 0===s?"":s;this.isReady=n,this.isError=o,this.isLoading=i,this.errText=u}},{key:"_getEventIndex",value:function(e){for(var t=this._posToEventIndexMap,n=0,r=t.length-1;r-n>1;){var o=Math.floor((n+r)/2);t[o]<e?n=o:r=o}return e-t[n]<=t[r]-e?n:r}},{key:"_change",value:function(){this.emit("change")}}]),t}(jo),bi=function(e){var t=e.text;return o.a.createElement("div",{className:"grv-terminalhost-indicator-error"},o.a.createElement("i",{className:"fa fa-exclamation-triangle fa-3x text-warning"}),o.a.createElement("div",{className:"m-l"},o.a.createElement("strong",null,t||"Error")))},gi=function(e){var t=e.text;return o.a.createElement("div",{className:"grv-terminalhost-indicator-error"},o.a.createElement("h3",null,t))},wi=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ei=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(r):void 0};function _i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oi(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ji(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}ii()(b.a);var ki=function(e){function t(e,n){_i(this,t);var r=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{el:n,scrollBack:1e3}));return r.tty=e,r}return ji(t,e),wi(t,[{key:"connect",value:function(){}},{key:"open",value:function(){Ei(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"open",this).call(this),b()(this._el).perfectScrollbar()}},{key:"resize",value:function(e,n){this.term.cursorState=1,Ei(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resize",this).call(this,e,n),b()(this._el).perfectScrollbar("update")}},{key:"destroy",value:function(){Ei(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),b()(this._el).perfectScrollbar("destroy")}},{key:"_disconnect",value:function(){}},{key:"_requestResize",value:function(){}}]),t}(To),Pi=function(e){function t(){return _i(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ji(t,e),wi(t,[{key:"componentDidMount",value:function(){var e=this.props.tty;this.terminal=new ki(e,this.refs.container),this.terminal.open()}},{key:"componentWillUnmount",value:function(){this.terminal.destroy()}},{key:"render",value:function(){var e={visibility:this.props.tty.isLoading?"hidden":"initial"};return o.a.createElement("div",{style:e,ref:"container"})}}]),t}(o.a.Component);Pi.propTypes={tty:o.a.PropTypes.object.isRequired};var Si=function(e){function t(){return _i(this,t),Oi(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ji(t,e),wi(t,[{key:"componentDidMount",value:function(){var e=i.a.findDOMNode(this).querySelector(".grv-session-player-controls button");e&&e.focus()}},{key:"render",value:function(){var e=this.props,t=e.isPlaying,n=e.min,r=e.max,a=e.value,i=e.onChange,s=e.onToggle,u=e.time,c=t?"fa fa-stop":"fa fa-play";return o.a.createElement("div",{className:"grv-session-player-controls"},o.a.createElement("button",{className:"btn",onClick:s},o.a.createElement("i",{className:c})),o.a.createElement("div",{className:"grv-session-player-controls-time"},u),o.a.createElement("div",{className:"grv-flex-column"},o.a.createElement(ui.a,{min:n,max:r,value:a,onChange:i,defaultValue:1,withBars:!0,className:"grv-slider"})))}}]),t}(o.a.Component),Ti=function(e){function t(e){_i(this,t);var n=Oi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.updateState=function(){var e=n.calculateState();n.setState(e)},n.onTogglePlayStop=function(){n.state.isPlaying?n.tty.stop():n.tty.play()},n.onMove=function(e){n.tty.move(e)};var r=n.props.url;return n.tty=new yi({url:r}),n.state=n.calculateState(),n}return ji(t,e),wi(t,[{key:"calculateState",value:function(){return{eventCount:this.tty.getEventCount(),duration:this.tty.duration,min:1,time:this.tty.getCurrentTime(),isLoading:this.tty.isLoading,isPlaying:this.tty.isPlaying,isError:this.tty.isError,errText:this.tty.errText,current:this.tty.current,canPlay:this.tty.length>1}}},{key:"componentDidMount",value:function(){this.tty.on("change",this.updateState),this.tty.connect(),this.tty.play()}},{key:"componentWillUnmount",value:function(){this.tty.stop(),this.tty.removeAllListeners()}},{key:"render",value:function(){var e=this.state,t=e.isPlaying,n=e.isLoading,r=e.isError,a=e.errText,i=e.time,s=e.min,u=e.duration,c=e.current,l=e.eventCount;return r?o.a.createElement(bi,{text:a}):n||0!==l?o.a.createElement("div",{className:"grv-session-player-content"},o.a.createElement(Pi,{tty:this.tty}),n&&o.a.createElement(Nn,null),l>0&&o.a.createElement(Si,{isPlaying:t,time:i,min:s,max:u,value:c,onToggle:this.onTogglePlayStop,onChange:this.onMove})):o.a.createElement(gi,{text:"The recording for this session is not available."})}}]),t}(o.a.Component),Ci=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ni=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ci(t,[{key:"componentWillMount",value:function(){var e=this.props.params,t=e.sid,n=e.siteId;this.url=l.a.api.getFetchSessionUrl({siteId:n,sid:t})}},{key:"render",value:function(){if(!this.url)return null;var e=this.props.params.siteId+" · Player";return o.a.createElement(ie,{title:e},o.a.createElement("div",{className:"grv-terminalhost grv-session-player"},o.a.createElement("div",{className:"grv-session-player-actions m-t-md"},o.a.createElement("div",{title:"Close",style:Ii,onClick:qr},o.a.createElement($,null))),o.a.createElement(Ti,{url:this.url})))}}]),t}(o.a.Component),Ii={width:"30px",height:"30px",display:"block",margin:"0 auto"},xi=Ni,Ri=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Di={icon:"fa  fa-group",to:l.a.routes.sessions,title:"Sessions"},Ai=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=[{path:l.a.routes.sessions,title:"Sessions",component:n.withMe(oi)},{path:l.a.routes.player,title:"Player",components:{CurrentSessionHost:xi}}];return e.push.apply(e,r),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ri(t,[{key:"componentDidMount",value:function(){this.init()}},{key:"init",value:function(){var e=this;this.wasInitialized()||m.a.batch((function(){e.startProcessing(),Object(ga.fetchSiteEventsWithinTimeRange)().done(e.stopProcessing.bind(e)).fail(e.handleError.bind(e))}))}}]),Ri(t,[{key:"onload",value:function(){Mr().getSessionAccess().list&&(Kt(Di),this.init())}}]),t}(Fn),Ui=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Li=_.a.create("featureActivator"),Fi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._features=[]}return Ui(e,[{key:"register",value:function(e){if(!e)throw Error("Feature is undefined");this._features.push(e)}},{key:"preload",value:function(e){var t=this._features.map((function(t){var n=b.a.Deferred();return t.init(e).always((function(){n.resolve()})),n}));return b.a.when.apply(b.a,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))}},{key:"onload",value:function(e){var t=this;this._features.forEach((function(n){t._invokeOnload(n,e)}))}},{key:"getFirstAvailable",value:function(){return this._features.find((function(e){return!e.isFailed()}))}},{key:"getFeatures",value:function(){return this._features}},{key:"_invokeOnload",value:function(e){try{for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.onload.apply(e,n)}catch(e){Li.error("failed to invoke feature onload()",e)}}}]),e}(),Wi={store:["tlpt_settings"]},zi=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Mi=function(){return o.a.createElement("div",{className:"grv-settings-header-line-solid m-t-sm m-b-sm"})},Bi=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),zi(t,[{key:"renderHeaderItem",value:function(e,t){var n=e.to,r=e.isIndex,a=e.title,i=this.context.router.isActive(n,r)?"active":"";return o.a.createElement("li",{key:t,className:i},o.a.createElement(u.Link,{to:n},o.a.createElement("h2",{className:"m-b-xxs"},a)),o.a.createElement(Mi,null))}},{key:"render",value:function(){var e=this.props.store,t=e.getNavItems().map(this.renderHeaderItem.bind(this));return e.isReady()?o.a.createElement("div",{className:"grv-page grv-settings"},o.a.createElement("ul",{className:"grv-settings-header-menu"},t),t.length>0&&o.a.createElement(Mi,null),this.props.children):null}}]),t}(o.a.Component);Bi.contextTypes={router:r.PropTypes.object.isRequired};var qi=Object(c.connect)((function(){return{store:Wi.store}}))(Bi),Vi="SETTINGS_INIT",Hi="SETTINGS_ADD_NAV_ITEM";var Ki=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Ji=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ki(t,[{key:"componentDidMount",value:function(){var e=this.getAvailableRoute();e&&this.props.router.replace({pathname:e})}},{key:"getAvailableRoute",value:function(){var e=this.props.store.getNavItems();return e&&e[0]?e[0].to:null}},{key:"render",value:function(){return o.a.createElement(Ue,null)}}]),t}(o.a.Component);Ji.propTypes={router:o.a.PropTypes.object.isRequired,store:o.a.PropTypes.object.isRequired,location:o.a.PropTypes.object.isRequired};var Yi=$r((function(){return{store:Wi.store}}))(Ji),Gi=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(r):void 0},Zi=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Xi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qi(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function $i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var es={icon:"fa fa-wrench",to:l.a.routes.settingsBase,title:"Settings"},ts=function(e){function t(e){return Xi(this,t),Qi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return $i(t,e),Zi(t,[{key:"isEnabled",value:function(){return!0}}]),t}(Fn),ns=function(e){function t(e){Xi(this,t);var n=Qi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,I.d));n.featureActivator=new Fi,n.childRoutes=[];var r={path:l.a.routes.settingsBase,component:Gi(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"withMe",n).call(n,qi),indexRoute:{component:Yi},childRoutes:n.childRoutes};return e.push(r),n}return $i(t,e),Zi(t,[{key:"addChild",value:function(e){if(!(e instanceof ts))throw Error("feature must implement SettingsFeatureBase");this.featureActivator.register(e)}}]),Zi(t,[{key:"componentDidMount",value:function(){try{e=this.featureActivator,m.a.evaluate(Wi.store).isReady()||(e.onload(),m.a.dispatch(Vi,{}),L.success())}catch(e){this.handleError(e)}var e}},{key:"onload",value:function(){this.featureActivator.getFeatures().some((function(e){return e.isEnabled()}))&&Kt(es)}}]),t}(Fn);var rs=function(e){return o.a.createElement("div",{className:G()("grv-alert grv-alert-danger",e.className)},e.children)},os=function(e){return o.a.createElement("div",{className:G()("grv-alert grv-alert-info",e.className)},e.children)},as=function(e){return o.a.createElement("div",{className:G()("grv-alert grv-alert-success",e.className)}," ",o.a.createElement("i",{className:"fa fa-check m-r-xs"})," ",e.children)},is=_.a.create("flux/settingsAccount/actions");function ss(e,t){ls(E.changePasswordWithU2f(e,t))}function us(e,t,n){ls(E.changePassword(e,t,n))}function cs(){F.clear()}function ls(e){return F.start(),e.done((function(){F.success()})).fail((function(e){var t=g.a.getErrorText(e);is.error("change password",e),F.fail(t),403==e.status&&C.logout()}))}var fs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ps=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function hs(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ds=function(){return o.a.createElement("div",{className:"grv-settings-header-line-solid m-t-sm m-b-sm"})},vs=function(e){var t=e.text;return o.a.createElement("label",{style:{width:"150px",fontWeight:"normal"},className:" m-t-xs"}," ",t," ")},ms={oldPass:"",newPass:"",newPassConfirmed:"",token:""},ys=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=hs(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.hasBeenClicked=!1,r.state=fs({},ms),r.onClick=function(e){if(e.preventDefault(),r.isValid()){var t=r.state,n=t.oldPass,o=t.newPass,a=t.token;r.hasBeenClicked=!0,r.props.auth2faType===pe.UTF?r.props.onChangePassWithU2f(n,o):r.props.onChangePass(n,o,a)}},r.onKeyPress=function(e){"Enter"===e.key&&e.target.value&&r.onClick(e)},hs(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ps(t,[{key:"componentDidMount",value:function(){b()(this.refs.form).validate({rules:{newPass:{minlength:6,required:!0},newPassConfirmed:{required:!0,equalTo:this.refs.newPass}},messages:{passwordConfirmed:{minlength:b.a.validator.format("Enter at least {0} characters"),equalTo:"Enter the same password as above"}}})}},{key:"componentWillUnmount",value:function(){this.props.onDestory&&this.props.onDestory()}},{key:"isValid",value:function(){var e=b()(this.refs.form);return 0===e.length||e.valid()}},{key:"componentWillReceiveProps",value:function(e){e.attempt.isSuccess&&this.hasBeenClicked&&(this.hasBeenClicked=!1,this.setState(ms))}},{key:"isU2f",value:function(){return this.props.auth2faType===pe.UTF}},{key:"isOtp",value:function(){return this.props.auth2faType===pe.OTP}},{key:"render",value:function(){var e=this,t=this.isOtp(),n=this.props.attempt,r=n.isFailed,a=n.isProcessing,i=n.isSuccess,s=n.message,u=this.state,c=u.oldPass,l=u.newPass,f=u.newPassConfirmed,p=a&&this.isU2f();return o.a.createElement("div",{title:"Change Password",className:"m-t-sm grv-settings-account"},o.a.createElement("h3",{className:"no-margins"},"Change Password"),o.a.createElement(ds,null),o.a.createElement("div",{className:"m-b m-l-xl",style:{maxWidth:"500px"}},o.a.createElement("form",{ref:"form",onKeyPress:this.onKeyPress},o.a.createElement("div",null,r&&o.a.createElement(rs,{className:"m-b-sm"}," ",s," "),i&&o.a.createElement(as,{className:"m-b-sm"}," Your password has been changed "),p&&o.a.createElement(os,{className:"m-b-sm"}," Insert your U2F key and press the button on the key ")),o.a.createElement(Sa,{dir:"row",className:"m-t"},o.a.createElement(vs,{text:"Current Password:"}),o.a.createElement("div",{style:{flex:"1"}},o.a.createElement("input",{autoFocus:!0,type:"password",value:c,onChange:function(t){return e.setState({oldPass:t.target.value})},className:"form-control required"}))),t&&o.a.createElement(Sa,{dir:"row",className:"m-t-sm"},o.a.createElement(vs,{text:"2nd factor token:"}),o.a.createElement("div",{style:{flex:"1"}},o.a.createElement("input",{autoComplete:"off",style:{width:"100px"},value:this.state.token,onChange:function(t){return e.setState({token:t.target.value})},className:"form-control required",name:"token"}))),o.a.createElement(Sa,{dir:"row",className:"m-t-lg"},o.a.createElement(vs,{text:"New Password:"}),o.a.createElement("div",{style:{flex:"1"}},o.a.createElement("input",{value:l,onChange:function(t){return e.setState({newPass:t.target.value})},ref:"newPass",type:"password",name:"newPass",className:"form-control"}))),o.a.createElement(Sa,{dir:"row",className:"m-t-sm"},o.a.createElement(vs,{text:"Confirm Password:"}),o.a.createElement("div",{style:{flex:"1"}},o.a.createElement("input",{type:"password",value:f,onChange:function(t){return e.setState({newPassConfirmed:t.target.value})},name:"newPassConfirmed",className:"form-control"}))))),o.a.createElement("button",{disabled:a,onClick:this.onClick,type:"submit",className:"btn btn-sm btn-primary block"},"Update"))}}]),t}(o.a.Component);ys.propTypes={attempt:o.a.PropTypes.object.isRequired,onChangePass:o.a.PropTypes.func.isRequired,onChangePassWithU2f:o.a.PropTypes.func.isRequired};var bs=$r((function(){return{attempt:K.pswChangeAttempt}}),(function(){return{auth2faType:l.a.getAuth2faType(),onChangePass:us,onChangePassWithU2f:ss,onDestory:cs}}))(ys),gs=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ws=l.a.routes.settingsAccount,Es=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r={path:ws,component:n.withMe(se("Account",bs))};return e.push(r),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),gs(t,[{key:"isEnabled",value:function(){return 0==H().isSso()}},{key:"init",value:function(){this.wasInitialized()||this.stopProcessing()}},{key:"onload",value:function(){this.isEnabled()&&(!function(e){m.a.dispatch(Hi,e)}({to:ws,title:"Account"}),this.init())}}]),t}(ts);var _s,Os={isWin:(_s=window.navigator.userAgent).indexOf("Windows")>=0,isMac:_s.indexOf("Macintosh")>=0,isLinux:_s.indexOf("Linux")>=0},js=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ks=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),js(t,[{key:"setSiteId",value:function(e){return this.set("siteId",e)}},{key:"getClusterName",value:function(){return this.get("siteId")}},{key:"getNavItems",value:function(){return this.navItems.toJS()}},{key:"addNavItem",value:function(e){return this.set("navItems",this.navItems.push(e))}}]),t}(Object(vn.Record)({siteId:null,navItems:new vn.List}));var Ps=Object(dn.Store)({getInitialState:function(){return new ks},initialize:function(){this.on(zt,(function(e,t){return e.setSiteId(t)})),this.on(Mt,(function(e,t){return e.addNavItem(t)}))}});function Ss(e){var t=m.a.evaluate(["tlpt"]).getNavItems(),n=H().getName(),r=t.map((function(t,n){var r=e.router.isActive(t.to)?"active":"";return o.a.createElement("li",{key:n,className:r,title:t.title},o.a.createElement(u.IndexLink,{to:t.to},o.a.createElement("i",{className:t.icon})))}));return r.push(o.a.createElement("li",{key:r.length,title:"help"},o.a.createElement("a",{href:l.a.helpUrl,target:"_blank"},o.a.createElement("i",{className:"fa fa-question"})))),r.push(o.a.createElement("li",{key:r.length,title:"logout"},o.a.createElement("a",{href:"#",onClick:B.logout},o.a.createElement("i",{className:"fa fa-sign-out",style:{marginRight:0}})))),o.a.createElement("nav",{className:"grv-nav navbar-default",role:"navigation"},o.a.createElement("ul",{className:"nav text-center",id:"side-menu"},o.a.createElement("li",null,o.a.createElement(ee,{name:n})),r))}Ss.propTypes={router:o.a.PropTypes.object.isRequired};var Ts=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Cs(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Ns=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return n=r=Cs(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.onRefresh=function(){return Object(Vt.a)()},Cs(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ts(t,[{key:"render",value:function(){var e=this.props,t=e.router,n=e.initAttempt,r=n.isProcessing,a=n.isSuccess,i=n.isFailed,s=n.message;if(r)return o.a.createElement(Nn,{type:"bounce"});if(i)return o.a.createElement(Le,{message:s});var u=G()("grv-tlpt grv-flex grv-flex-row",{"--isLinux":Os.isLinux,"--isWin":Os.isWin,"--isMac":Os.isMac});return a?o.a.createElement("div",{className:u},o.a.createElement(Oa,{onFetch:this.onRefresh,time:3e3}),this.props.CurrentSessionHost,o.a.createElement(Ss,{router:t}),this.props.children):null}}]),t}(r.Component);var Is=Object(c.connect)((function(){return{initAttempt:tt.a.initAttempt}}))(Ns),xs=(n("7WIf"),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}());var Rs=new vn.Record({isReady:!1,isLoading:!1,isNotFound:!1,isError:!1,errorText:void 0}),Ds=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),xs(t,[{key:"getClusterName",value:function(){return this.siteId}},{key:"getTtyParams",value:function(){var e=O.b.getBearerToken().accessToken,t=this.serverId;return{login:this.login,sid:this.sid,token:e,ttyUrl:l.a.api.ttyWsAddr,cluster:this.siteId,getTarget:function(){return{server_id:t}}}}},{key:"getServerLabel",value:function(){return this.hostname&&this.login?this.login+"@"+this.hostname:this.serverId&&this.login?this.login+"@"+this.serverId:""}}]),t}(Object(vn.Record)({status:Rs(),hostname:null,login:null,siteId:null,serverId:null,sid:null})),As=Object(dn.Store)({getInitialState:function(){return new Ds},initialize:function(){this.on(Sr,Ls),this.on(Tr,Us),this.on("TLPT_TERMINAL_SET_STATUS",Fs)}});function Us(){return new Ds}function Ls(e,t){return new Ds(t)}function Fs(e,t){return e.setIn(["status"],new Rs(t))}var Ws=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var zs=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ws(t,[{key:"isReady",value:function(){return this.isInitialized}},{key:"getNavItems",value:function(){return this.navItems.toJS()}},{key:"addNavItem",value:function(e){return this.set("navItems",this.navItems.push(e))}}]),t}(Object(vn.Record)({isInitialized:!1,navItems:new vn.List})),Ms=Object(dn.Store)({getInitialState:function(){return new zs},initialize:function(){this.on(Vi,(function(e){return e.set("isInitialized",!0)})),this.on(Hi,(function(e,t){return e.addNavItem(t)}))}}),Bs=n("PVWJ"),qs=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var Vs=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),qs(t,[{key:"isSso",value:function(){return this.get("authType")===he}},{key:"getName",value:function(){return this.get("name")}}]),t}(Object(vn.Record)({name:"",authType:""})),Hs=Object(dn.Store)({getInitialState:function(){return Object(dn.toImmutable)(null)},initialize:function(){this.on(W,Ks)}});function Ks(e,t){return new Vs(t)}var Js=new vn.Record({invite_token:"",user:"",qr:""}),Ys=Object(dn.Store)({getInitialState:function(){return Object(dn.toImmutable)(null)},initialize:function(){this.on("TLPT_RECEIVE_USER_INVITE",Gs)}});function Gs(e,t){return new Js(t)}var Zs=Object(vn.Record)({name:null,status:!1}),Xs=Object(dn.Store)({getInitialState:function(){return new vn.List},initialize:function(){this.on(Bt,Qs)}});function Qs(e,t){return Object(dn.toImmutable)(t).map((function(e){return new Zs(e)}))}var $s=n("zMbK"),eu=Object(dn.Store)({getInitialState:function(){return Object(dn.toImmutable)({})},initialize:function(){this.on($s.b,tu)}});function tu(e,t){var n=t.json||[];return e.withMutations((function(e){n.forEach((function(t){var n=t.sid,r=t.event;e.has(n)||e.set(n,Object(dn.toImmutable)({})),e.setIn([n,r],Object(dn.toImmutable)(t))}))}))}var nu=Object(vn.Record)({id:void 0,user:void 0,created:void 0,nodeIp:void 0,last_active:void 0,server_id:void 0,siteId:void 0,parties:Object(vn.List)()}),ru=Object(dn.Store)({getInitialState:function(){return Object(dn.toImmutable)({})},initialize:function(){this.on($s.b,ou)}});function ou(e,t){var n=t.siteId,r=t.json||[],o={};return e.withMutations((function(e){r.forEach((function(t){if(t.event===hr.START||t.event===hr.END){var r=t.sid,a=t.user,i=t.time,s=t.event,u=t.server_id;o[r]=o[r]||{},o[r].id=r,o[r].user=a,o[r].siteId=n,s===hr.START&&(o[r].created=i,o[r].server_id=u,o[r].nodeIp=t["addr.local"],o[r].parties=[{user:a,serverIp:t["addr.remote"]}]),s!==hr.END||e.has(r)||(o[r].last_active=i,e.set(r,new nu(Object(dn.toImmutable)(o[r]))))}}))}))}var au=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},iu=Object(vn.Record)({id:void 0,namespace:void 0,login:void 0,created:void 0,last_active:void 0,server_id:void 0,siteId:void 0,parties:Object(vn.List)()}),su=Object(vn.Record)({user:void 0,serverIp:void 0,serverId:void 0}),uu=function(){return Object(dn.toImmutable)({})},cu=Object(dn.Store)({getInitialState:function(){return uu()},initialize:function(){this.on($s.a,lu)}});function lu(e,t){var n=t.siteId,r=t.json||[],o=uu().withMutations((function(e){return r.forEach((function(t){var r=function(e,t){var n=function(e){return e=e||[],(new vn.List).withMutations((function(t){e.forEach((function(e){var n=new su({user:e.user,serverIp:e.remote_addr,serverId:e.server_id});t.push(n)}))}))}(t.parties);return new iu(Object(dn.toImmutable)(au({},t,{siteId:e,parties:n})))}(n,t);e.set(r.id,r)}))}));return o.equals(e)?e:o}var fu,pu,hu,du=n("OcN7"),vu=Object(dn.Store)({getInitialState:function(){var e=pr()(new Date).endOf("day").toDate(),t={start:pr()(e).subtract(3,"day").startOf("day").toDate(),end:e};return Object(dn.toImmutable)(t)},initialize:function(){this.on(du.a,mu)}});function mu(e,t){return e.merge(t)}m.a.registerStores((hu=bn,(pu="tlpt_ssh_history")in(fu={})?Object.defineProperty(fu,pu,{value:hu,enumerable:!0,configurable:!0,writable:!0}):fu[pu]=hu,fu)),function(e){var t,n,r;e.registerStores((r=wn,(n="tlpt_misc")in(t={})?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))}(m.a),function(e){var t,n,r;e.registerStores((r=$n,(n=er)in(t={})?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t))}(m.a),m.a.registerStores({tlpt_settings:Ms,tlpt:Ps,tlpt_terminal:As,tlpt_nodes:lr,tlpt_user:Hs,tlpt_user_invite:Ys,tlpt_user_acl:Br,tlpt_sites:Xs,tlpt_status:Bs.b,tlpt_sessions_events:eu,tlpt_sessions_archived:ru,tlpt_sessions_active:cu,tlpt_sessions_filter:vu});n("VSY+"),n("hQgP");l.a.init(window.GRV_CONFIG),v.init();var yu,bu=[],gu=new Fi;gu.register(new ba(bu)),gu.register(new Ai(bu)),gu.register((function(e,t){var n=new t(e.childRoutes);e.addChild(n)}(yu=new ns(bu),Es),yu));var wu,Eu=[{path:l.a.routes.app,onEnter:B.ensureUser,component:Is,childRoutes:[{onEnter:function(e){Yt(e.params.siteId,gu)},childRoutes:bu}]}];wu=function(){return o.a.createElement(c.Provider,{reactor:m.a},o.a.createElement(u.Router,{history:v.original(),routes:Qe(Eu)}))},i.a.render(o.a.createElement(s.AppContainer,null,o.a.createElement(wu,null)),document.getElementById("app"))},tGXY:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var r="TLPT_STATUS_START",o="TLPT_STATUS_SUCCESS",a="TLPT_STATUS_FAIL",i="TLPT_STATUS_CLEAR"},xSHT:function(e,t,n){"use strict";var r=n("L7e8"),o="color: blue",a={debug:!1},i={dispatchStart:function(e,t,n){window.console.log('%creactor.dispatch("'+t+'", ',o,n,")")},dispatchError:function(e,t){window.console.debug("Dispatch error: "+t)},dispatchEnd:function(e,t,n){var r=t.filter((function(e,t){return n.contains(t)}));window.console.log("%cupdated store -> ",o,r.toJS())}};a.debug&&(a.logger=i);var s=new r.Reactor(a);window.reactor=s,t.a=s},zMbK:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r="TLPT_SESSIONS_RECEIVE_ACTIVE",o="TLPT_SESSIONS_RECEIVE_EVENTS"}});